import{b as V,d as f}from"./index.c3e79e11.js";import{_,o as n,p as g}from"./main.e162c083.js";const v={key:0,class:"resources-upload"},x=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload image",-1),w=Vue.defineComponent({__name:"ImageUpload",props:{photoList:{type:Array,required:!0},maxSize:{type:Number,required:!1,default:4}},setup(i,{expose:c}){const e=i;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),c({});const a={},p=(r,l)=>{console.log("file change, length: "+l.length)},d=r=>(console.log("before uplaod file: "+r.uid),a[r.uid]=r,r),m=r=>{const l=Object.keys(a),u=Math.max((e.maxSize||0)-e.photoList.length,0);l.length>u?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${u}, actual: ${l.length}`),l.forEach(t=>{delete a[t]})):l.length>0&&(Promise.all(l.map(t=>{const s=a[t],o=new FormData;return o.set("filename",s.name),o.set("file",s),g("index/img",o)})).then(t=>(t.forEach(s=>{const o=s.data;e.photoList.push({photoUrl:o.url,photoCompressUrl:o.compressUrl})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.success("Upload failed"),Promise.reject())),l.forEach(t=>{delete a[t]}))};return Vue.watch(()=>e.photoList,r=>{},{immediate:!0}),(r,l)=>{const u=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload"),s=Vue.resolveComponent("el-image");return e.photoList?(Vue.openBlock(),Vue.createElementBlock("div",v,[Vue.withDirectives(Vue.createVNode(t,{action:"#","show-file-list":!1,"on-change":p,"before-upload":d,"http-request":m,multiple:"",drag:!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(u,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(V),{style:{width:"5em",height:"5em"}})]),_:1}),x])]),_:1},512),[[Vue.vShow,e.photoList.length<e.maxSize]]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.photoList,(o,h)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:o.photoUrl,class:"resources-view"},[Vue.createVNode(s,{src:Vue.unref(n)(o.photoCompressUrl,""),fit:"cover","preview-src-list":[Vue.unref(n)(o.photoUrl,"")],"initial-index":0,class:"image-view"},null,8,["src","preview-src-list"]),Vue.createVNode(u,{class:"close-btn",size:28,onClick:C=>e.photoList.splice(h,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(f))]),_:2},1032,["onClick"])]))),128))])):Vue.createCommentVNode("v-if",!0)}}});var E=_(w,[["__file","D:/code/mp-server/src/page/src/page/industry/component/ImageUpload.vue"]]);export{E as default};
