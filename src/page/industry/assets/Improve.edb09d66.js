import{q as w,h as b,i as q,b as z,x as A,_ as O}from"./main.e162c083.js";import{V as s,a as T}from"./ViewContent.29936a75.js";import{h as Y}from"./IndustryUtil.35abe8a4.js";import{k as j,e as G}from"./index.c3e79e11.js";import L from"./ImageUpload.ffae63c6.js";import C from"./FileUpload.fea7c9aa.js";const H={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"flex-start","margin-bottom":"20px",position:"absolute",width:"100%",top:"20px"},id:"printContainer"},J={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",width:"595px"}},Q=Vue.createElementVNode("div",{style:{width:"100%","text-align":"right","font-weight":"400"}},"VMF46-02-06/A",-1),W={style:{"text-align":"center"}},X={style:{"font-size":"36px"}},Z=Vue.createTextVNode(" \u5200\u5177\u4E8B\u6545\u62A5\u544A Dao h\u1ECFng Accident Report "),ee=Vue.createTextVNode("` "),te=Vue.createTextVNode(" Done "),le={class:"dialog-footer"},oe=Vue.createTextVNode("Cancel"),ae=Vue.createTextVNode("Confirm");var re=Vue.defineComponent({__name:"Improve",setup(ue){VueRouter.useRouter();const h=VueRouter.useRoute(),a=Vuex.useStore(),g=a.state.roleCodeList,N="improveId",y=Vue.ref(null),k=Vue.ref([{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:116},{value:"directLeaderFormat",labelKey:"directLeader",width:88},{value:"accidentDescribe",labelKey:"accidentImproveDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"improveReason",width:276,showOverflow:!0},{value:"solve",labelKey:"improveSolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"improveOpinion",width:128},{value:"valid",labelKey:"valid",width:100,type:s.Valid},{value:"photoList",labelKey:"improvePhoto",width:128,type:s.Image},{value:"fileList",labelKey:"improveFile",width:128,type:s.Attachment},{value:"improvePhotoList",labelKey:"improveImprovePhoto",width:128,type:s.Image},{value:"improveFileList",labelKey:"improveImproveFile",width:128,type:s.Attachment}]),l=Vue.ref({reportDate:w(new Date,"yyyy-MM-dd"),userId:"",directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",improveOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]}),d=Vue.reactive({userConfigList:new Array,formVisible:!1,formSave:!1,config:{improveReasonList:[]},formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}}),_=()=>{b("douson/improve",{improveId:h.query.improveId}).then(u=>{l.value=u.data||{},ElementPlus.ElMessage.success("Query success"),setTimeout(()=>{var m;const t=(((m=document.getElementById("printDescription"))==null?void 0:m.offsetHeight)||1024)+450+"px",n=document.getElementById("printContainer");n&&(n.style.height=t)},1e3)})},V=Vue.ref(new Array);Promise.all([b("douson/config",{categoryIdList:["improveReason"]}),b("system/user/config/list",{})]).then(u=>{d.config=u[0].data,V.value=(u[1].list||[]).map(t=>({value:t.userId,label:t.name})),_()});const D=()=>{d.formVisible=!0},P=()=>{y.value.validate((u,t)=>{u?I(l.value):ElementPlus.ElMessage.error("Please check input")})},I=u=>z("douson/admin/improve",u).then(()=>{d.formVisible=!1,ElementPlus.ElMessage.success("Update success"),_()}),E=()=>{const u=A(`/industry/public/improve?improveId=${h.query.improveId}`),t=document.createElement("input");t.value=u,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),ElementPlus.ElMessage.success("Copy success")},{userConfigList:ie,formVisible:p,formSave:$,config:B,formRuleList:i}={...Vue.toRefs(d)};return(u,t)=>{const n=Vue.resolveComponent("el-icon"),m=Vue.resolveComponent("el-descriptions-item"),F=Vue.resolveComponent("el-descriptions"),M=Vue.resolveComponent("el-date-picker"),r=Vue.resolveComponent("el-form-item"),v=Vue.resolveComponent("el-option"),f=Vue.resolveComponent("el-select"),c=Vue.resolveComponent("el-input"),U=Vue.resolveComponent("el-checkbox"),R=Vue.resolveComponent("el-form"),x=Vue.resolveComponent("el-button"),K=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",H,[Vue.createElementVNode("div",J,[Q,Vue.createElementVNode("h1",W,[Vue.createElementVNode("span",X,[Z,Vue.createVNode(n,{style:{"vertical-align":"middle"},onClick:E},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(j))]),_:1}),l.value.valid?Vue.createCommentVNode("v-if",!0):(Vue.openBlock(),Vue.createBlock(n,{key:0,class:"print-hide",style:{"vertical-align":"middle"},onClick:D},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(G))]),_:1}))])]),Vue.createVNode(F,{column:1,style:{width:"100%"},border:"",id:"printDescription"},{default:Vue.withCtx(()=>[ee,(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(Y)(k.value,[],!0,!1,[],[]),(e,o)=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.labelKey?Vue.unref(a).state.label[e.labelKey]:e.label,align:"center","label-class-name":"improve-print-label description-print-border","class-name":"description-print-border"},{default:Vue.withCtx(()=>[Vue.createVNode(T,{idKey:N,viewConfig:e,row:l.value},{expand:Vue.withCtx(S=>[Vue.renderSlot(u.$slots,"expand",{param:S.param})]),_:2},1032,["viewConfig","row"])]),_:2},1032,["label"]))),128))]),_:3})]),Vue.createVNode(K,{title:Vue.unref($)?"Add":"Edit",modelValue:Vue.unref(p),"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.isRef(p)?p.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",le,[Vue.createVNode(x,{onClick:t[10]||(t[10]=e=>p.value=!1)},{default:Vue.withCtx(()=>[oe]),_:1}),Vue.createVNode(x,{type:"primary",onClick:P},{default:Vue.withCtx(()=>[ae]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(R,{rules:Vue.unref(i),model:l.value,ref_key:"formRef",ref:y,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(r,{prop:"reportDate",label:Vue.unref(a).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(M,{type:"date",modelValue:l.value.reportDate,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.reportDate=e),format:"YYYY-MM-DD",onChange:t[1]||(t[1]=e=>l.value.reportDate=Vue.unref(w)(l.value.reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"userId",label:Vue.unref(a).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:l.value.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(V.value,e=>(Vue.openBlock(),Vue.createBlock(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"directLeader",label:Vue.unref(a).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:l.value.directLeader,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(V.value,e=>(Vue.openBlock(),Vue.createBlock(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"accidentDescribe",label:Vue.unref(a).state.label.accidentImproveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:l.value.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"photoList",label:`${Vue.unref(a).state.label.improvePhoto}(${(Vue.unref(i).photoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(L,{photoList:l.value.photoList,maxSize:Number(`${(Vue.unref(i).photoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"fileList",label:`${Vue.unref(a).state.label.improveFile}(${(Vue.unref(i).fileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(C,{fileList:l.value.fileList,maxSize:Number(`${(Vue.unref(i).fileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"reason",label:Vue.unref(a).state.label.improveReason},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:l.value.reasonList,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.improveReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(B).improveReasonList,e=>(Vue.openBlock(),Vue.createBlock(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"solve",label:Vue.unref(a).state.label.improveSolve},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:l.value.solve,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"improvePhotoList",label:`${Vue.unref(a).state.label.improveImprovePhoto}(${(Vue.unref(i).improvePhotoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(L,{photoList:l.value.improvePhotoList,maxSize:Number(`${(Vue.unref(i).improvePhotoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"improveFileList",label:`${Vue.unref(a).state.label.improveImproveFile}(${(Vue.unref(i).improveFileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(C,{fileList:l.value.improveFileList,maxSize:Number(`${(Vue.unref(i).improveFileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"improveDescribe",label:Vue.unref(a).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:l.value.improveDescribe,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"opinion",label:Vue.unref(a).state.label.improveOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:l.value.opinion,"onUpdate:modelValue":t[8]||(t[8]=e=>l.value.opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(r,{prop:"valid",label:Vue.unref(a).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(U,{modelValue:l.value.valid,"onUpdate:modelValue":t[9]||(t[9]=e=>l.value.valid=e),name:"valid",disabled:!Vue.unref(q)(Vue.unref(g),"admin")},{default:Vue.withCtx(()=>[te]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});var Ve=O(re,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/public/Improve.vue"]]);export{Ve as default};
