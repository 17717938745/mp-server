import{d as _,e as b,f as K,j as C,b as k,s as M,r as B,k as N,l as S,n as E,_ as R}from"./main.e162c083.js";import{u as D,a as T}from"./index.c3e79e11.js";const y=c=>(Vue.pushScopeId("data-v-6261def2"),c=c(),Vue.popScopeId(),c),q={class:"login-wrap"},L={class:"ms-login"},I=y(()=>Vue.createElementVNode("div",{class:"ms-title"},"\u7BA1\u7406\u5E73\u53F0",-1)),P=Vue.createTextVNode("\u767B\u5F55"),j=y(()=>Vue.createElementVNode("span",{class:"login-tips"},"Tips\uFF1A\u6B22\u8FCE\u4F7F\u7528\u540E\u53F0\u7BA1\u7406\u7CFB\u7EDF",-1)),A=Vue.createTextVNode("\u5DF2\u767B\u5F55\u76F4\u63A5\u8DF3\u8F6C ");var z=Vue.defineComponent({__name:"Sign",setup(c){const r=VueRouter.useRouter(),w=Vue.ref(null),n=Vuex.useStore(),F=n.state;n.commit("clearTagList");const v=Object.keys(_()).length>0?_():{username:"",password:"",autoLogin:!0},g=Vue.reactive({signData:v,rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}]}}),l=Vue.ref(!1),{signData:u,rules:x}={...Vue.toRefs(g)},V=()=>{const p=b(F.menuTreeList),t=K("goBack")||"";if(t.length>0&&r.hasRoute(t))r.push(t);else{const e=C(p,"/industry");r.hasRoute(e)||(console.log(`firstPath: ${e}`),l.value=!1),r.push(e)}},f=(p=!0)=>{w.value.validate(t=>{if(t&&!l.value)l.value=!0,k("system/sign-in",{username:g.signData.username,passwordEncrypt:M(g.signData.password||"")}).then(e=>{const o=e.data.user,d=[{id:"-1",path:"industry",component:"industry",white:!0,showFlag:!0,children:[{id:"-1",path:"admin",component:"admin",nameKey:"admin",white:!0,showFlag:!0,children:[{children:[],id:"-1",path:"dashboard",component:"dashboard",nameKey:"dashboard",white:!1,showFlag:!0},{id:"-1",path:"system",component:"",nameKey:"systemManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"user",component:"user",nameKey:"userManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"account",component:"account",nameKey:"accountManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"sign",component:"sign",nameKey:"signInHistory",white:!1,showFlag:o.username==="admin"}]},{id:"-1",path:"product",component:"",nameKey:"productManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"param",component:"param",nameKey:"paramManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"device",component:"device",nameKey:"deviceManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"order",component:"order",nameKey:"orderManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"index",component:"index",nameKey:"productQuotaManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"report",component:"report",nameKey:"userRunReport",white:!1,showFlag:!0},{children:[],id:"-1",path:"box",component:"box",nameKey:"boxFlagCard",white:!1,showFlag:!0}]},{id:"-1",path:"report",component:"",nameKey:"reportManage",white:!1,showFlag:!0,children:[{children:[{children:[],id:"-1",path:"backup",component:"backup",nameKey:"accidentReportBackup",white:!1,showFlag:!0},{children:[],id:"-1",path:"event",component:"event",nameKey:"accidentEvent",white:!1,showFlag:!0},{children:[],id:"-1",path:"improve",component:"improve",nameKey:"accidentImprove",white:!1,showFlag:!0},{children:[],id:"-1",path:"quality",component:"quality",nameKey:"accidentQuality",white:!1,showFlag:!0}],id:"-1",path:"accident",component:"",nameKey:"accidentReport",white:!1,showFlag:!0},{children:[],id:"-1",path:"disqualification",component:"disqualification",nameKey:"disqualificationOrder",white:!1,showFlag:!0},{children:[],id:"-1",path:"plan",component:"plan",nameKey:"keepImprove",white:!1,showFlag:!0}]},{id:"-1",path:"asset",component:"",nameKey:"assetManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"device",component:"device",nameKey:"deviceCheckLedger",white:!1,showFlag:!0},{children:[],id:"-1",path:"computer",component:"computer",nameKey:"computerManage",white:!1,showFlag:!0},{children:[{children:[],id:"-1",path:"equipment",component:"equipment",nameKey:"machineEquipment",white:!1,showFlag:!0},{children:[],id:"-1",path:"maintain",component:"maintain",nameKey:"machineMaintainRepair",white:!1,showFlag:!0}],id:"-1",path:"machine",nameKey:"productMachine",white:!1,showFlag:!0}]}]}]}],h=(i,a="")=>{for(let m=0;m<i.length;m++){const s=i[m];s.id=(a&&a+"-")+m,s.name=n.state.label[s.nameKey||""],(s.children||[]).length>0&&h(s.children||[],s.id)}};h(d,""),n.commit("setMenuTreeList",d),n.commit("setUser",o),n.commit("setRoleCodeList",e.data.user.roleList.map(i=>i.roleCode)),B(r),V()}).catch(e=>{e.code===74004&&p&&(N(""),S(""),E().then(o=>{f(!1)})),l.value=!1});else return!1})};return(p,t)=>{const e=Vue.resolveComponent("el-button"),o=Vue.resolveComponent("el-input"),d=Vue.resolveComponent("el-form-item"),h=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",q,[Vue.createElementVNode("div",L,[I,Vue.createVNode(i,{model:Vue.unref(u),rules:Vue.unref(x),ref_key:"login",ref:w,"label-width":"0px",class:"ms-content"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{prop:"username"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:Vue.unref(u).username,"onUpdate:modelValue":t[0]||(t[0]=a=>Vue.unref(u).username=a),tabindex:"1",autofocus:"",placeholder:"username"},{prepend:Vue.withCtx(()=>[Vue.createVNode(e,{icon:Vue.unref(D)},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(d,{prop:"password"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{type:"password",placeholder:"password",modelValue:Vue.unref(u).password,"onUpdate:modelValue":t[1]||(t[1]=a=>Vue.unref(u).password=a),onKeyup:Vue.withKeys(f,["enter"]),tabindex:"1"},{prepend:Vue.withCtx(()=>[Vue.createVNode(e,{icon:Vue.unref(T)},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"])]),_:1}),Vue.createVNode(e,{class:"login-btn",type:"primary",onClick:f,disabled:l.value},{default:Vue.withCtx(()=>[P]),_:1},8,["disabled"]),j,Vue.createVNode(h,{class:"login-helper",onClick:V},{default:Vue.withCtx(()=>[A]),_:1})]),_:1},8,["model","rules"])])])}}});var Q=R(z,[["__scopeId","data-v-6261def2"],["__file","D:/code/mp-server/src/page/src/page/industry/Sign.vue"]]);export{Q as default};
