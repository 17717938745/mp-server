import{b as m,d as p}from"./index.c3e79e11.js";import{_ as V,o as h,p as _}from"./main.e162c083.js";const g={key:0,class:"resources-upload"},x=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload file",-1),v=["href"],k=Vue.defineComponent({__name:"FileUpload",props:{fileList:{type:Array,required:!0},maxSize:{type:Number,required:!1,default:4}},setup(i,{expose:n}){const e=i;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),n({});const u={},c=(r,l)=>{console.log("file change, length: "+l.length)},d=r=>(console.log("before uplaod file: "+r.uid),u[r.uid]=r,r),f=r=>{const l=Object.keys(u),s=Math.max((e.maxSize||0)-e.fileList.length,0);l.length>s?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${s}, actual: ${l.length}`),l.forEach(t=>{delete u[t]})):l.length>0&&(Promise.all(l.map(t=>{const a=u[t],o=new FormData;return o.set("filename",a.name),o.set("file",a),_("index/file",o)})).then(t=>(t.forEach(a=>{const o=a.data;e.fileList.push({url:o.url,fileId:o.fileId,filename:o.filename})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.success("Upload failed"),Promise.reject())),l.forEach(t=>{delete u[t]}))};return Vue.watch(()=>e.fileList,r=>{},{immediate:!0}),(r,l)=>{const s=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload");return e.fileList?(Vue.openBlock(),Vue.createElementBlock("div",g,[Vue.withDirectives(Vue.createVNode(t,{action:"#","show-file-list":!1,"on-change":c,"before-upload":d,"http-request":f,multiple:"",drag:!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(s,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(m),{style:{width:"5em",height:"5em"}})]),_:1}),x])]),_:1},512),[[Vue.vShow,e.fileList.length<e.maxSize]]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.fileList,(a,o)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:a.url,class:"resources-view"},[Vue.createElementVNode("a",{href:Vue.unref(h)(a.url,"")},Vue.toDisplayString(a.filename),9,v),Vue.createVNode(s,{class:"close-btn",size:28,onClick:E=>e.fileList.splice(o,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(p))]),_:2},1032,["onClick"])]))),128))])):Vue.createCommentVNode("v-if",!0)}}});var C=V(k,[["__file","D:/code/mp-server/src/page/src/page/industry/component/FileUpload.vue"]]);export{C as default};
