import{b as m,d as V}from"./index.c3e79e11.js";import{_ as h,o as _,p as f}from"./main.e162c083.js";const v={key:0,class:"resources-upload"},g=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload video",-1),x={width:"320",style:{"max-width":"100%"},controls:""},w=["src"],y=Vue.createTextVNode(" Your browser not support vidio tag "),E=Vue.defineComponent({__name:"VideoUpload",props:{videoList:{type:Array,required:!0},maxSize:{type:Number,required:!1,default:4}},setup(u,{expose:a}){const e=u;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),a({});const i={},d=(s,o)=>{console.log("file change, length: "+o.length)},c=s=>(console.log("before uplaod file: "+s.uid),i[s.uid]=s,s),p=s=>{const o=Object.keys(i),n=Math.max((e.maxSize||0)-e.videoList.length,0);o.length>n?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${n}, actual: ${o.length}`),o.forEach(t=>{delete i[t]})):o.length>0&&(Promise.all(o.map(t=>{const r=i[t],l=new FormData;return l.set("filename",r.name),l.set("file",r),f("index/video",l)})).then(t=>(t.forEach(r=>{const l=r.data;e.videoList.push({videoUrl:l.url,videoCompressUrl:l.compressUrl,extension:l.extension})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.success("Upload failed"),Promise.reject())),o.forEach(t=>{delete i[t]}))};return Vue.watch(()=>e.videoList,s=>{},{immediate:!0}),(s,o)=>{const n=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload");return e.videoList?(Vue.openBlock(),Vue.createElementBlock("div",v,[Vue.withDirectives(Vue.createVNode(t,{action:"#","show-file-list":!1,"on-change":d,"before-upload":c,"http-request":p,multiple:"",drag:!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(n,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(m),{style:{width:"5em",height:"5em"}})]),_:1}),g])]),_:1},512),[[Vue.vShow,e.videoList.length<e.maxSize]]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.videoList,(r,l)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:r.videoUrl,class:"resources-view",style:{width:"100%"}},[Vue.createElementVNode("video",x,[Vue.createCommentVNode(':type="`video/${temp.extension}`"'),Vue.createElementVNode("source",{src:Vue.unref(_)(r.videoUrl,""),type:"video/mp4"},null,8,w),y]),Vue.createVNode(n,{class:"close-btn",size:28,onClick:k=>e.videoList.splice(l,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(V))]),_:2},1032,["onClick"])]))),128))])):Vue.createCommentVNode("v-if",!0)}}});var U=h(E,[["__file","D:/code/mp-server/src/page/src/page/industry/component/VideoUpload.vue"]]);export{U as default};
