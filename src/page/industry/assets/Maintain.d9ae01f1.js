import{s as G,p as J,h as Q}from"./index.c3e79e11.js";import{q as y,h as g,i as W,v as X,b as Z,a as ee,_ as te}from"./main.e162c083.js";import{D as ae,a as le}from"./Common.00b9c206.js";import{V as h}from"./ViewContent.29936a75.js";import ue from"./ViewList.301fe670.js";import oe from"./ImageUpload.ffae63c6.js";import re from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const ne={class:"query-container"},se={class:"query-btn"},ie=Vue.createTextVNode("Search"),de=Vue.createTextVNode("Add"),Ve={style:{"font-size":"26px","font-weight":"bold"}},pe={style:{"font-weight":"bold"}},me=Vue.createTextVNode("Print"),ce=Vue.createTextVNode(" Done "),fe={class:"dialog-footer"},be=Vue.createTextVNode("Cancel"),ye=Vue.createTextVNode("Confirm");var he=Vue.defineComponent({__name:"Maintain",setup(ve){VueRouter.useRouter();const U=VueRouter.useRoute(),o=Vuex.useStore(),D=o.state.roleCodeList,C=o.state.user,w=Vue.ref(null);Vue.ref(["0"]);const P=Vue.ref([{value:"expand",label:"",width:48,type:h.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:h.Operator},{value:"index",labelKey:"index",width:80},{value:"date",labelKey:"date",width:100},{value:"equipmentNo",labelKey:"equipmentNo",width:156},{value:"positionFormat",labelKey:"equipmentPosition",width:198},{value:"equipmentName",labelKey:"equipmentName",width:187},{value:"brokenReasonFormat",labelKey:"brokenReason",width:212,showOverflow:!0},{value:"brokenContent",labelKey:"brokenContent",width:213,showOverflow:!0},{value:"repairContent",labelKey:"repairContent",width:213,showOverflow:!0},{value:"replacePair",labelKey:"replacePair",width:213,showOverflow:!0},{value:"repairTypeFormat",labelKey:"repairType",width:187},{value:"stopHour",labelKey:"stopHour",width:100},{value:"partyUserFormat",labelKey:"partyUser",width:198},{value:"photoList",labelKey:"photo",width:128,type:h.Image},{value:"fileList",labelKey:"attachment",width:128,type:h.Attachment}]),E=u=>{window.open(`/industry/public/maintain?maintainId=${u.param.maintainId}`)},_={date:y(new Date,"yyyy-MM-dd"),equipmentId:"",brokenReason:"",brokenReasonList:[],brokenContent:"",repairContent:"",replacePair:"",repairType:"",stopHour:0,partyUser:C.userId,partyUserList:[C.userId],photoList:[],fileList:[],valid:!1},a=Vue.reactive({dateTimeList:[],query:{data:{maintainId:U.query.maintainId,date:"",startDate:"",endDate:"",equipmentId:"",brokenReason:"",brokenContent:"",repairContent:"",replacePair:"",repairType:"",partyUser:""},page:{page:ae,limit:le}},tableData:new Array,total:0,formData:Object.assign({},_),formSave:!1,config:{repairTypeList:[],maintainReasonList:[],brokenReasonList:[],equipmentNoList:[]},userConfigList:new Array,userOptionList:new Array,formVisible:!1,formRuleList:{date:[{required:!0,message:"Please check",trigger:"blur"}],equipmentId:[{required:!0,message:"Please check",trigger:"blur"}],brokenReason:[{required:!0,message:"Please check",trigger:"blur"}],brokenContent:[{required:!0,message:"Please check",trigger:"blur"}],partyUser:[{required:!0,message:"Please check",trigger:"blur"}],brokenReasonList:[{required:!1,type:"array",message:"Please check",min:1,max:99999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:10}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}}),v=Vue.ref(new Array);Promise.all([g("douson/config",{categoryIdList:["repairType","maintainReason","brokenReason","equipmentNo"]}),g("system/user/config/list",{})]).then(u=>{a.config=u[0].data,v.value=(u[1].list||[]).map(t=>({value:t.userId,label:t.name})),r()});const x=Vue.ref({}),r=()=>{N(!1),g("douson/admin/maintain/page",a.query).then(u=>{const t=u.list||[];a.tableData=t,a.total=u.total,x.value=u.data||{},ElementPlus.ElMessage.success("Query success")})},B=u=>{a.query.page.page=u,r()},R=u=>{a.query.page.limit=u,r()},T=()=>{a.formData=Object.assign({},_),a.formVisible=!0,a.formSave=!0},M=u=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},u)},I=()=>{w.value.validate((u,t)=>{u?a.formSave?X("douson/admin/maintain",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),r()}):L(a.formData):ElementPlus.ElMessage.error("Please check input")})},L=u=>Z("douson/admin/maintain",u).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Update success"),r()}),K=u=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/maintain",{accidentId:u.accidentId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r()})})},N=(u=!0)=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startDate=y(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endDate=y(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startDate="",a.query.data.endDate=""),u&&r()},{query:i,tableData:S,config:p,userConfigList:ke,total:F,dateTimeList:k,formData:l,formSave:$,formVisible:c,formRuleList:m}={...Vue.toRefs(a)};return(u,t)=>{const f=Vue.resolveComponent("el-input"),q=Vue.resolveComponent("el-date-picker"),d=Vue.resolveComponent("el-option"),V=Vue.resolveComponent("el-select"),b=Vue.resolveComponent("el-button"),A=Vue.resolveComponent("el-tag"),O=Vue.resolveComponent("el-link"),n=Vue.resolveComponent("el-form-item"),H=Vue.resolveComponent("el-input-number"),Y=Vue.resolveComponent("el-checkbox"),z=Vue.resolveComponent("el-form"),j=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ne,[Vue.createVNode(f,{modelValue:Vue.unref(i).data.maintainId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(i).data.maintainId=e),onKeyup:Vue.withKeys(r,["enter"]),placeholder:Vue.unref(o).state.label.accidentmaintain,clearable:"",onChange:r,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(q,{modelValue:Vue.unref(k),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(k)?k.value=e:null),onChange:N,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(V,{modelValue:Vue.unref(i).data.equipmentNo,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(i).data.equipmentNo=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.equipmentNo},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(p).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(i).data.partyUser,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(i).data.partyUser=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(i).data.brokenReason,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(i).data.brokenReason=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.brokenReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(p).brokenReasonList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",se,[Vue.createVNode(b,{icon:Vue.unref(G),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"]),Vue.createVNode(b,{icon:Vue.unref(J),onClick:T,type:"success"},{default:Vue.withCtx(()=>[de]),_:1},8,["icon"])])]),Vue.createElementVNode("div",null,[Vue.createElementVNode("span",Ve,Vue.toDisplayString(Vue.unref(o).state.label.stopHour)+":",1),Vue.createElementVNode("span",pe,Vue.toDisplayString(x.value.stopHour),1)]),Vue.createVNode(ue,{idKey:"maintainId",columnConfigList:P.value,list:Vue.unref(S),handleEdit:M,handleUpdate:L,handleDelete:K,page:Vue.unref(i).page,total:Vue.unref(F),handlePageChange:B,handleLimitChange:R,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(O,{icon:Vue.unref(Q),onClick:s=>E(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(A,{size:"small"},{default:Vue.withCtx(()=>[me]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(j,{title:Vue.unref($)?"Add":"Edit",modelValue:Vue.unref(c),"onUpdate:modelValue":t[17]||(t[17]=e=>Vue.isRef(c)?c.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",fe,[Vue.createVNode(b,{onClick:t[16]||(t[16]=e=>c.value=!1)},{default:Vue.withCtx(()=>[be]),_:1}),Vue.createVNode(b,{type:"primary",onClick:I},{default:Vue.withCtx(()=>[ye]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(z,{rules:Vue.unref(m),model:Vue.unref(l),ref_key:"formRef",ref:w,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{prop:"date",label:Vue.unref(o).state.label.date},{default:Vue.withCtx(()=>[Vue.createVNode(q,{type:"date",modelValue:Vue.unref(l).date,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(l).date=e),format:"YYYY-MM-DD",onChange:t[6]||(t[6]=e=>Vue.unref(l).date=Vue.unref(y)(Vue.unref(l).date,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"equipmentId",label:Vue.unref(o).state.label.equipmentNo},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(l).equipmentId,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(l).equipmentId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(p).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"brokenReasonList",label:Vue.unref(o).state.label.brokenReason},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(l).brokenReasonList,"onUpdate:modelValue":t[8]||(t[8]=e=>Vue.unref(l).brokenReasonList=e),clearable:"",filterable:"",multiple:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(p).brokenReasonList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"brokenContent",label:Vue.unref(o).state.label.brokenContent},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"textarea",rows:4,modelValue:Vue.unref(l).brokenContent,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(l).brokenContent=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"repairContent",label:Vue.unref(o).state.label.repairContent},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"textarea",rows:4,modelValue:Vue.unref(l).repairContent,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(l).repairContent=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"replacePair",label:Vue.unref(o).state.label.replacePair},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"textarea",rows:4,modelValue:Vue.unref(l).replacePair,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(l).replacePair=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"repairType",label:Vue.unref(o).state.label.repairType},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(l).repairType,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(l).repairType=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(p).repairTypeList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"stopHour",label:Vue.unref(o).state.label.stopHour},{default:Vue.withCtx(()=>[Vue.createVNode(H,{modelValue:Vue.unref(l).stopHour,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(l).stopHour=e),precision:0,controls:!1,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"partyUser",label:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(l).partyUserList,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(l).partyUserList=e),clearable:"",filterable:"",multiple:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"photoList",label:`${Vue.unref(o).state.label.photo}(${(Vue.unref(m).photoList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(oe,{photoList:Vue.unref(l).photoList,maxSize:Number(`${(Vue.unref(m).photoList||[]).reduce((e,s)=>s.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"fileList",label:`${Vue.unref(o).state.label.attachment}(${(Vue.unref(m).fileList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(re,{fileList:Vue.unref(l).fileList,maxSize:Number(`${(Vue.unref(m).fileList||[]).reduce((e,s)=>s.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"valid",label:Vue.unref(o).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{modelValue:Vue.unref(l).valid,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(l).valid=e),name:"valid",disabled:!Vue.unref(W)(Vue.unref(D),"admin")},{default:Vue.withCtx(()=>[ce]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),Pe=te(he,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/asset/machine/Maintain.vue"]]);export{Pe as default};
