import{s as J,p as Q,h as H}from"./index.c3e79e11.js";import{q as m,h as g,i as W,v as X,b as Z,a as ee,_ as te}from"./main.e162c083.js";import{D as le,a as ae}from"./Common.00b9c206.js";import{V}from"./ViewContent.29936a75.js";import re from"./ViewList.301fe670.js";import k from"./ImageUpload.ffae63c6.js";import I from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const oe={class:"query-container"},ue={class:"query-btn"},ne=Vue.createTextVNode("Search"),ie=Vue.createTextVNode("Add"),se=Vue.createTextVNode("Print"),de=Vue.createTextVNode(" Done "),Ve={class:"dialog-footer"},me=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm");var ce=Vue.defineComponent({__name:"Improve",setup(fe){VueRouter.useRouter();const P=VueRouter.useRoute(),u=Vuex.useStore(),M=u.state.roleCodeList,x=u.state.user,w=Vue.ref(null);Vue.ref(["0"]);const v=Vue.ref(new Array),y=Vue.ref([{value:"expand",label:"",width:48,type:V.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:V.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:116},{value:"directLeaderFormat",labelKey:"directLeader",width:88},{value:"accidentDescribe",labelKey:"accidentImproveDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"improveReason",width:276,showOverflow:!0},{value:"solve",labelKey:"improveSolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"improveOpinion",width:128},{value:"valid",labelKey:"valid",width:100,type:V.Valid},{value:"photoList",labelKey:"improvePhoto",width:128,type:V.Image},{value:"fileList",labelKey:"improveFile",width:128,type:V.Attachment},{value:"improvePhotoList",labelKey:"improveImprovePhoto",width:128,type:V.Image},{value:"improveFileList",labelKey:"improveImproveFile",width:128,type:V.Attachment}]),R=r=>{window.open(`/industry/public/improve?improveId=${r.param.improveId}`)},C={reportDate:m(new Date,"yyyy-MM-dd"),userId:x.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",improveOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{improveId:P.query.improveId,startReportDate:"",endReportDate:"",userId:"",reason:"",reasonList:[],valid:null},page:{page:le,limit:ae}},tableData:new Array,total:0,formData:Object.assign({},C),formSave:!1,config:{improveReasonList:[]},userConfigList:new Array,userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});g("douson/config",{categoryIdList:["improveReason"]}).then(r=>{l.config=r.data}),g("system/user/config/list",{}).then(r=>{l.userConfigList=r.list||[],v.value=l.userConfigList.map(t=>({value:t.userId,label:t.name})),y.value=y.value.map(t=>t),i()});const i=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=m(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=m(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),g("douson/admin/improve/page",l.query).then(r=>{const t=r.list||[];l.tableData=t,l.total=r.total,ElementPlus.ElMessage.success("Query success")})},E=r=>{l.query.page.page=r,i()},q=r=>{l.query.page.limit=r,i()},U=()=>{l.formData=Object.assign({},C),l.formData.userId=x.userId,l.formVisible=!0,l.formSave=!0},$=r=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},r)},B=()=>{w.value.validate((r,t)=>{r?l.formSave?X("douson/admin/improve",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),i()}):_(l.formData):ElementPlus.ElMessage.error("Please check input")})},_=r=>Z("douson/admin/improve",r).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),i()}),F=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/improve",{accidentId:r.accidentId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),i()})})},T=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=m(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=m(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),i()},{query:d,tableData:K,config:D,userConfigList:ve,total:S,dateTimeList:L,expandRowKeys:be,formData:a,formSave:A,formVisible:b,formRuleList:s}={...Vue.toRefs(l)};return(r,t)=>{const p=Vue.resolveComponent("el-input"),N=Vue.resolveComponent("el-date-picker"),c=Vue.resolveComponent("el-option"),f=Vue.resolveComponent("el-select"),h=Vue.resolveComponent("el-button"),O=Vue.resolveComponent("el-tag"),z=Vue.resolveComponent("el-link"),n=Vue.resolveComponent("el-form-item"),Y=Vue.resolveComponent("el-checkbox"),j=Vue.resolveComponent("el-form"),G=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",oe,[Vue.createVNode(p,{modelValue:Vue.unref(d).data.improveId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(d).data.improveId=e),onKeyup:Vue.withKeys(i,["enter"]),placeholder:Vue.unref(u).state.label.accidentImprove,clearable:"",onChange:i,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(N,{modelValue:Vue.unref(L),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(L)?L.value=e:null),onChange:T,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(f,{modelValue:Vue.unref(d).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(d).data.userId=e),onChange:i,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(f,{modelValue:Vue.unref(d).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(d).data.reason=e),onChange:i,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.improveReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D).improveReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createCommentVNode(`      <el-select v-model="query.data.valid"\r
                       @change="handlePage"\r
                       filterable\r
                       allow-create\r
                       clearable\r
                       :placeholder="store.state.label.valid"\r
                       class="search-item">\r
              <el-option\r
                  label="Done"\r
                  :value="true"\r
              />\r
              <el-option\r
                  label="Pending"\r
                  :value="false"\r
              />\r
            </el-select>`),Vue.createElementVNode("div",ue,[Vue.createVNode(h,{icon:Vue.unref(J),onClick:i,type:"primary"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.createVNode(h,{icon:Vue.unref(Q),onClick:U,type:"success"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"])])]),Vue.createVNode(re,{idKey:"improveId",columnConfigList:y.value,list:Vue.unref(K),handleEdit:$,handleUpdate:_,handleDelete:F,page:Vue.unref(d).page,total:Vue.unref(S),handlePageChange:E,handleLimitChange:q,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(z,{icon:Vue.unref(H),onClick:o=>R(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(O,{size:"small"},{default:Vue.withCtx(()=>[se]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(G,{title:Vue.unref(A)?"Add":"Edit",modelValue:Vue.unref(b),"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.isRef(b)?b.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",Ve,[Vue.createVNode(h,{onClick:t[14]||(t[14]=e=>b.value=!1)},{default:Vue.withCtx(()=>[me]),_:1}),Vue.createVNode(h,{type:"primary",onClick:B},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(j,{rules:Vue.unref(s),model:Vue.unref(a),ref_key:"formRef",ref:w,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{prop:"reportDate",label:Vue.unref(u).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(a).reportDate,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(a).reportDate=e),format:"YYYY-MM-DD",onChange:t[5]||(t[5]=e=>Vue.unref(a).reportDate=Vue.unref(m)(Vue.unref(a).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"userId",label:Vue.unref(u).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(a).userId,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(a).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"directLeader",label:Vue.unref(u).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(a).directLeader,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"accidentDescribe",label:Vue.unref(u).state.label.accidentImproveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"textarea",rows:4,modelValue:Vue.unref(a).accidentDescribe,"onUpdate:modelValue":t[8]||(t[8]=e=>Vue.unref(a).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"photoList",label:`${Vue.unref(u).state.label.improvePhoto}(${(Vue.unref(s).photoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(a).photoList,maxSize:Number(`${(Vue.unref(s).photoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"fileList",label:`${Vue.unref(u).state.label.improveFile}(${(Vue.unref(s).fileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(I,{fileList:Vue.unref(a).fileList,maxSize:Number(`${(Vue.unref(s).fileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"reason",label:Vue.unref(u).state.label.improveReason},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(a).reasonList,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.improveReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D).improveReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"solve",label:Vue.unref(u).state.label.improveSolve},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"textarea",rows:4,modelValue:Vue.unref(a).solve,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(a).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improvePhotoList",label:`${Vue.unref(u).state.label.improveImprovePhoto}(${(Vue.unref(s).improvePhotoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(a).improvePhotoList,maxSize:Number(`${(Vue.unref(s).improvePhotoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improveFileList",label:`${Vue.unref(u).state.label.improveImproveFile}(${(Vue.unref(s).improveFileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(I,{fileList:Vue.unref(a).improveFileList,maxSize:Number(`${(Vue.unref(s).improveFileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improveDescribe",label:Vue.unref(u).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"textarea",rows:4,modelValue:Vue.unref(a).improveDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"opinion",label:Vue.unref(u).state.label.improveOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"textarea",rows:4,modelValue:Vue.unref(a).opinion,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"valid",label:Vue.unref(u).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{modelValue:Vue.unref(a).valid,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).valid=e),name:"valid",disabled:!Vue.unref(W)(Vue.unref(M),"admin")},{default:Vue.withCtx(()=>[de]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),ke=te(ce,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/report/accident/Improve.vue"]]);export{ke as default};
