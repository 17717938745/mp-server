import{s as J,p as H,h as W}from"./index.c3e79e11.js";import{q as p,h as L,i as k,v as X,b as Z,a as ee,_ as te}from"./main.e162c083.js";import{D as le,a as ae}from"./Common.00b9c206.js";import{V as m}from"./ViewContent.29936a75.js";import ue from"./ViewList.301fe670.js";import P from"./ImageUpload.ffae63c6.js";import M from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const re={class:"query-container"},oe={class:"query-btn"},ie=Vue.createTextVNode("Search"),ne=Vue.createTextVNode("Add"),se=Vue.createTextVNode("Print"),de=Vue.createTextVNode(" Done "),Ve={class:"dialog-footer"},me=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm");var ce=Vue.defineComponent({__name:"Quality",setup(fe){VueRouter.useRouter();const R=VueRouter.useRoute(),o=Vuex.useStore(),x=o.state.roleCodeList,w=o.state.user,_=Vue.ref(null);Vue.ref(["0"]);const c=Vue.ref(new Array),h=Vue.ref([{value:"expand",label:"",width:48,type:m.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:m.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentQualityDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"qualityReason",width:276,showOverflow:!0},{value:"solve",labelKey:"qualitySolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"qualityOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:m.Valid},{value:"photoList",labelKey:"qualityPhoto",width:128,type:m.Image},{value:"fileList",labelKey:"qualityFile",width:128,type:m.Attachment},{value:"improvePhotoList",labelKey:"improveQualityPhoto",width:128,type:m.Image},{value:"improveFileList",labelKey:"improveQualityFile",width:128,type:m.Attachment}]),E=u=>{window.open(`/industry/public/quality?qualityId=${u.param.qualityId}`)},C={reportDate:p(new Date,"yyyy-MM-dd"),userId:w.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",qualityOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{qualityId:R.query.qualityId,startReportDate:"",endReportDate:"",userId:"",reason:"",reasonList:[],valid:null},page:{page:le,limit:ae}},tableData:new Array,total:0,formData:Object.assign({},C),formSave:!1,config:{qualityReasonList:[]},userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});Promise.all([L("douson/config",{categoryIdList:["qualityReason"]}),L("system/user/config/list",{})]).then(u=>{l.config=u[0].data,c.value=(u[1].list||[]).map(t=>({value:t.userId,label:t.name})),k(x,"gauger")&&(h.value=h.value.map(t=>(t.value==="0"&&(t.children||[]).forEach(s=>{(s.value==="dutyPerson"||s.value==="groupLeader"||s.value==="chargePerson"||s.value==="manager")&&(s.optionList=c.value)}),t))),n()});const n=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=p(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=p(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),L("douson/admin/quality/page",l.query).then(u=>{const t=u.list||[];l.tableData=t,l.total=u.total,ElementPlus.ElMessage.success("Query success")})},I=u=>{l.query.page.page=u,n()},U=u=>{l.query.page.limit=u,n()},$=()=>{l.formData=Object.assign({},C),l.formData.userId=w.userId,l.formVisible=!0,l.formSave=!0},B=u=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},u)},F=()=>{_.value.validate((u,t)=>{u?l.formSave?X("douson/admin/quality",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),n()}):D(l.formData):ElementPlus.ElMessage.error("Please check input")})},D=u=>Z("douson/admin/quality",u).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),n()}),T=u=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/quality",{qualityId:u.qualityId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),n()})})},K=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=p(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=p(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),n()},{query:V,tableData:S,config:q,total:O,dateTimeList:g,expandRowKeys:ye,formData:a,formSave:A,formVisible:b,formRuleList:d}={...Vue.toRefs(l)};return(u,t)=>{const s=Vue.resolveComponent("el-input"),N=Vue.resolveComponent("el-date-picker"),f=Vue.resolveComponent("el-option"),y=Vue.resolveComponent("el-select"),v=Vue.resolveComponent("el-button"),Q=Vue.resolveComponent("el-tag"),z=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form-item"),Y=Vue.resolveComponent("el-checkbox"),j=Vue.resolveComponent("el-form"),G=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",re,[Vue.createVNode(s,{modelValue:Vue.unref(V).data.qualityId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(V).data.qualityId=e),onKeyup:Vue.withKeys(n,["enter"]),placeholder:Vue.unref(o).state.label.accidentQuality,clearable:"",onChange:n,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(N,{modelValue:Vue.unref(g),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(g)?g.value=e:null),onChange:K,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(y,{modelValue:Vue.unref(V).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(V).data.userId=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(y,{modelValue:Vue.unref(V).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(V).data.reason=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.qualityReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q).qualityReasonList,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createCommentVNode(`      <el-select v-model="query.data.valid"\r
                       @change="handlePage"\r
                       filterable\r
                       allow-create\r
                       clearable\r
                       :placeholder="store.state.label.valid"\r
                       class="search-item">\r
              <el-option\r
                  label="Done"\r
                  :value="true"\r
              />\r
              <el-option\r
                  label="Pending"\r
                  :value="false"\r
              />\r
            </el-select>`),Vue.createElementVNode("div",oe,[Vue.createVNode(v,{icon:Vue.unref(J),onClick:n,type:"primary"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"]),Vue.createVNode(v,{icon:Vue.unref(H),onClick:$,type:"success"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"])])]),Vue.createVNode(ue,{idKey:"qualityId",columnConfigList:h.value,list:Vue.unref(S),handleEdit:B,handleUpdate:D,handleDelete:T,page:Vue.unref(V).page,total:Vue.unref(O),handlePageChange:I,handleLimitChange:U,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(z,{icon:Vue.unref(W),onClick:r=>E(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(Q,{size:"small"},{default:Vue.withCtx(()=>[se]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(G,{title:Vue.unref(A)?"Add":"Edit",modelValue:Vue.unref(b),"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.isRef(b)?b.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",Ve,[Vue.createVNode(v,{onClick:t[14]||(t[14]=e=>b.value=!1)},{default:Vue.withCtx(()=>[me]),_:1}),Vue.createVNode(v,{type:"primary",onClick:F},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(j,{rules:Vue.unref(d),model:Vue.unref(a),ref_key:"formRef",ref:_,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"reportDate",label:Vue.unref(o).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(a).reportDate,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(a).reportDate=e),format:"YYYY-MM-DD",onChange:t[5]||(t[5]=e=>Vue.unref(a).reportDate=Vue.unref(p)(Vue.unref(a).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"userId",label:Vue.unref(o).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(y,{modelValue:Vue.unref(a).userId,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(a).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"directLeader",label:Vue.unref(o).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(y,{modelValue:Vue.unref(a).directLeader,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"accidentDescribe",label:Vue.unref(o).state.label.accidentQualityDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).accidentDescribe,"onUpdate:modelValue":t[8]||(t[8]=e=>Vue.unref(a).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"photoList",label:`${Vue.unref(o).state.label.qualityPhoto}(${(Vue.unref(d).photoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{photoList:Vue.unref(a).photoList,maxSize:Number(`${(Vue.unref(d).photoList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"fileList",label:`${Vue.unref(o).state.label.qualityFile}(${(Vue.unref(d).fileList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(M,{fileList:Vue.unref(a).fileList,maxSize:Number(`${(Vue.unref(d).fileList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"reason",label:Vue.unref(o).state.label.qualityReason},{default:Vue.withCtx(()=>[Vue.createVNode(y,{modelValue:Vue.unref(a).reasonList,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.qualityReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q).qualityReasonList,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"solve",label:Vue.unref(o).state.label.qualitySolve},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).solve,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(a).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improvePhotoList",label:`${Vue.unref(o).state.label.improveQualityPhoto}(${(Vue.unref(d).improvePhotoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{photoList:Vue.unref(a).improvePhotoList,maxSize:Number(`${(Vue.unref(d).improvePhotoList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improveFileList",label:`${Vue.unref(o).state.label.improveQualityFile}(${(Vue.unref(d).improveFileList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(M,{fileList:Vue.unref(a).improveFileList,maxSize:Number(`${(Vue.unref(d).improveFileList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improveDescribe",label:Vue.unref(o).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).improveDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"opinion",label:Vue.unref(o).state.label.qualityOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).opinion,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"valid",label:Vue.unref(o).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{modelValue:Vue.unref(a).valid,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).valid=e),name:"valid",disabled:!Vue.unref(k)(Vue.unref(x),"admin")},{default:Vue.withCtx(()=>[de]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),qe=te(ce,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/report/accident/Quality.vue"]]);export{qe as default};
