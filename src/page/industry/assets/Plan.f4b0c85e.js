import{s as G,p as J,h as Q}from"./index.c3e79e11.js";import{q as f,h as x,i as N,v as H,b as W,a as X,_ as Z}from"./main.e162c083.js";import{D as ee,a as te}from"./Common.00b9c206.js";import{V as d}from"./ViewContent.29936a75.js";import le from"./ViewList.301fe670.js";import T from"./ImageUpload.ffae63c6.js";import ae from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const oe={class:"query-container"},ue={class:"query-btn"},re=Vue.createTextVNode("Search"),ne=Vue.createTextVNode("Add "),se=Vue.createTextVNode("Print"),ie=Vue.createTextVNode(" Done "),de={class:"dialog-footer"},Ve=Vue.createTextVNode("Cancel"),me=Vue.createTextVNode("Confirm");var pe=Vue.defineComponent({__name:"Plan",setup(ce){VueRouter.useRouter();const l=Vuex.useStore(),P=l.state.roleCodeList,L=Vue.ref(null),b=Vue.ref(new Array),g=Vue.ref([{value:"expand",label:"",width:48,type:d.Expand},{value:"operator",labelKey:"viewAndEdit",width:223,type:d.Operator},{value:"index",labelKey:"index",width:78},{value:"createDate",label:l.state.label.createDate,labelKey:"createDate",width:102},{value:"creatorFormat",label:l.state.label.username,labelKey:"username",width:110},{value:"departmentFormat",label:l.state.label.department,labelKey:"department",width:154},{value:"optimizeTypeFormat",label:l.state.label.optimizeType,labelKey:"optimizeType",width:128},{value:"existsProblem",label:l.state.label.existsProblem,labelKey:"existsProblem",width:334,type:d.Text,showOverflow:!0},{value:"solveScheme",label:l.state.label.solveScheme,labelKey:"solveScheme",width:334,type:d.Text,showOverflow:!0},{value:"responsiblePerson",label:l.state.label.responsiblePerson,labelKey:"responsiblePerson",width:128},{value:"planCompleteTime",label:l.state.label.planCompleteTime,labelKey:"planCompleteTime",width:102},{value:"awardAmountFormat",label:l.state.label.awardAmount,labelKey:"awardAmount",width:87},{value:"valid",label:l.state.label.valid,labelKey:"valid",width:68,type:d.Valid},{value:"beforePhotoList",label:l.state.label.photoList,labelKey:"beforePlanThreePhoto",width:269,type:d.Image},{value:"afterPhotoList",label:l.state.label.photoList,labelKey:"afterPlanThreePhoto",width:269,type:d.Image},{value:"attachmentList",label:l.state.label.photoList,labelKey:"supportAttachment",width:269,type:d.Attachment}]),_={planId:"",creator:l.state.user.username,createDate:f(new Date,"yyyy-MM-dd"),department:"",optimizeType:"",existsProblem:"",solveScheme:"",responsiblePerson:l.state.user.username,planCompleteTime:"",beforePhotoList:[],afterPhotoList:[],attachmentList:[],awardAmount:0,valid:"",photoList:new Array},a=Vue.reactive({dateTimeList:[],photoVisible:!1,photoList:new Array,expandRowKeys:new Array,query:{data:{startCreateDate:"",endCreateDate:"",department:"",optimizeType:"",existsProblem:"",username:"",responsiblePerson:"",valid:""},page:{page:ee,limit:te}},tableData:new Array,total:0,formData:Object.assign({},_),formSave:!1,config:{processProcedureList:[],testDeviceList:[],customerShortNameList:[],departmentList:[],optimizeTypeList:[]},userConfigList:new Array,formVisible:!1,formRuleList:{creator:[{required:!0,message:"Please check",trigger:"blur"}],createDate:[{required:!0,message:"Please check",trigger:"blur"}],department:[{required:!0,message:"Please check",trigger:"blur"}],optimizeType:[{required:!0,message:"Please check",trigger:"blur"}],existsProblem:[{required:!0,message:"Please check",trigger:"blur"}],solveScheme:[{required:!0,message:"Please check",trigger:"blur"}],responsiblePerson:[{required:!0,message:"Please check",trigger:"blur"}],planCompleteTime:[{required:!0,message:"Please check",trigger:"blur"}],beforePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:5}],afterPhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:5}],attachmentList:[{required:!1,type:"array",message:"Please check",min:0,max:4}]}}),D=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startCreateDate=f(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endCreateDate=f(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startCreateDate="",a.query.data.endCreateDate=""),n()},M=u=>{window.open(`/industry/public/plan?planId=${u.param.planId}`)};x("douson/config").then(u=>{a.config=u.data});const n=()=>{x("douson/admin/plan/page",a.query).then(u=>{a.tableData=u.list,a.total=u.total,ElementPlus.ElMessage.success("Query success")})},E=u=>{a.query.page.page=u,n()},S=u=>{a.query.page.limit=u,n()};x("system/user/config/list",{}).then(u=>{a.userConfigList=u.list||[],b.value=a.userConfigList.map(t=>({value:t.userId,label:t.name})),g.value=g.value.map(t=>(t.value==="responsiblePerson"&&(t.type=d.SelectEdit,t.optionList=b.value),t)),n()});const B=()=>{a.formData=Object.assign({},_),a.formVisible=!0,a.formSave=!0},U=u=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},u)},A=()=>{L.value.validate(u=>{u&&(a.formSave?H("douson/admin/plan",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),n()}):k(a.formData))})},k=u=>W("douson/admin/plan",u).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Update success"),n()}),z=u=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{X("douson/admin/plan",{planId:u.planId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),n()})})},{expandRowKeys:fe,query:s,tableData:q,config:h,userConfigList:be,total:$,dateTimeList:C,formData:o,formSave:K,formVisible:v,formRuleList:m,photoVisible:he,photoList:ve}={...Vue.toRefs(a)};return(u,t)=>{const w=Vue.resolveComponent("el-date-picker"),V=Vue.resolveComponent("el-option"),p=Vue.resolveComponent("el-select"),c=Vue.resolveComponent("el-input"),y=Vue.resolveComponent("el-button"),F=Vue.resolveComponent("el-tag"),I=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form-item"),Y=Vue.resolveComponent("el-input-number"),R=Vue.resolveComponent("el-checkbox"),O=Vue.resolveComponent("el-form"),j=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",oe,[Vue.createVNode(w,{modelValue:Vue.unref(C),"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.isRef(C)?C.value=e:null),onChange:D,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.department,"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.unref(s).data.department=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.department,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).departmentList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.optimizeType,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(s).data.optimizeType=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.optimizeType,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).optimizeTypeList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(c,{modelValue:Vue.unref(s).data.existsProblem,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(s).data.existsProblem=e),onChange:n,placeholder:Vue.unref(l).state.label.existsProblem,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(c,{modelValue:Vue.unref(s).data.username,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(s).data.username=e),onChange:n,placeholder:Vue.unref(l).state.label.username,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.responsiblePerson,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(s).data.responsiblePerson=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.responsiblePerson,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.valid,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(s).data.valid=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(V,{label:"Done",value:!0}),Vue.createVNode(V,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",ue,[Vue.createVNode(y,{icon:Vue.unref(G),onClick:n,type:"primary"},{default:Vue.withCtx(()=>[re]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(J),onClick:B,type:"success"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.createCommentVNode('<el-button :icon="Plus" @click="handleSaveModal" type="success">Add</el-button>')])]),Vue.createVNode(le,{idKey:"planId",columnConfigList:g.value,list:Vue.unref(q),handleEdit:U,handleUpdate:k,handleDelete:Vue.unref(N)(Vue.unref(P),"admin")?z:null,page:Vue.unref(s).page,total:Vue.unref($),handlePageChange:E,handleLimitChange:S,"detail-link":!1},{operator:Vue.withCtx(e=>[Vue.createVNode(I,{icon:Vue.unref(Q),onClick:r=>M(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(F,{size:"small"},{default:Vue.withCtx(()=>[se]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","handleDelete","page","total"]),Vue.createVNode(j,{title:Vue.unref(K)?"Add":"Edit",modelValue:Vue.unref(v),"onUpdate:modelValue":t[20]||(t[20]=e=>Vue.isRef(v)?v.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",de,[Vue.createVNode(y,{onClick:t[19]||(t[19]=e=>v.value=!1)},{default:Vue.withCtx(()=>[Ve]),_:1}),Vue.createVNode(y,{type:"primary",onClick:A},{default:Vue.withCtx(()=>[me]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(O,{rules:Vue.unref(m),model:Vue.unref(o),ref_key:"formRef",ref:L,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"createDate",label:Vue.unref(l).state.label.createDate},{default:Vue.withCtx(()=>[Vue.createVNode(w,{type:"date",modelValue:Vue.unref(o).createDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(o).createDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(o).createDate=Vue.unref(f)(Vue.unref(o).createDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"creator",label:Vue.unref(l).state.label.username},{default:Vue.withCtx(()=>[Vue.createVNode(c,{modelValue:Vue.unref(o).creator,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(o).creator=e),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"department",label:Vue.unref(l).state.label.department},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).department,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(o).department=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.department,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).departmentList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"optimizeType",label:Vue.unref(l).state.label.optimizeType},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).optimizeType,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(o).optimizeType=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.optimizeType,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).optimizeTypeList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"existsProblem",label:Vue.unref(l).state.label.existsProblem},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:Vue.unref(o).existsProblem,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(o).existsProblem=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"solveScheme",label:Vue.unref(l).state.label.solveScheme},{default:Vue.withCtx(()=>[Vue.createVNode(c,{type:"textarea",rows:4,modelValue:Vue.unref(o).solveScheme,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(o).solveScheme=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"responsiblePerson",label:Vue.unref(l).state.label.responsiblePerson},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).responsiblePerson,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(o).responsiblePerson=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.responsiblePerson},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"planCompleteTime",label:Vue.unref(l).state.label.planCompleteTime},{default:Vue.withCtx(()=>[Vue.createVNode(w,{type:"date",modelValue:Vue.unref(o).planCompleteTime,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(o).planCompleteTime=e),format:"YYYY-MM-DD",onChange:t[16]||(t[16]=e=>Vue.unref(o).planCompleteTime=Vue.unref(f)(Vue.unref(o).planCompleteTime,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"beforePhotoList",label:`${Vue.unref(l).state.label.beforePlanThreePhoto}(${(Vue.unref(m).beforePhotoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(T,{photoList:Vue.unref(o).beforePhotoList,maxSize:Number(`${(Vue.unref(m).beforePhotoList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"afterPhotoList",label:`${Vue.unref(l).state.label.afterPlanThreePhoto}(${(Vue.unref(m).afterPhotoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(T,{photoList:Vue.unref(o).afterPhotoList,maxSize:Number(`${(Vue.unref(m).afterPhotoList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"attachmentList",label:`${Vue.unref(l).state.label.supportAttachment}(${(Vue.unref(m).attachmentList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(ae,{fileList:Vue.unref(o).attachmentList,maxSize:Number(`${(Vue.unref(m).attachmentList||[]).reduce((e,r)=>r.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"awardAmount",label:Vue.unref(l).state.label.awardAmount},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{min:0,modelValue:Vue.unref(o).awardAmount,"onUpdate:modelValue":t[17]||(t[17]=e=>Vue.unref(o).awardAmount=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"valid",label:Vue.unref(l).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(R,{modelValue:Vue.unref(o).valid,"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.unref(o).valid=e),name:"valid",disabled:!Vue.unref(N)(Vue.unref(P),"admin")},{default:Vue.withCtx(()=>[ie]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),Te=Z(pe,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/report/Plan.vue"]]);export{Te as default};
