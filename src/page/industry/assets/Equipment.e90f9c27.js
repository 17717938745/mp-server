import{s as G,p as J,h as Q}from"./index.c3e79e11.js";import{q as h,h as q,i as D,v as H,b as W,a as X,_ as Z}from"./main.e162c083.js";import{D as ee,a as te}from"./Common.00b9c206.js";import{V as b}from"./ViewContent.29936a75.js";import le from"./ViewList.301fe670.js";import ae from"./ImageUpload.ffae63c6.js";import ue from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const oe={class:"query-container"},re={class:"query-btn"},ne=Vue.createTextVNode("Search"),ie=Vue.createTextVNode("Add"),se=Vue.createTextVNode("Print"),de={class:"dialog-footer"},Ve=Vue.createTextVNode("Cancel"),me=Vue.createTextVNode("Confirm");var pe=Vue.defineComponent({__name:"Equipment",setup(ce){VueRouter.useRouter();const U=VueRouter.useRoute(),o=Vuex.useStore(),N=o.state.roleCodeList,w=o.state.user,C=Vue.ref(null);Vue.ref(["0"]);const g=Vue.ref(new Array),E=Vue.ref([{value:"expand",label:"",width:48,type:b.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:b.Operator},{value:"index",labelKey:"index",width:80},{value:"equipmentNo",labelKey:"equipmentNo",width:146},{value:"equipmentName",labelKey:"equipmentName",width:232},{value:"specification",labelKey:"specification",width:265},{value:"date",labelKey:"date",width:100},{value:"useUserFormat",labelKey:"useUser",width:100},{value:"remark",labelKey:"remark",width:232,showOverflow:!0},{value:"detailDescribe",labelKey:"equipmentDetailDescribe",width:232,showOverflow:!0},{value:"gasolineType",labelKey:"gasolineType",width:187,showOverflow:!0},{value:"chargeUserFormat",labelKey:"chargeUser",width:135,showOverflow:!0},{value:"positionFormat",labelKey:"equipmentPosition",width:189},{value:"photoList",labelKey:"photo",width:128,type:b.Image},{value:"fileList",labelKey:"supportAttachment",width:128,type:b.Attachment}]),P=u=>{window.open(`/industry/public/equipment?equipmentId=${u.param.equipmentId}`)},x={equipmentId:"",equipmentNo:"",equipmentName:"",specification:"",date:h(new Date,"yyyy-MM-dd"),useUserList:[w.userId],remark:"",detailDescribe:"",gasolineType:"",chargeUser:"",chargeUserList:[],position:"",photoList:[],fileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{equipmentId:U.query.equipmentId,equipmentNo:"",equipmentName:"",specification:"",startDate:"",endDate:"",useUser:"",remark:"",detailDescribe:"",chargeUser:"",position:""},page:{page:ee,limit:te}},tableData:new Array,total:0,formData:Object.assign({},x),formSave:!1,config:{equipmentNoList:[],equipmentPositionList:[]},userOptionList:new Array,formVisible:!1,formRuleList:{equipmentNo:[{required:!0,message:"Please check",trigger:"blur"}],equipmentName:[{required:!0,message:"Please check",trigger:"blur"}],specification:[{required:!0,message:"Please check",trigger:"blur"}],date:[{required:!0,message:"Please check",trigger:"blur"}],useUserList:[{required:!0,type:"array",message:"Please check",min:1,max:999}],position:[{required:!0,message:"Please check",trigger:"blur"}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:10}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:10}]}});Promise.all([q("douson/config",{categoryIdList:["equipmentNo","equipmentPosition"]}),q("system/user/config/list",{})]).then(u=>{l.config=u[0].data,g.value=(u[1].list||[]).map(t=>({value:t.userId,label:t.name})),r()});const r=()=>{L(!1),q("douson/admin/equipment/page",l.query).then(u=>{const t=u.list||[];l.tableData=t,l.total=u.total,ElementPlus.ElMessage.success("Query success")})},M=u=>{l.query.page.page=u,r()},B=u=>{l.query.page.limit=u,r()},T=()=>{l.formData=Object.assign({},x),l.formVisible=!0,l.formSave=!0},K=u=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},u)},I=u=>!!D(N,"equipmentManager"),S=()=>{C.value.validate((u,t)=>{u?l.formSave?H("douson/admin/equipment",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),r()}):k(l.formData):ElementPlus.ElMessage.error("Please check input")})},k=u=>W("douson/admin/equipment",u).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),r()}),$=u=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{X("douson/admin/equipment",{accidentId:u.accidentId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r()})})},L=(u=!0)=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startDate=h(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endDate=h(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startDate="",l.query.data.endDate=""),u&&r()},{query:i,tableData:R,config:y,total:A,dateTimeList:v,expandRowKeys:fe,formData:a,formSave:F,formVisible:c,formRuleList:V}={...Vue.toRefs(l)};return(u,t)=>{const d=Vue.resolveComponent("el-input"),_=Vue.resolveComponent("el-date-picker"),m=Vue.resolveComponent("el-option"),p=Vue.resolveComponent("el-select"),f=Vue.resolveComponent("el-button"),O=Vue.resolveComponent("el-tag"),Y=Vue.resolveComponent("el-link"),n=Vue.resolveComponent("el-form-item"),z=Vue.resolveComponent("el-form"),j=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",oe,[Vue.createVNode(d,{modelValue:Vue.unref(i).data.equipmentId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(i).data.equipmentId=e),onKeyup:Vue.withKeys(r,["enter"]),placeholder:Vue.unref(o).state.label.equipmentId,clearable:"",onChange:r,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(_,{modelValue:Vue.unref(v),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(v)?v.value=e:null),onChange:L,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(p,{modelValue:Vue.unref(i).data.equipmentNo,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(i).data.equipmentNo=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.equipmentNo},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(y).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(i).data.equipmentName,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(i).data.equipmentName=e),onChange:r,placeholder:Vue.unref(o).state.label.equipmentName,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(i).data.specification,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(i).data.specification=e),onChange:r,placeholder:Vue.unref(o).state.label.specification,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(i).data.position,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(i).data.position=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.equipmentPosition},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(y).equipmentPositionList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",re,[Vue.createVNode(f,{icon:Vue.unref(G),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.unref(D)(Vue.unref(N),"equipmentManager")?(Vue.openBlock(),Vue.createBlock(f,{key:0,icon:Vue.unref(J),onClick:T,type:"success"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"])):Vue.createCommentVNode("v-if",!0)])]),Vue.createVNode(le,{idKey:"equipmentId",columnConfigList:E.value,list:Vue.unref(R),handleEdit:K,handleEditShow:I,handleUpdate:k,handleDelete:Vue.unref(w).username==="admin"?$:null,page:Vue.unref(i).page,total:Vue.unref(A),handlePageChange:M,handleLimitChange:B,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(Y,{icon:Vue.unref(Q),onClick:s=>P(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(O,{size:"small"},{default:Vue.withCtx(()=>[se]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","handleDelete","page","total"]),Vue.createVNode(j,{title:Vue.unref(F)?"Add":"Edit",modelValue:Vue.unref(c),"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.isRef(c)?c.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",de,[Vue.createVNode(f,{onClick:t[17]||(t[17]=e=>c.value=!1)},{default:Vue.withCtx(()=>[Ve]),_:1}),Vue.createVNode(f,{type:"primary",onClick:S},{default:Vue.withCtx(()=>[me]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(z,{rules:Vue.unref(V),model:Vue.unref(a),ref_key:"formRef",ref:C,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{prop:"equipmentNo",label:Vue.unref(o).state.label.equipmentId},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:Vue.unref(a).equipmentNo,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(a).equipmentNo=e),placeholder:Vue.unref(o).state.label.equipmentNo},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"equipmentName",label:Vue.unref(o).state.label.equipmentName},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:Vue.unref(a).equipmentName,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).equipmentName=e),placeholder:Vue.unref(o).state.label.equipmentName},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"specification",label:Vue.unref(o).state.label.specification},{default:Vue.withCtx(()=>[Vue.createVNode(d,{modelValue:Vue.unref(a).specification,"onUpdate:modelValue":t[8]||(t[8]=e=>Vue.unref(a).specification=e),placeholder:Vue.unref(o).state.label.specification},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"date",label:Vue.unref(o).state.label.date},{default:Vue.withCtx(()=>[Vue.createVNode(_,{type:"date",modelValue:Vue.unref(a).date,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).date=e),format:"YYYY-MM-DD",onChange:t[10]||(t[10]=e=>Vue.unref(a).date=Vue.unref(h)(Vue.unref(a).date,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"useUserList",label:Vue.unref(o).state.label.useUser},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).useUserList,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).useUserList=e),clearable:"",filterable:"",multiple:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(g.value,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"remark",label:Vue.unref(o).state.label.remark},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).remark,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).remark=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"detailDescribe",label:Vue.unref(o).state.label.equipmentDetailDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).detailDescribe,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).detailDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"gasolineType",label:Vue.unref(o).state.label.gasolineType},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).gasolineType,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(a).gasolineType=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"chargeUser",label:Vue.unref(o).state.label.chargeUser},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).chargeUserList,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(a).chargeUserList=e),clearable:"",filterable:"",multiple:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(g.value,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"position",label:Vue.unref(o).state.label.equipmentPosition},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).position,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(a).position=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(y).equipmentPositionList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"photoList",label:`${Vue.unref(o).state.label.photo}(${(Vue.unref(V).photoList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(ae,{photoList:Vue.unref(a).photoList,maxSize:Number(`${(Vue.unref(V).photoList||[]).reduce((e,s)=>s.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"fileList",label:`${Vue.unref(o).state.label.attachment}(${(Vue.unref(V).fileList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(ue,{fileList:Vue.unref(a).fileList,maxSize:Number(`${(Vue.unref(V).fileList||[]).reduce((e,s)=>s.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),ke=Z(pe,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/asset/machine/Equipment.vue"]]);export{ke as default};
