import{s as J,p as Q,h as H}from"./index.c3e79e11.js";import{q as p,h as g,i as W,v as X,b as Z,a as ee,_ as te}from"./main.e162c083.js";import{D as le,a as ae}from"./Common.00b9c206.js";import{V as m}from"./ViewContent.29936a75.js";import re from"./ViewList.301fe670.js";import k from"./ImageUpload.ffae63c6.js";import E from"./FileUpload.fea7c9aa.js";import"./IndustryUtil.35abe8a4.js";import"./TableViewContent.c1fd5c92.js";import"./TableColumnViewContent.779ce4dc.js";const oe={class:"query-container"},ue={class:"query-btn"},ne=Vue.createTextVNode("Search"),se=Vue.createTextVNode("Add"),ie=Vue.createTextVNode("Print"),de=Vue.createTextVNode(" Done "),Ve={class:"dialog-footer"},me=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm");var ce=Vue.defineComponent({__name:"Event",setup(fe){VueRouter.useRouter();const P=VueRouter.useRoute(),u=Vuex.useStore(),M=u.state.roleCodeList,x=u.state.user,w=Vue.ref(null);Vue.ref(["0"]);const c=Vue.ref(new Array),y=Vue.ref([{value:"expand",label:"",width:48,type:m.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:m.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentEventDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"eventReason",width:276,showOverflow:!0},{value:"solve",labelKey:"eventSolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"eventOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:m.Valid},{value:"photoList",labelKey:"eventPhoto",width:128,type:m.Image},{value:"fileList",labelKey:"eventFile",width:128,type:m.Attachment},{value:"improvePhotoList",labelKey:"improveEventPhoto",width:128,type:m.Image},{value:"improveFileList",labelKey:"improveEventFile",width:128,type:m.Attachment}]),R=r=>{window.open(`/industry/public/event?eventId=${r.param.eventId}`)},C={reportDate:p(new Date,"yyyy-MM-dd"),userId:x.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",eventOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{eventId:P.query.eventId,startReportDate:"",endReportDate:"",userId:"",reason:"",reasonList:[],valid:null},page:{page:le,limit:ae}},tableData:new Array,total:0,formData:Object.assign({},C),formSave:!1,config:{eventReasonList:[]},userConfigList:new Array,userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});g("douson/config",{categoryIdList:["eventReason"]}).then(r=>{l.config=r.data}),g("system/user/config/list",{}).then(r=>{l.userConfigList=r.list||[],c.value=l.userConfigList.map(t=>({value:t.userId,label:t.name})),y.value=y.value.map(t=>(t.value==="0"&&(t.children||[]).forEach(i=>{(i.value==="dutyPerson"||i.value==="groupLeader"||i.value==="chargePerson"||i.value==="manager")&&(i.optionList=c.value)}),t)),s()});const s=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=p(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=p(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),g("douson/admin/event/page",l.query).then(r=>{const t=r.list||[];l.tableData=t,l.total=r.total,ElementPlus.ElMessage.success("Query success")})},I=r=>{l.query.page.page=r,s()},q=r=>{l.query.page.limit=r,s()},U=()=>{l.formData=Object.assign({},C),l.formData.userId=x.userId,l.formVisible=!0,l.formSave=!0},$=r=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},r)},B=()=>{w.value.validate((r,t)=>{r?l.formSave?X("douson/admin/event",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),s()}):_(l.formData):ElementPlus.ElMessage.error("Please check input")})},_=r=>Z("douson/admin/event",r).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),s()}),F=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/event",{eventId:r.eventId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),s()})})},T=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=p(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=p(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),s()},{query:V,tableData:K,config:D,userConfigList:ve,total:S,dateTimeList:L,expandRowKeys:be,formData:a,formSave:A,formVisible:b,formRuleList:d}={...Vue.toRefs(l)};return(r,t)=>{const i=Vue.resolveComponent("el-input"),N=Vue.resolveComponent("el-date-picker"),f=Vue.resolveComponent("el-option"),v=Vue.resolveComponent("el-select"),h=Vue.resolveComponent("el-button"),O=Vue.resolveComponent("el-tag"),z=Vue.resolveComponent("el-link"),n=Vue.resolveComponent("el-form-item"),Y=Vue.resolveComponent("el-checkbox"),j=Vue.resolveComponent("el-form"),G=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",oe,[Vue.createVNode(i,{modelValue:Vue.unref(V).data.eventId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(V).data.eventId=e),onKeyup:Vue.withKeys(s,["enter"]),placeholder:Vue.unref(u).state.label.accidentEvent,clearable:"",onChange:s,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(N,{modelValue:Vue.unref(L),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(L)?L.value=e:null),onChange:T,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(v,{modelValue:Vue.unref(V).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(V).data.userId=e),onChange:s,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(v,{modelValue:Vue.unref(V).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(V).data.reason=e),onChange:s,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.eventReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D).eventReasonList,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createCommentVNode(`      <el-select v-model="query.data.valid"\r
                       @change="handlePage"\r
                       filterable\r
                       allow-create\r
                       clearable\r
                       :placeholder="store.state.label.valid"\r
                       class="search-item">\r
              <el-option\r
                  label="Done"\r
                  :value="true"\r
              />\r
              <el-option\r
                  label="Pending"\r
                  :value="false"\r
              />\r
            </el-select>`),Vue.createElementVNode("div",ue,[Vue.createVNode(h,{icon:Vue.unref(J),onClick:s,type:"primary"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.createVNode(h,{icon:Vue.unref(Q),onClick:U,type:"success"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"])])]),Vue.createVNode(re,{idKey:"eventId",columnConfigList:y.value,list:Vue.unref(K),handleEdit:$,handleUpdate:_,handleDelete:F,page:Vue.unref(V).page,total:Vue.unref(S),handlePageChange:I,handleLimitChange:q,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(z,{icon:Vue.unref(H),onClick:o=>R(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(O,{size:"small"},{default:Vue.withCtx(()=>[ie]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(G,{title:Vue.unref(A)?"Add":"Edit",modelValue:Vue.unref(b),"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.isRef(b)?b.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",Ve,[Vue.createVNode(h,{onClick:t[14]||(t[14]=e=>b.value=!1)},{default:Vue.withCtx(()=>[me]),_:1}),Vue.createVNode(h,{type:"primary",onClick:B},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(j,{rules:Vue.unref(d),model:Vue.unref(a),ref_key:"formRef",ref:w,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(n,{prop:"reportDate",label:Vue.unref(u).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(a).reportDate,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(a).reportDate=e),format:"YYYY-MM-DD",onChange:t[5]||(t[5]=e=>Vue.unref(a).reportDate=Vue.unref(p)(Vue.unref(a).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"userId",label:Vue.unref(u).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:Vue.unref(a).userId,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(a).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"directLeader",label:Vue.unref(u).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:Vue.unref(a).directLeader,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"accidentDescribe",label:Vue.unref(u).state.label.accidentEventDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"textarea",rows:4,modelValue:Vue.unref(a).accidentDescribe,"onUpdate:modelValue":t[8]||(t[8]=e=>Vue.unref(a).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"photoList",label:`${Vue.unref(u).state.label.eventPhoto}(${(Vue.unref(d).photoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(a).photoList,maxSize:Number(`${(Vue.unref(d).photoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"fileList",label:`${Vue.unref(u).state.label.eventFile}(${(Vue.unref(d).fileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(a).fileList,maxSize:Number(`${(Vue.unref(d).fileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"reason",label:Vue.unref(u).state.label.eventReason},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:Vue.unref(a).reasonList,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.eventReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(D).eventReasonList,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"solve",label:Vue.unref(u).state.label.eventSolve},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"textarea",rows:4,modelValue:Vue.unref(a).solve,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(a).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improvePhotoList",label:`${Vue.unref(u).state.label.improveEventPhoto}(${(Vue.unref(d).improvePhotoList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(a).improvePhotoList,maxSize:Number(`${(Vue.unref(d).improvePhotoList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improveFileList",label:`${Vue.unref(u).state.label.improveEventFile}(${(Vue.unref(d).improveFileList||[]).reduce((e,o)=>`Min: ${o.min}, Max: ${o.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(a).improveFileList,maxSize:Number(`${(Vue.unref(d).improveFileList||[]).reduce((e,o)=>o.max,999)}`)},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"improveDescribe",label:Vue.unref(u).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"textarea",rows:4,modelValue:Vue.unref(a).improveDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"opinion",label:Vue.unref(u).state.label.eventOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(i,{type:"textarea",rows:4,modelValue:Vue.unref(a).opinion,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(n,{prop:"valid",label:Vue.unref(u).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{modelValue:Vue.unref(a).valid,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).valid=e),name:"valid",disabled:!Vue.unref(W)(Vue.unref(M),"admin")},{default:Vue.withCtx(()=>[de]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}}),ke=te(ce,[["__file","D:/code/mp-server/src/page/src/page/industry/admin/report/accident/Event.vue"]]);export{ke as default};
