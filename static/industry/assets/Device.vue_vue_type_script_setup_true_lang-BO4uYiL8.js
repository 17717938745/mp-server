import{s as P}from"./index-DfY7MOwJ.js";import{h as s,o as n,v as y,w as f}from"./main-Dirrnzcr.js";import{D as F,a as I}from"./Common-dWa9BEsb.js";import{_ as x}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";const M={class:"query-container"},k={class:"query-btn"},T=Vue.createTextVNode("Search"),B=Vue.defineComponent({__name:"Device",setup(N){VueRouter.useRouter();const l=Vuex.useStore();l.state.user,l.state.roleCodeList,Vue.ref(null);const m=Vue.ref(new Array),d=Vue.ref([{value:"index",labelKey:"index",width:51,mergeKey:["deviceId"]},{value:"deviceIdFormat",labelKey:"device",width:125,mergeKey:["deviceId"]},{value:"userIdFormat",labelKey:"user",width:168},{value:"deviceSumDeviceCompletePercentFormat",labelKey:"reportSumDeviceCompletePercent",width:100},{value:"deviceSumDeviceUsePercentFormat",labelKey:"reportSumDeviceUsePercent",width:100},{value:"deviceReportDateCount",labelKey:"reportDateCount",width:68},{value:"deviceDeviceCompletePercentFormat",labelKey:"reportDeviceCompletePercent",width:100},{value:"deviceDeviceUsePercentFormat",labelKey:"reportDeviceUsePercent",width:100},{value:"devicePercentDiffFormat",labelKey:"reportDiff",width:60},{value:"totalCount",labelKey:"totalCount",width:57,mergeKey:["deviceId"]},{value:"userIdCount",labelKey:"userCount",width:57,mergeKey:["deviceId"]},{value:"reportDateCount",labelKey:"reportDateCount",width:57,mergeKey:["deviceId"]},{value:"deviceCompletePercentFormat",labelKey:"reportDeviceCompletePercent",width:100,mergeKey:["deviceId"]},{value:"deviceUsePercentFormat",labelKey:"reportDeviceUsePercent",width:100,mergeKey:["deviceId"]},{value:"percentDiffFormat",labelKey:"reportDiff",width:60,mergeKey:["deviceId"]},{value:"designNumberCount",labelKey:"designNumberCount",width:50,mergeKey:["deviceId"]}]);Promise.all([s("douson/config",{categoryIdList:["device","processProcedure"]}),s("system/user/config/list",{})]).then(o=>{a.config=o[0].data||{},m.value=(o[1].list||[]).map(e=>({value:e.userId,label:e.name}))});const h=["userIdFormat","deviceSumDeviceCompletePercentFormat","deviceSumDeviceUsePercentFormat","deviceReportDateCount","deviceDeviceCompletePercentFormat","deviceDeviceUsePercentFormat","devicePercentDiffFormat"],i=Vue.ref(!0),v=o=>{d.value=d.value.map(e=>(h.indexOf(e.value)>=0&&(e.hide=!o),e))};v(i.value);const a=Vue.reactive({dateTimeList:[y(),f()],userConfigList:new Array,query:{data:{department:"",vocationType:"",testDevice:"",user:"",date:"",startReportDate:n(y(),"yyyy-MM-dd"),endReportDate:n(f(),"yyyy-MM-dd")},page:{page:I,limit:F}},tableData:new Array,config:{vocationTypeList:[],departmentList:[]}}),D=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=n(a.dateTimeList[0],"yyyy-MM-dd"),a.query.data.endReportDate=n(a.dateTimeList[1],"yyyy-MM-dd")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),r()},C=({row:o,rowIndex:e})=>Math.abs(o.percentDiff)>=.2?"row-error":"",r=()=>{s("douson/report/summary/device",a.query.data).then(o=>{a.tableData=o.list,ElementPlus.ElMessage.success("Query success")})};r();const{query:u,tableData:g,config:b,dateTimeList:c}={...Vue.toRefs(a)};return(o,e)=>{const w=Vue.resolveComponent("el-date-picker"),p=Vue.resolveComponent("el-option"),V=Vue.resolveComponent("el-select"),_=Vue.resolveComponent("el-button"),K=Vue.resolveComponent("el-switch"),L=Vue.resolveComponent("el-space");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",M,[Vue.createVNode(w,{modelValue:Vue.unref(c),"onUpdate:modelValue":e[0]||(e[0]=t=>Vue.isRef(c)?c.value=t:null),onChange:D,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start due date","end-placeholder":"End due date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(V,{modelValue:Vue.unref(u).data.userId,"onUpdate:modelValue":e[1]||(e[1]=t=>Vue.unref(u).data.userId=t),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.user},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(m.value,t=>(Vue.openBlock(),Vue.createBlock(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(u).data.testDevice,"onUpdate:modelValue":e[2]||(e[2]=t=>Vue.unref(u).data.testDevice=t),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(l).state.label.testDevice,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(b).testDeviceList,t=>(Vue.openBlock(),Vue.createBlock(p,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",k,[Vue.createVNode(_,{icon:Vue.unref(P),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[T]),_:1},8,["icon"])])]),Vue.createElementVNode("div",null,[Vue.createVNode(L,{wrap:""},{default:Vue.withCtx(()=>[Vue.createVNode(K,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value=t),"active-text":"Show more","inactive-text":"Hide info",onChange:v},null,8,["modelValue"])]),_:1})]),Vue.createVNode(x,{idKey:"id",columnConfigList:d.value,list:Vue.unref(g),handleTableRowClassName:C},{operator:Vue.withCtx(t=>[]),_:1},8,["columnConfigList","list"])])}}});export{B as _};
