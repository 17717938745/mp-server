import{d as y,e as b,f as C,j as x,b as M,s as k,r as N,k as R,l as T,n as S,_ as q}from"./main-Dirrnzcr.js";import{u as L,a as E}from"./index-DfY7MOwJ.js";const _=d=>(Vue.pushScopeId("data-v-44fd40f8"),d=d(),Vue.popScopeId(),d),P={class:"login-wrap"},D={class:"ms-login"},I=_(()=>Vue.createElementVNode("div",{class:"ms-title"},"管理平台",-1)),B=Vue.createTextVNode("登录"),O=_(()=>Vue.createElementVNode("span",{class:"login-tips"},"Tips：欢迎使用后台管理系统",-1)),U=Vue.createTextVNode(" 已登录直接跳转 "),j=Vue.defineComponent({__name:"Sign",setup(d){const r=VueRouter.useRouter(),f=Vue.ref(null),n=Vuex.useStore(),F=n.state;n.commit("clearTagList");const K=Object.keys(y()).length>0?y():{username:"",password:"",autoLogin:!0},w=Vue.reactive({signData:K,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}),l=Vue.ref(!1),{signData:c,rules:v}={...Vue.toRefs(w)},V=()=>{const h=b(F.menuTreeList),t=C("goBack")||"";if(t.length>0&&r.hasRoute(t))r.push(t);else{const e=x(h,"/industry");r.hasRoute(e)||(console.log(`firstPath: ${e}`),l.value=!1),r.push(e)}},g=(h=!0)=>{f.value.validate(t=>{if(t&&!l.value)l.value=!0,M("system/sign-in",{username:w.signData.username,passwordEncrypt:k(w.signData.password||"")}).then(e=>{const o=e.data.user,u=[{id:"-1",path:"industry",component:"industry",white:!0,showFlag:!0,children:[{id:"-1",path:"admin",component:"admin",nameKey:"admin",white:!0,showFlag:!0,children:[{children:[],id:"-1",path:"dashboard",component:"dashboard",nameKey:"dashboard",white:!1,showFlag:!0},{children:[],id:"-1",path:"forum",component:"forum",nameKey:"forum",white:!1,showFlag:!0},{id:"-1",path:"system",component:"",nameKey:"systemManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"user",component:"user",nameKey:"userManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"scheduling",component:"scheduling",nameKey:"schedulingCnc",white:!1,showFlag:!0},{children:[],id:"-1",path:"vocation",component:"vocation",nameKey:"vocationRecord",white:!1,showFlag:!0},{children:[],id:"-1",path:"account",component:"account",nameKey:"accountManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"sign",component:"sign",nameKey:"signInHistory",white:!1,showFlag:o.username==="admin"}]},{id:"-1",path:"product",component:"",nameKey:"productManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"param",component:"param",nameKey:"paramManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"device",component:"device",nameKey:"deviceManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"order",component:"order",nameKey:"orderManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"index",component:"index",nameKey:"productQuotaManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"report",component:"report",nameKey:"userRunReport",white:!1,showFlag:!0},{children:[],id:"-1",path:"assembly",component:"assembly",nameKey:"completeMachineAssemblyRecord",white:!1,showFlag:!0},{children:[],id:"-1",path:"box",component:"box",nameKey:"boxFlagCard",white:!1,showFlag:!0}]},{id:"-1",path:"report",component:"",nameKey:"reportManage",white:!1,showFlag:!0,children:[{children:[{children:[],id:"-1",path:"event",component:"event",nameKey:"accidentEvent",white:!1,showFlag:!0},{children:[],id:"-1",path:"improve",component:"improve",nameKey:"accidentImprove",white:!1,showFlag:!0},{children:[],id:"-1",path:"quality",component:"quality",nameKey:"accidentQuality",white:!1,showFlag:!0},{children:[],id:"-1",path:"crash",component:"crash",nameKey:"accidentCrash",white:!1,showFlag:!0},{children:[],id:"-1",path:"trouble",component:"trouble",nameKey:"accidentTrouble",white:!1,showFlag:!0}],id:"-1",path:"accident",component:"",nameKey:"accidentReport",white:!1,showFlag:!0},{children:[],id:"-1",path:"disqualification",component:"disqualification",nameKey:"disqualificationOrder",white:!1,showFlag:!0},{children:[],id:"-1",path:"plan",component:"plan",nameKey:"keepImprove",white:!1,showFlag:!0}]},{id:"-1",path:"design",component:"",nameKey:"designManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"material",component:"material",nameKey:"material",white:!1,showFlag:!0},{children:[],id:"-1",path:"task",component:"task",nameKey:"taskManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"inventory",component:"inventory",nameKey:"inventoryOutOfPlan",white:!1,showFlag:!0}]},{id:"-1",path:"asset",component:"",nameKey:"assetManage",white:!1,showFlag:!0,children:[{children:[],id:"-1",path:"device",component:"device",nameKey:"deviceCheckLedger",white:!1,showFlag:!0},{children:[],id:"-1",path:"computer",component:"computer",nameKey:"computerManage",white:!1,showFlag:!0},{children:[],id:"-1",path:"template",component:"template",nameKey:"templateManage",white:!1,showFlag:!0},{children:[{children:[],id:"-1",path:"equipment",component:"equipment",nameKey:"machineEquipment",white:!1,showFlag:!0},{children:[],id:"-1",path:"maintain",component:"maintain",nameKey:"machineMaintainRepair",white:!1,showFlag:!0}],id:"-1",path:"machine",nameKey:"productMachine",white:!1,showFlag:!0}]}]}]}],m=(s,a="")=>{for(let p=0;p<s.length;p++){const i=s[p];i.id=(a&&a+"-")+p,i.name=n.state.label[i.nameKey||""],(i.children||[]).length>0&&m(i.children||[],i.id)}};m(u,""),n.commit("setMenuTreeList",u),n.commit("setUser",o),n.commit("setRoleCodeList",e.data.user.roleList.map(s=>s.roleCode)),N(r),V()}).catch(e=>{e.code===74004&&h&&(R(""),T(""),S().then(o=>{g(!1)})),l.value=!1});else return!1})};return(h,t)=>{const e=Vue.resolveComponent("el-button"),o=Vue.resolveComponent("el-input"),u=Vue.resolveComponent("el-form-item"),m=Vue.resolveComponent("el-link"),s=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",P,[Vue.createElementVNode("div",D,[I,Vue.createVNode(s,{model:Vue.unref(c),rules:Vue.unref(v),ref_key:"login",ref:f,"label-width":"0px",class:"ms-content"},{default:Vue.withCtx(()=>[Vue.createVNode(u,{prop:"username"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{modelValue:Vue.unref(c).username,"onUpdate:modelValue":t[0]||(t[0]=a=>Vue.unref(c).username=a),tabindex:"1",autofocus:"",placeholder:"username"},{prepend:Vue.withCtx(()=>[Vue.createVNode(e,{icon:Vue.unref(L)},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),Vue.createVNode(u,{prop:"password"},{default:Vue.withCtx(()=>[Vue.createVNode(o,{type:"password",placeholder:"password",modelValue:Vue.unref(c).password,"onUpdate:modelValue":t[1]||(t[1]=a=>Vue.unref(c).password=a),onKeyup:Vue.withKeys(g,["enter"]),tabindex:"1"},{prepend:Vue.withCtx(()=>[Vue.createVNode(e,{icon:Vue.unref(E)},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"])]),_:1}),Vue.createVNode(e,{class:"login-btn",type:"primary",onClick:g,disabled:l.value},{default:Vue.withCtx(()=>[B]),_:1},8,["disabled"]),O,Vue.createVNode(m,{class:"login-helper",onClick:V},{default:Vue.withCtx(()=>[U]),_:1})]),_:1},8,["model","rules"])])])}}}),A=q(j,[["__scopeId","data-v-44fd40f8"]]);export{A as default};
