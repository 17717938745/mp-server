import{n as f,B as _}from"./index-DfY7MOwJ.js";import{p as i,t as g}from"./main-Dirrnzcr.js";const k={key:0,class:"resources-upload"},C=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload image",-1),B=Vue.defineComponent({__name:"ImageUpload",props:{photoList:null,maxSize:{default:4},disabled:{type:Boolean,default:!1}},setup(c,{expose:d}){const e=c;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),d({});const n={},p=(l,o)=>{console.log("file change, length: "+o.length)},m=l=>(console.log("before upload file: "+l.uid),n[l.uid]=l,l),h=l=>{const o=Object.keys(n),a=Math.max((e.maxSize||0)-e.photoList.length,0);o.length>a?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${a}, actual: ${o.length}`),o.forEach(t=>{delete n[t]})):o.length>0&&(Promise.all(o.map(t=>{const r=n[t],s=new FormData;return s.set("filename",r.name),s.set("file",r),g("index/img",s)})).then(t=>(t.forEach(r=>{const s=r.data;e.photoList.push({photoUrl:s.url,photoCompressUrl:s.compressUrl})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.error("Upload failed"),Promise.reject())),o.forEach(t=>{delete n[t]}))};return Vue.watch(()=>e.photoList,l=>{},{immediate:!0}),(l,o)=>{const a=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload"),r=Vue.resolveComponent("el-image"),s=Vue.resolveComponent("el-empty");return e.photoList?(Vue.openBlock(),Vue.createElementBlock("div",k,[e.disabled?Vue.createCommentVNode("",!0):Vue.withDirectives((Vue.openBlock(),Vue.createBlock(t,{key:0,action:"#","show-file-list":!1,"on-change":p,"before-upload":m,"http-request":h,multiple:"",drag:!0,disabled:e.disabled},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(a,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(f),{style:{width:"5em",height:"5em"}})]),_:1}),C])]),_:1},8,["disabled"])),[[Vue.vShow,e.photoList.length<e.maxSize]]),e.photoList&&e.photoList.length>0?(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,{key:1},Vue.renderList(e.photoList,(u,V)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:u.photoUrl,class:"resources-view"},[Vue.createVNode(r,{src:Vue.unref(i)(u.photoCompressUrl,""),fit:"cover","preview-src-list":[Vue.unref(i)(u.photoUrl,"")],"initial-index":0,class:"image-view"},null,8,["src","preview-src-list"]),e.disabled?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(a,{key:0,class:"close-btn",size:28,onClick:v=>e.photoList.splice(V,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(_))]),_:2},1032,["onClick"]))]))),128)):e.disabled?(Vue.openBlock(),Vue.createBlock(s,{key:2,description:"Empty"})):Vue.createCommentVNode("",!0)])):Vue.createCommentVNode("",!0)}}});export{B as _};
