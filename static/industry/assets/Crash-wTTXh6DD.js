import{o as C,h as b,i as M,b as S,y as F}from"./main-Dirrnzcr.js";import{V as h,_ as O}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{h as T}from"./IndustryUtil-CgRifmxX.js";import{o as z,e as A}from"./index-DfY7MOwJ.js";import{_ as Y}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as Q}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";const j={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"flex-start","margin-bottom":"20px",position:"absolute",width:"100%",top:"20px"},id:"printContainer"},G={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",width:"595px"}},H={style:{"text-align":"center"}},J={style:{"font-size":"36px"}},W=Vue.createTextVNode(" 设备撞机事故 Sự cố va đập thiết bị "),X={class:"douson-serial-no"},Z=Vue.createTextVNode("` "),ee=Vue.createTextVNode(" Done "),te={class:"dialog-footer"},le=Vue.createTextVNode("Cancel"),ae=Vue.createTextVNode("Confirm"),ce=Vue.defineComponent({__name:"Crash",setup(oe){VueRouter.useRouter();const y=VueRouter.useRoute(),a=Vuex.useStore(),w=a.state.roleCodeList,L="crashId",_=Vue.ref(null),p=Vue.ref(new Array),N=Vue.ref([{value:"reportDate",labelKey:"date",width:100},{value:"equipmentNo",labelKey:"equipmentNo",width:156},{value:"userIdFormat",labelKey:"partyUser",width:116},{value:"directLeaderFormat",labelKey:"directLeader",width:88},{value:"accidentDescribe",labelKey:"accidentQualityDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"qualityReason",width:276,showOverflow:!0},{value:"solve",labelKey:"qualitySolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"qualityOpinion",width:128},{value:"valid",labelKey:"valid",width:100,type:h.Valid},{value:"photoList",labelKey:"qualityPhoto",width:128,type:h.Image},{value:"fileList",labelKey:"qualityFile",width:128,type:h.Attachment}]),l=Vue.ref({reportDate:C(new Date,"yyyy-MM-dd"),userId:"",userIdList:[],directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",opinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]}),i=Vue.reactive({userConfigList:new Array,formVisible:!1,formSave:!1,config:{crashReasonList:[]},formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userIdList:[{required:!0,type:"array",message:"Please check",min:1,max:999}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});Promise.all([b("douson/config",{categoryIdList:["crashReason"]}),b("system/user/config/list",{})]).then(o=>{i.config=o[0].data,p.value=(o[1].list||[]).map(t=>({value:t.userId,label:t.name})),m()});const m=()=>{b("douson/crash",{crashId:y.query.crashId}).then(o=>{l.value=o.data||{},ElementPlus.ElMessage.success("Query success"),setTimeout(()=>{var c;const t=(((c=document.getElementById("printDescription"))==null?void 0:c.offsetHeight)||1024)+450+"px",s=document.getElementById("printContainer");s&&(s.style.height=t)},1e3)})};m();const g=()=>{i.formVisible=!0},k=()=>{_.value.validate((o,t)=>{o?D(l.value):ElementPlus.ElMessage.error("Please check input")})},D=o=>S("douson/admin/crash",o).then(()=>{i.formVisible=!1,ElementPlus.ElMessage.success("Update success"),m()}),E=()=>{const o=F(`/industry/public/crash?crashId=${y.query.crashId}`),t=document.createElement("input");t.value=o,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),ElementPlus.ElMessage.success("Copy success")},{formVisible:d,formSave:B,config:q,formRuleList:n}={...Vue.toRefs(i)};return(o,t)=>{const s=Vue.resolveComponent("el-icon"),c=Vue.resolveComponent("el-descriptions-item"),P=Vue.resolveComponent("el-descriptions"),I=Vue.resolveComponent("el-date-picker"),u=Vue.resolveComponent("el-form-item"),f=Vue.resolveComponent("el-option"),v=Vue.resolveComponent("el-select"),V=Vue.resolveComponent("el-input"),$=Vue.resolveComponent("el-checkbox"),R=Vue.resolveComponent("el-form"),x=Vue.resolveComponent("el-button"),U=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",j,[Vue.createElementVNode("div",G,[Vue.createElementVNode("h1",H,[Vue.createElementVNode("span",J,[W,Vue.createVNode(s,{style:{"vertical-align":"middle"},onClick:E},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(z))]),_:1}),l.value.valid?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(s,{key:0,class:"print-hide",style:{"vertical-align":"middle"},onClick:g},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(A))]),_:1}))])]),Vue.createElementVNode("div",X,Vue.toDisplayString(l.value.serialNo),1),Vue.createVNode(P,{column:1,style:{width:"100%"},border:"",id:"printDescription"},{default:Vue.withCtx(()=>[Z,(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(T)(N.value,[],!0,!1,[],[]),(e,r)=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.labelKey?Vue.unref(a).state.label[e.labelKey]:e.label,align:"center","label-class-name":"crash-print-label description-print-border","class-name":"description-print-border"},{default:Vue.withCtx(()=>[Vue.createVNode(O,{idKey:L,viewConfig:e,row:l.value},{expand:Vue.withCtx(K=>[Vue.renderSlot(o.$slots,"expand",{param:K.param})]),_:2},1032,["viewConfig","row"])]),_:2},1032,["label"]))),128))]),_:3})]),Vue.createVNode(U,{title:Vue.unref(B)?"Add":"Edit",modelValue:Vue.unref(d),"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.isRef(d)?d.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",te,[Vue.createVNode(x,{onClick:t[10]||(t[10]=e=>d.value=!1)},{default:Vue.withCtx(()=>[le]),_:1}),Vue.createVNode(x,{type:"primary",onClick:k},{default:Vue.withCtx(()=>[ae]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(R,{rules:Vue.unref(n),model:l.value,ref_key:"formRef",ref:_,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(u,{prop:"reportDate",label:Vue.unref(a).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(I,{type:"date",modelValue:l.value.reportDate,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value.reportDate=e),format:"YYYY-MM-DD",onChange:t[1]||(t[1]=e=>l.value.reportDate=Vue.unref(C)(l.value.reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"userIdList",label:Vue.unref(a).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:l.value.userIdList,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.userIdList=e),clearable:"",multiple:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(p.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"directLeader",label:Vue.unref(a).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:l.value.directLeader,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(p.value,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"accidentDescribe",label:Vue.unref(a).state.label.accidentQualityDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"textarea",rows:4,modelValue:l.value.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"photoList",label:`${Vue.unref(a).state.label.qualityPhoto}(${(Vue.unref(n).photoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{photoList:l.value.photoList,maxSize:+`${(Vue.unref(n).photoList||[]).reduce((e,r)=>r.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"fileList",label:`${Vue.unref(a).state.label.qualityFile}(${(Vue.unref(n).fileList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(Q,{fileList:l.value.fileList,maxSize:+`${(Vue.unref(n).fileList||[]).reduce((e,r)=>r.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"reason",label:Vue.unref(a).state.label.crashReason},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:l.value.reasonList,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.crashReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q).crashReasonList,e=>(Vue.openBlock(),Vue.createBlock(f,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"solve",label:Vue.unref(a).state.label.qualitySolve},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"textarea",rows:4,modelValue:l.value.solve,"onUpdate:modelValue":t[6]||(t[6]=e=>l.value.solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"improveDescribe",label:Vue.unref(a).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"textarea",rows:4,modelValue:l.value.improveDescribe,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value.improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"opinion",label:Vue.unref(a).state.label.qualityOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"textarea",rows:4,modelValue:l.value.opinion,"onUpdate:modelValue":t[8]||(t[8]=e=>l.value.opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(u,{prop:"valid",label:Vue.unref(a).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode($,{modelValue:l.value.valid,"onUpdate:modelValue":t[9]||(t[9]=e=>l.value.valid=e),name:"valid",disabled:!Vue.unref(M)(Vue.unref(w),"admin")},{default:Vue.withCtx(()=>[ee]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{ce as default};
