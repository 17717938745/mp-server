import{s as K,p as ue,C as oe,t as ne}from"./index-DfY7MOwJ.js";import{i as I,h as E,o as U,b as P,a as ie}from"./main-Dirrnzcr.js";import{D as se,a as de}from"./Common-dWa9BEsb.js";import{V as i}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as $}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const re={class:"query-container"},ce={class:"query-btn"},he=Vue.createTextVNode("Search"),Ve=Vue.createTextVNode("Add "),me=Vue.createTextVNode("Copy"),fe=Vue.createTextVNode("Detail"),pe={class:"douson-flex",style:{"text-align":"center","justify-content":"center","align-items":"center"}},ge={class:"query-container"},ye={class:"query-btn"},ve=Vue.createTextVNode("Search"),be={class:"dialog-footer"},Le=Vue.createTextVNode("Cancel"),Te=Vue.createTextVNode("Confirm"),Fe=Vue.defineComponent({__name:"Scheduling",setup(Ee){VueRouter.useRouter();const n=Vuex.useStore(),q=n.state.user,A=n.state.roleCodeList,w=Vue.ref(null),s=Vue.ref(new Array),v=I(A,"schedulingManager"),D=Vue.ref([{value:"expand",label:"",width:48,type:i.Expand},{value:"operator",labelKey:"viewAndEdit",width:203,type:i.Operator},{value:"dateMonthFormat",labelKey:"date",width:201},{value:"scheduleDayTimeLabel",labelKey:"scheduleMiddle",width:103},{value:"scheduleMiddleLabel",labelKey:"scheduleMiddle",width:103},{value:"scheduleEveningLabel",labelKey:"scheduleEvening",width:103},{value:"scheduleDayTime12Label",labelKey:"scheduleDayTime12",width:103},{value:"scheduleEvening12Label",labelKey:"scheduleEvening12",width:103},{value:"scheduleDayTimeTechnologyGroupLabel",labelKey:"scheduleDayTimeTechnologyGroup",width:129},{value:"scheduleEveningTechnologyGroupLabel",labelKey:"scheduleEveningTechnologyGroup",width:129}]),h=(t,e)=>I(M.value||[],e),y=Vue.ref([{value:"deviceNumberFormat",labelKey:"deviceNumber",width:126},{value:"scheduleDayTimeFormat",originValue:"scheduleDayTimeList",labelKey:"scheduleDayTime",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleMiddleFormat",originValue:"scheduleMiddleList",labelKey:"scheduleMiddle",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleEveningFormat",originValue:"scheduleEveningList",labelKey:"scheduleEvening",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleDayTime12Format",originValue:"scheduleDayTime12List",labelKey:"scheduleDayTime12",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleEvening12Format",originValue:"scheduleEvening12List",labelKey:"scheduleEvening12",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleDayTimeTechnologyGroupFormat",originValue:"scheduleDayTimeTechnologyGroupList",labelKey:"scheduleDayTimeTechnologyGroup",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"},{value:"scheduleEveningTechnologyGroupFormat",originValue:"scheduleEveningTechnologyGroupList",labelKey:"scheduleEveningTechnologyGroup",width:129,listShowType:1,valueHighLight:h,staticIdList:"-1"}]),C={dateMonth:"",scheduleDayTimeLabel:"",scheduleMiddleLabel:"",scheduleEveningLabel:"",scheduleDayTime12Label:"",scheduleEvening12Label:"",scheduleDayTimeTechnologyGroupLabel:"",scheduleEveningTechnologyGroupLabel:""};Vue.ref([]);const N=Vue.ref([]),x=Vue.ref({}),M=Vue.ref([]),u=Vue.reactive({photoVisible:!1,photoList:new Array,expandRowKeys:new Array,query:{data:{schedulingId:"",dateMonth:"",startDateMonth:"",endDateMonth:"",deviceNumber:"",scheduleDayTime:"",scheduleMiddle:"",scheduleEvening:"",scheduleDayTime12:"",scheduleEvening12:"",scheduleDayTimeTechnologyGroup:"",scheduleEveningTechnologyGroup:""},page:{page:de,limit:se}},tableData:new Array,total:0,formData:Object.assign({},C),formState:0,config:{testDeviceList:[]},userConfigList:new Array,formVisible:!1,formRuleList:{dateMonth:[{required:!0,message:"Please check",trigger:"blur"}]}});let V=1;const d={};d[V++]="scheduleDayTimeProfessionFormat",d[V++]="scheduleMiddleProfessionFormat",d[V++]="scheduleEveningProfessionFormat",d[V++]="scheduleDayTime12ProfessionFormat",d[V++]="scheduleEvening12ProfessionFormat",d[V++]="scheduleDayTimeTechnologyGroupProfessionFormat",d[V++]="scheduleEveningTechnologyGroupProfessionFormat";const k=({row:t,column:e,rowIndex:a,columnIndex:f})=>{const g=d[f];return g&&t[g]&&t[g].indexOf("组长")>=0,""},m=()=>{E("/douson/scheduling/page",u.query).then(t=>{u.tableData=t.list,u.total=t.total,ElementPlus.ElMessage.success("Query success")})},B=t=>{u.query.page.page=t,m()},R=t=>{u.query.page.limit=t,m()};Promise.all([E("douson/config",{categoryIdList:["device"]}),E("system/user/config/list",{})]).then(t=>{u.config=t[0].data,s.value=(t[1].list||[]).map(e=>({value:e.userId,label:e.name})),D.value=D.value.map(e=>e),y.value=y.value.map(e=>(v&&(e.value==="scheduleDayTimeFormat"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleMiddleFormat"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleEveningFormat"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleDayTime12Format"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleEvening12Format"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleDayTimeTechnologyGroupFormat"?(e.type=i.SelectEdit,e.optionList=s.value):e.value==="scheduleEveningTechnologyGroupFormat"&&(e.type=i.SelectEdit,e.optionList=s.value)),e)),m()});const H=()=>{u.formData=Object.assign({},C),u.formVisible=!0,u.formState=0},O=t=>{u.formVisible=!0,u.formState=1,u.formData=Object.assign({},t)},j=()=>{w.value.validate(t=>{t&&F(u.formData)})},F=t=>P("douson/scheduling/merge",t).then(()=>{u.formVisible=!1,ElementPlus.ElMessage.success(`${L===0?"Save":L===1?"Update":"Copy"} success`),m()}),z=t=>P("douson/scheduling/detail",t).then(()=>{ElementPlus.ElMessage.success("Update success"),b()}),Q=t=>{u.formVisible=!0,u.formState=2,u.formData=Object.assign({},t,{schedulingId:"",schedulingCopyId:t.schedulingId,dateMonth:""})},b=()=>{E("/douson/scheduling/detail",u.query.data).then(t=>{_.value=!0,N.value=t.data.schedulingList,M.value=t.data.highLightUserIdList;const e=t.data.scheduling;x.value=e,y.value=y.value.map(a=>(a.value==="scheduleDayTimeFormat"?(a.labelKey=null,a.label=e.scheduleDayTimeLabel):a.value==="scheduleMiddleFormat"?(a.labelKey=null,a.label=e.scheduleMiddleLabel):a.value==="scheduleEveningFormat"?(a.labelKey=null,a.label=e.scheduleEveningLabel):a.value==="scheduleDayTime12Format"?(a.labelKey=null,a.label=e.scheduleDayTime12Label):a.value==="scheduleEvening12Format"?(a.labelKey=null,a.label=e.scheduleEvening12Label):a.value==="scheduleDayTimeTechnologyGroupFormat"?(a.labelKey=null,a.label=e.scheduleDayTimeTechnologyGroupLabel):a.value==="scheduleEveningTechnologyGroupFormat"&&(a.labelKey=null,a.label=e.scheduleEveningTechnologyGroupLabel),a)),ElementPlus.ElMessage.success("Query success")})},_=Vue.ref(!1),W=t=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ie("/douson/scheduling",{schedulingId:t.schedulingId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),m()})})},{query:r,tableData:J,config:X,total:Y,formData:o,formState:L,formVisible:T,formRuleList:Z}={...Vue.toRefs(u)};return(t,e)=>{const a=Vue.resolveComponent("el-date-picker"),f=Vue.resolveComponent("el-button"),g=Vue.resolveComponent("el-tag"),G=Vue.resolveComponent("el-link"),ee=Vue.resolveComponent("el-option"),le=Vue.resolveComponent("el-select"),S=Vue.resolveComponent("el-dialog"),c=Vue.resolveComponent("el-form-item"),p=Vue.resolveComponent("el-input"),te=Vue.resolveComponent("el-form"),ae=Vue.resolveComponent("el-affix");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",re,[Vue.createVNode(a,{type:"week",modelValue:Vue.unref(r).data.dateMonth,"onUpdate:modelValue":e[0]||(e[0]=l=>Vue.unref(r).data.dateMonth=l),format:"[Week] ww",onChange:e[1]||(e[1]=l=>{Vue.unref(r).data.dateMonth=Vue.unref(U)(Vue.unref(r).data.dateMonth,"yyyy-MM-dd"),m()})},null,8,["modelValue"]),Vue.createElementVNode("div",ce,[Vue.createVNode(f,{icon:Vue.unref(K),onClick:m,type:"primary"},{default:Vue.withCtx(()=>[he]),_:1},8,["icon"]),Vue.unref(v)?(Vue.openBlock(),Vue.createBlock(f,{key:0,icon:Vue.unref(ue),onClick:H,type:"success"},{default:Vue.withCtx(()=>[Ve]),_:1},8,["icon"])):Vue.createCommentVNode("",!0)])]),Vue.createVNode($,{idKey:"schedulingId",columnConfigList:D.value,list:Vue.unref(J),handleEdit:O,handleEditShow:()=>Vue.unref(v),handleUpdate:F,handleDelete:Vue.unref(q).username==="admin"||Vue.unref(v)?W:null,page:Vue.unref(r).page,total:Vue.unref(Y),handlePageChange:B,handleLimitChange:R,"detail-link":!1,handleTableCellClassName:k},{operator:Vue.withCtx(l=>[Vue.createVNode(G,{icon:Vue.unref(oe),onClick:()=>{Q(l.param)},class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(g,{size:"small",type:"info"},{default:Vue.withCtx(()=>[me]),_:1})]),_:2},1032,["icon","onClick"]),Vue.createVNode(G,{icon:Vue.unref(ne),onClick:()=>{Vue.unref(r).data.schedulingId=l.param.schedulingId,b()},class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(g,{size:"small"},{default:Vue.withCtx(()=>[fe]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","handleEditShow","handleDelete","page","total"]),Vue.createVNode(S,{title:"Scheduling",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=l=>_.value=l),width:"90%","close-on-click-modal":!1},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",pe,[Vue.createElementVNode("h1",null,Vue.toDisplayString(x.value.schedulingTitle),1)]),Vue.createElementVNode("div",ge,[Vue.createVNode(le,{modelValue:Vue.unref(r).data.deviceNumber,"onUpdate:modelValue":e[2]||(e[2]=l=>Vue.unref(r).data.deviceNumber=l),onChange:b,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(n).state.label.testDevice,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(X).testDeviceList,l=>(Vue.openBlock(),Vue.createBlock(ee,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",ye,[Vue.createVNode(f,{icon:Vue.unref(K),onClick:b,type:"primary"},{default:Vue.withCtx(()=>[ve]),_:1},8,["icon"])])]),Vue.createVNode($,{idKey:"schedulingDetailId",columnConfigList:y.value,list:N.value,handleUpdate:z,"detail-link":!1,handleTableCellClassName:k},{operator:Vue.withCtx(l=>[]),_:1},8,["columnConfigList","list"])]),_:1},8,["modelValue"]),Vue.createVNode(S,{title:Vue.unref(L)===0?"Save":Vue.unref(L)===1?"Update":"Copy",modelValue:Vue.unref(T),"onUpdate:modelValue":e[14]||(e[14]=l=>Vue.isRef(T)?T.value=l:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createVNode(ae,{position:"bottom",offset:20},{default:Vue.withCtx(()=>[Vue.createElementVNode("span",be,[Vue.createVNode(f,{onClick:e[13]||(e[13]=l=>T.value=!1)},{default:Vue.withCtx(()=>[Le]),_:1}),Vue.createVNode(f,{type:"primary",onClick:j},{default:Vue.withCtx(()=>[Te]),_:1})])]),_:1})]),default:Vue.withCtx(()=>[Vue.createVNode(te,{rules:Vue.unref(Z),model:Vue.unref(o),ref_key:"formRef",ref:w,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{prop:"dateMonth",label:Vue.unref(n).state.label.date},{default:Vue.withCtx(()=>[Vue.createVNode(a,{type:"week",modelValue:Vue.unref(o).dateMonth,"onUpdate:modelValue":e[4]||(e[4]=l=>Vue.unref(o).dateMonth=l),format:"[Week] ww",onChange:e[5]||(e[5]=l=>Vue.unref(o).dateMonth=Vue.unref(U)(Vue.unref(o).dateMonth,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleDayTimeLabel",label:`${Vue.unref(n).state.label.scheduleDayTime} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleDayTimeLabel,"onUpdate:modelValue":e[6]||(e[6]=l=>Vue.unref(o).scheduleDayTimeLabel=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleMiddleLabel",label:`${Vue.unref(n).state.label.scheduleMiddle} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleMiddleLabel,"onUpdate:modelValue":e[7]||(e[7]=l=>Vue.unref(o).scheduleMiddleLabel=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleEveningLabel",label:`${Vue.unref(n).state.label.scheduleEvening} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleEveningLabel,"onUpdate:modelValue":e[8]||(e[8]=l=>Vue.unref(o).scheduleEveningLabel=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleDayTime12Label",label:`${Vue.unref(n).state.label.scheduleDayTime12} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleDayTime12Label,"onUpdate:modelValue":e[9]||(e[9]=l=>Vue.unref(o).scheduleDayTime12Label=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleEvening12Label",label:`${Vue.unref(n).state.label.scheduleEvening12} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleEvening12Label,"onUpdate:modelValue":e[10]||(e[10]=l=>Vue.unref(o).scheduleEvening12Label=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleDayTimeTechnologyGroupLabel",label:`${Vue.unref(n).state.label.scheduleDayTimeTechnologyGroup} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleDayTimeTechnologyGroupLabel,"onUpdate:modelValue":e[11]||(e[11]=l=>Vue.unref(o).scheduleDayTimeTechnologyGroupLabel=l)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(c,{prop:"scheduleEveningTechnologyGroupLabel",label:`${Vue.unref(n).state.label.scheduleEveningTechnologyGroup} label`},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(o).scheduleEveningTechnologyGroupLabel,"onUpdate:modelValue":e[12]||(e[12]=l=>Vue.unref(o).scheduleEveningTechnologyGroupLabel=l)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{Fe as default};
