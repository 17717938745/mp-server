import{s as H,p as W,m as X}from"./index-DfY7MOwJ.js";import{o as f,h as N,i as Z,q as ee,b as te,a as le}from"./main-Dirrnzcr.js";import{D as ae,a as oe}from"./Common-dWa9BEsb.js";import{V as c}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as re}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as I}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as P}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ue={class:"query-container"},ne={class:"query-btn"},ie=Vue.createTextVNode("Search"),se=Vue.createTextVNode("Add"),de=Vue.createTextVNode("Print"),Ve=Vue.createTextVNode(" Done "),me={class:"dialog-footer"},pe=Vue.createTextVNode("Cancel"),ce=Vue.createTextVNode("Confirm"),De=Vue.defineComponent({__name:"Improve",setup(fe){VueRouter.useRouter();const q=VueRouter.useRoute(),o=Vuex.useStore(),M=o.state.roleCodeList,L=o.state.user,D=Vue.ref(null);Vue.ref(["0"]);const v=Vue.ref(new Array),w=Vue.ref([{value:"expand",label:"",width:48,type:c.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:c.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:108},{value:"equipmentNo",labelKey:"equipmentNo",width:118},{value:"toolDescribe",labelKey:"toolDescribe",width:189},{value:"userIdFormat",labelKey:"partyUser",width:116},{value:"directLeaderFormat",labelKey:"directLeader",width:108},{value:"accidentDescribe",labelKey:"accidentImproveDescribe",width:289,showOverflow:!0},{value:"reasonFormat",labelKey:"improveReason",width:276,showOverflow:!0},{value:"solve",labelKey:"improveSolve",width:276,showOverflow:!0},{value:"opinion",labelKey:"improveOpinion",width:128},{value:"valid",labelKey:"valid",width:100,type:c.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"photoList",labelKey:"improvePhoto",width:128,type:c.Image},{value:"fileList",labelKey:"improveFile",width:128,type:c.Attachment},{value:"improvePhotoList",labelKey:"improveImprovePhoto",width:128,type:c.Image},{value:"improveFileList",labelKey:"improveImproveFile",width:128,type:c.Attachment}]),E=({row:r,column:t,rowIndex:d,columnIndex:h})=>x>=0&&x===h?"row-red":"",R=r=>{window.open(`/industry/public/improve?improveId=${r.param.improveId}`)},_={reportDate:f(new Date,"yyyy-MM-dd"),userId:L.userId,userIdList:[L.userId],directLeader:"",equipmentId:"",toolDescribe:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",improveOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{improveId:q.query.improveId,startReportDate:"",endReportDate:"",userId:"",accidentDescribe:"",reason:"",serialNo:"",reasonList:[],valid:!1},page:{page:oe,limit:ae}},tableData:new Array,total:0,formData:Object.assign({},_),formSave:!1,config:{improveReasonList:[],equipmentNoList:[]},userConfigList:new Array,userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],userIdList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});N("douson/config",{categoryIdList:["improveReason","equipmentNo"]}).then(r=>{l.config=r.data});let x=-1;N("system/user/config/list",{}).then(r=>{l.userConfigList=r.list||[],v.value=l.userConfigList.map(t=>({value:t.userId,label:t.name})),w.value=w.value.map((t,d)=>(t.value==="serialNo"&&(x=d),t)),n()});const n=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=f(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=f(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),N("douson/admin/improve/page",l.query).then(r=>{const t=r.list||[];l.tableData=t,l.total=r.total,ElementPlus.ElMessage.success("Query success")})},U=r=>{l.query.page.page=r,n()},B=r=>{l.query.page.limit=r,n()},$=()=>{l.formData=Object.assign({},_),l.formData.userId=L.userId,l.formVisible=!0,l.formSave=!0},K=r=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},r)},F=()=>{D.value.validate((r,t)=>{r?l.formSave?ee("douson/admin/improve",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),n()}):k(l.formData):ElementPlus.ElMessage.error("Please check input")})},k=r=>te("douson/admin/improve",r).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),n()}),T=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{le("douson/admin/improve",{improveId:r.improveId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),n()})})},S=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=f(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=f(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),n()},{query:s,tableData:O,config:g,total:A,dateTimeList:C,formData:a,formSave:z,formVisible:b,formRuleList:V}={...Vue.toRefs(l)};return(r,t)=>{const d=Vue.resolveComponent("el-input"),h=Vue.resolveComponent("el-date-picker"),m=Vue.resolveComponent("el-option"),p=Vue.resolveComponent("el-select"),y=Vue.resolveComponent("el-button"),Y=Vue.resolveComponent("el-tag"),j=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form-item"),G=Vue.resolveComponent("el-checkbox"),J=Vue.resolveComponent("el-form"),Q=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ue,[Vue.createVNode(d,{modelValue:Vue.unref(s).data.improveId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(s).data.improveId=e),onKeyup:Vue.withKeys(n,["enter"]),placeholder:Vue.unref(o).state.label.accidentImprove,clearable:"",onChange:n,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(h,{modelValue:Vue.unref(C),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(C)?C.value=e:null),onChange:S,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(s).data.userId=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(s).data.reason=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.improveReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(g).improveReasonList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(s).data.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(s).data.accidentDescribe=e),onChange:n,placeholder:Vue.unref(o).state.label.accidentDescribe,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(s).data.valid,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(s).data.valid=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(m,{label:"Done",value:!0}),Vue.createVNode(m,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(s).data.serialNo,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(s).data.serialNo=e),onKeyup:Vue.withKeys(n,["enter"]),placeholder:Vue.unref(o).state.label.templateOrderNo,clearable:"",onChange:n,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createElementVNode("div",ne,[Vue.createVNode(y,{icon:Vue.unref(H),onClick:n,type:"primary"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(W),onClick:$,type:"success"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"])])]),Vue.createVNode(re,{idKey:"improveId",columnConfigList:w.value,list:Vue.unref(O),handleEdit:K,handleUpdate:k,handleDelete:T,page:Vue.unref(s).page,total:Vue.unref(A),handlePageChange:U,handleLimitChange:B,detailLink:!1,handleTableCellClassName:E},{operator:Vue.withCtx(e=>[Vue.createVNode(j,{icon:Vue.unref(X),onClick:u=>R(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{size:"small"},{default:Vue.withCtx(()=>[de]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(Q,{title:Vue.unref(z)?"Add":"Edit",modelValue:Vue.unref(b),"onUpdate:modelValue":t[19]||(t[19]=e=>Vue.isRef(b)?b.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",me,[Vue.createVNode(y,{onClick:t[18]||(t[18]=e=>b.value=!1)},{default:Vue.withCtx(()=>[pe]),_:1}),Vue.createVNode(y,{type:"primary",onClick:F},{default:Vue.withCtx(()=>[ce]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(J,{rules:Vue.unref(V),model:Vue.unref(a),ref_key:"formRef",ref:D,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"reportDate",label:Vue.unref(o).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(h,{type:"date",modelValue:Vue.unref(a).reportDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).reportDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(a).reportDate=Vue.unref(f)(Vue.unref(a).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"equipmentId",label:Vue.unref(o).state.label.equipmentNo},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).equipmentId,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).equipmentId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(g).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"toolDescribe",label:Vue.unref(o).state.label.toolDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).toolDescribe,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(a).toolDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"userIdList",label:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).userIdList,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).userIdList=e),multiple:"",clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"directLeader",label:Vue.unref(o).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).directLeader,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"accidentDescribe",label:Vue.unref(o).state.label.accidentImproveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).accidentDescribe,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"photoList",label:`${Vue.unref(o).state.label.improvePhoto}(${(Vue.unref(V).photoList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(I,{photoList:Vue.unref(a).photoList,maxSize:+`${(Vue.unref(V).photoList||[]).reduce((e,u)=>u.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"fileList",label:`${Vue.unref(o).state.label.improveFile}(${(Vue.unref(V).fileList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{fileList:Vue.unref(a).fileList,maxSize:+`${(Vue.unref(V).fileList||[]).reduce((e,u)=>u.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"reason",label:Vue.unref(o).state.label.improveReason},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(a).reasonList,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(a).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.improveReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(g).improveReasonList,e=>(Vue.openBlock(),Vue.createBlock(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"solve",label:Vue.unref(o).state.label.improveSolve},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).solve,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(a).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improvePhotoList",label:`${Vue.unref(o).state.label.improveImprovePhoto}(${(Vue.unref(V).improvePhotoList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(I,{photoList:Vue.unref(a).improvePhotoList,maxSize:+`${(Vue.unref(V).improvePhotoList||[]).reduce((e,u)=>u.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improveFileList",label:`${Vue.unref(o).state.label.improveImproveFile}(${(Vue.unref(V).improveFileList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{fileList:Vue.unref(a).improveFileList,maxSize:+`${(Vue.unref(V).improveFileList||[]).reduce((e,u)=>u.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"opinion",label:Vue.unref(o).state.label.improveOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(a).opinion,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(a).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"valid",label:Vue.unref(o).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(G,{modelValue:Vue.unref(a).valid,"onUpdate:modelValue":t[17]||(t[17]=e=>Vue.unref(a).valid=e),name:"valid",disabled:!Vue.unref(Z)(Vue.unref(M),"admin")},{default:Vue.withCtx(()=>[Ve]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{De as default};
