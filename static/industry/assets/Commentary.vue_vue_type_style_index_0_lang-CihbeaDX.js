import{b as E,a as N,h as w}from"./main-Dirrnzcr.js";import{a as B}from"./Common-dWa9BEsb.js";import{h as y,b as D,i as b}from"./index-DfY7MOwJ.js";const W={style:{width:"100%"}},P={class:"infinite-list",style:{overflow:"auto",position:"relative",width:"100%"}},T={class:"icon-text",style:{"font-size":"16px"}},M={style:{width:"100%","margin-bottom":"10px","font-size":"15px"}},z={style:{color:"#aaaaaa",width:"100%",display:"flex","justify-content":"space-between","font-size":"13px"}},F={class:"icon-text"},S={style:{display:"flex","align-items":"center"}},R=["onClick"],G=Vue.createTextVNode(" 删除 "),K=["onClick"],L=Vue.createTextVNode(" 评论 "),$=Vue.defineComponent({__name:"Commentary",props:{forumId:{default:""},level:{default:0},children:{default:[]},prepareWriteCommentary:null,afterWriteCommentary:null},setup(v){const o=v,i=Vue.ref(null),m=Vue.ref("写评论"),d=Vuex.useStore();d.state;const V=d.state.user;VueRouter.useRouter();const r=Vue.ref({forumId:o.forumId,parentId:"",content:""}),u=Vue.ref({total:0,list:o.children}),s=Vue.ref(!1);Vue.onMounted(()=>{});const _=Vue.ref(0),g=()=>{_.value+=2},f=e=>{r.value.parentId=e.commentaryId,m.value=`To ${e.userIdFormat}：`,i.value.focus(),i.value.select()},c=(e,t)=>{for(let n=0;n<e.length;n++){if(e[n].commentaryId===t)return e[n];if((e[n].children||[]).length>0){const l=c(e[n].children,t);if(l)return l}}return null},x=()=>{r.value.content&&!s.value&&(s.value=!0,E("forum/commentary",r.value).then(e=>{ElementPlus.ElMessage.success("Merge success"),s.value=!1,r.value.content="";const t=c(u.value.list,r.value.parentId);t&&t.children&&t.children.push(e.data)}).catch(e=>{s.value=!1}))},C=e=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{N("forum/commentary",{forumId:e.forumId,commentaryId:e.commentaryId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r.value.content="";const t=c(u.value.list,e.parentId),n=t&&t.children?t.children:u.value.list;if(n){for(let l=0;l<n.length;l++)if(n[l].commentaryId===e.commentaryId){n.splice(l,1);break}}})})},p=()=>{r.value.forumId&&w("forum/commentary/tree",{page:{page:B,limit:99999},data:{forumId:r.value.forumId}}).then(e=>{ElementPlus.ElMessage.success("Query success"),u.value.total=e.total||0,u.value.list=e.list||[]})};return Vue.watch(()=>o.forumId,e=>{r.value.forumId=e,p()},{immediate:!0}),(e,t)=>{const n=Vue.resolveComponent("el-input"),l=Vue.resolveComponent("el-icon"),h=Vue.resolveDirective("infinite-scroll");return Vue.openBlock(),Vue.createElementBlock("div",W,[Vue.createElementVNode("div",null,[r.value.forumId?(Vue.openBlock(),Vue.createBlock(n,{key:0,ref_key:"commentaryRef",ref:i,modelValue:r.value.content,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.content=a),style:{width:"100%"},size:"large",placeholder:m.value,"suffix-icon":Vue.unref(y),disabled:s.value,onKeyup:Vue.withKeys(x,["enter"])},null,8,["modelValue","placeholder","suffix-icon","disabled","onKeyup"])):Vue.createCommentVNode("",!0)]),Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("ul",P,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(u.value.list||[],(a,k)=>(Vue.openBlock(),Vue.createElementBlock("li",{key:k,class:"infinite-list-item",style:{position:"relative",width:"100%"}},[Vue.createElementVNode("h3",T,[Vue.createVNode(l,{style:{"margin-right":"5px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(D))]),_:1}),Vue.createTextVNode(" "+Vue.toDisplayString(a.userIdFormat),1)]),Vue.createElementVNode("div",M,Vue.toDisplayString(a.content),1),Vue.createElementVNode("div",z,[Vue.createElementVNode("span",F,Vue.toDisplayString(a.createdTimeFormat),1),Vue.createElementVNode("span",S,[Vue.unref(V).username==="admin"||Vue.unref(V).userId===a.userId?(Vue.openBlock(),Vue.createElementBlock("span",{key:0,style:{cursor:"pointer","margin-right":"5px"},class:"icon-text",onClick:I=>C(a)},[Vue.createVNode(l,{style:{"margin-right":"5px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(b))]),_:1}),G],8,R)):Vue.createCommentVNode("",!0),Vue.createElementVNode("span",{style:{cursor:"pointer","margin-right":"5px"},class:"icon-text",onClick:I=>o.prepareWriteCommentary?o.prepareWriteCommentary(a):f(a)},[Vue.createVNode(l,{style:{"margin-right":"5px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(y))]),_:1}),L],8,K)])]),Vue.createElementVNode("div",{style:Vue.normalizeStyle({paddingLeft:8*(o.level+1)+"px",width:"100%"})},[(a.children||[]).length>0?(Vue.openBlock(),Vue.createBlock($,{key:0,children:a.children||[],level:o.level+1,"prepare-write-commentary":o.prepareWriteCommentary?o.prepareWriteCommentary:f,"after-write-commentary":o.afterWriteCommentary?o.afterWriteCommentary:p},null,8,["children","level","prepare-write-commentary","after-write-commentary"])):Vue.createCommentVNode("",!0)],4)]))),128))])),[[h,g]])])}}});export{$ as _};
