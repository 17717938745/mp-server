import{s as H,p as W,m as X}from"./index-DfY7MOwJ.js";import{o as v,h as x,i as Z,q as ee,b as te,a as ae}from"./main-Dirrnzcr.js";import{D as le,a as oe}from"./Common-dWa9BEsb.js";import{V as p}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as re}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as P}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as E}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ue={class:"query-container"},ne={class:"query-btn"},se=Vue.createTextVNode("Search"),ie=Vue.createTextVNode("Add"),de=Vue.createTextVNode("Print"),Ve=Vue.createTextVNode(" Done "),me={class:"dialog-footer"},ce=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm"),De=Vue.defineComponent({__name:"Event",setup(fe){VueRouter.useRouter();const M=VueRouter.useRoute(),o=Vuex.useStore(),R=o.state.roleCodeList,C=o.state.user,_=Vue.ref(null);Vue.ref(["0"]);const b=Vue.ref(new Array),L=Vue.ref([{value:"expand",label:"",width:48,type:p.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:p.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentEventDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"eventReason",width:276,showOverflow:!0},{value:"solve",labelKey:"eventSolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"eventOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:p.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"photoList",labelKey:"eventPhoto",width:128,type:p.Image},{value:"fileList",labelKey:"eventFile",width:128,type:p.Attachment},{value:"improvePhotoList",labelKey:"improveEventPhoto",width:128,type:p.Image},{value:"improveFileList",labelKey:"improveEventFile",width:128,type:p.Attachment}]),I=({row:r,column:t,rowIndex:d,columnIndex:V})=>g>=0&&g===V?"row-red":"",U=r=>{window.open(`/industry/public/event?eventId=${r.param.eventId}`)},D={reportDate:v(new Date,"yyyy-MM-dd"),userId:C.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",eventOpinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},a=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{eventId:M.query.eventId,startReportDate:"",endReportDate:"",userId:"",accidentDescribe:"",reason:"",serialNo:"",reasonList:[],valid:!1},page:{page:oe,limit:le}},tableData:new Array,total:0,formData:Object.assign({},D),formSave:!1,config:{eventReasonList:[]},userConfigList:new Array,userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});x("douson/config",{categoryIdList:["eventReason"]}).then(r=>{a.config=r.data});let g=-1;x("system/user/config/list",{}).then(r=>{a.userConfigList=r.list||[],b.value=a.userConfigList.map(t=>({value:t.userId,label:t.name})),L.value=L.value.map((t,d)=>(t.value==="0"&&(t.children||[]).forEach(V=>{(V.value==="dutyPerson"||V.value==="groupLeader"||V.value==="chargePerson"||V.value==="manager")&&(V.optionList=b.value)}),t.value==="serialNo"&&(g=d),t)),n()});const n=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=v(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=v(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),x("douson/admin/event/page",a.query).then(r=>{const t=r.list||[];a.tableData=t,a.total=r.total,ElementPlus.ElMessage.success("Query success")})},$=r=>{a.query.page.page=r,n()},q=r=>{a.query.page.limit=r,n()},K=()=>{a.formData=Object.assign({},D),a.formData.userId=C.userId,a.formVisible=!0,a.formSave=!0},B=r=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},r)},T=()=>{_.value.validate((r,t)=>{r?a.formSave?ee("douson/admin/event",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),n()}):N(a.formData):ElementPlus.ElMessage.error("Please check input")})},N=r=>te("douson/admin/event",r).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Update success"),n()}),F=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ae("douson/admin/event",{eventId:r.eventId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),n()})})},S=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=v(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=v(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),n()},{query:s,tableData:O,config:k,total:A,dateTimeList:w,formData:l,formSave:z,formVisible:h,formRuleList:m}={...Vue.toRefs(a)};return(r,t)=>{const d=Vue.resolveComponent("el-input"),V=Vue.resolveComponent("el-date-picker"),c=Vue.resolveComponent("el-option"),f=Vue.resolveComponent("el-select"),y=Vue.resolveComponent("el-button"),Y=Vue.resolveComponent("el-tag"),j=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form-item"),G=Vue.resolveComponent("el-checkbox"),J=Vue.resolveComponent("el-form"),Q=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ue,[Vue.createVNode(d,{modelValue:Vue.unref(s).data.eventId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(s).data.eventId=e),onKeyup:Vue.withKeys(n,["enter"]),placeholder:Vue.unref(o).state.label.accidentEvent,clearable:"",onChange:n,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(w),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(w)?w.value=e:null),onChange:S,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(f,{modelValue:Vue.unref(s).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(s).data.userId=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(f,{modelValue:Vue.unref(s).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(s).data.reason=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.eventReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).eventReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(s).data.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(s).data.accidentDescribe=e),onChange:n,placeholder:Vue.unref(o).state.label.accidentDescribe,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(f,{modelValue:Vue.unref(s).data.valid,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(s).data.valid=e),onChange:n,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{label:"Done",value:!0}),Vue.createVNode(c,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(s).data.serialNo,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(s).data.serialNo=e),onKeyup:Vue.withKeys(n,["enter"]),placeholder:Vue.unref(o).state.label.templateOrderNo,clearable:"",onChange:n,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createElementVNode("div",ne,[Vue.createVNode(y,{icon:Vue.unref(H),onClick:n,type:"primary"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(W),onClick:K,type:"success"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"])])]),Vue.createVNode(re,{idKey:"eventId",columnConfigList:L.value,handleTableCellClassName:I,list:Vue.unref(O),handleEdit:B,handleUpdate:N,handleDelete:F,page:Vue.unref(s).page,total:Vue.unref(A),handlePageChange:$,handleLimitChange:q,detailLink:!1},{operator:Vue.withCtx(e=>[Vue.createVNode(j,{icon:Vue.unref(X),onClick:u=>U(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{size:"small"},{default:Vue.withCtx(()=>[de]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(Q,{title:Vue.unref(z)?"Add":"Edit",modelValue:Vue.unref(h),"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.isRef(h)?h.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",me,[Vue.createVNode(y,{onClick:t[17]||(t[17]=e=>h.value=!1)},{default:Vue.withCtx(()=>[ce]),_:1}),Vue.createVNode(y,{type:"primary",onClick:T},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(J,{rules:Vue.unref(m),model:Vue.unref(l),ref_key:"formRef",ref:_,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"reportDate",label:Vue.unref(o).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"date",modelValue:Vue.unref(l).reportDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(l).reportDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(l).reportDate=Vue.unref(v)(Vue.unref(l).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"userId",label:Vue.unref(o).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).userId,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(l).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"directLeader",label:Vue.unref(o).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).directLeader,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(l).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"accidentDescribe",label:Vue.unref(o).state.label.accidentEventDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).accidentDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(l).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"photoList",label:`${Vue.unref(o).state.label.eventPhoto}(${(Vue.unref(m).photoList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{photoList:Vue.unref(l).photoList,maxSize:+`${(Vue.unref(m).photoList||[]).reduce((e,u)=>u.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"fileList",label:`${Vue.unref(o).state.label.eventFile}(${(Vue.unref(m).fileList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(l).fileList,maxSize:+`${(Vue.unref(m).fileList||[]).reduce((e,u)=>u.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"reason",label:Vue.unref(o).state.label.eventReason},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).reasonList,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(l).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.eventReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).eventReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"solve",label:Vue.unref(o).state.label.eventSolve},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).solve,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(l).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improvePhotoList",label:`${Vue.unref(o).state.label.improveEventPhoto}(${(Vue.unref(m).improvePhotoList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(P,{photoList:Vue.unref(l).improvePhotoList,maxSize:+`${(Vue.unref(m).improvePhotoList||[]).reduce((e,u)=>u.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improveFileList",label:`${Vue.unref(o).state.label.improveEventFile}(${(Vue.unref(m).improveFileList||[]).reduce((e,u)=>`Min: ${u.min}, Max: ${u.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(l).improveFileList,maxSize:+`${(Vue.unref(m).improveFileList||[]).reduce((e,u)=>u.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"improveDescribe",label:Vue.unref(o).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).improveDescribe,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(l).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"opinion",label:Vue.unref(o).state.label.eventOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).opinion,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(l).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"valid",label:Vue.unref(o).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(G,{modelValue:Vue.unref(l).valid,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(l).valid=e),name:"valid",disabled:!Vue.unref(Z)(Vue.unref(R),"admin")},{default:Vue.withCtx(()=>[Ve]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{De as default};
