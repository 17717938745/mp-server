import{n as m,B as V}from"./index-DfY7MOwJ.js";import{p,t as h}from"./main-Dirrnzcr.js";const _={key:0,class:"resources-upload"},g=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload file",-1),k=["href"],v=Vue.defineComponent({__name:"FileUpload",props:{fileList:null,maxSize:{default:4},disabled:{type:Boolean,default:!1}},setup(s,{expose:r}){const e=s;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),r({});const u={},c=(a,l)=>{console.log("file change, length: "+l.length)},d=a=>(console.log("before upload file: "+a.uid),u[a.uid]=a,a),f=a=>{const l=Object.keys(u),i=Math.max((e.maxSize||0)-e.fileList.length,0);l.length>i?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${i}, actual: ${l.length}`),l.forEach(t=>{delete u[t]})):l.length>0&&(Promise.all(l.map(t=>{const n=u[t],o=new FormData;return o.set("filename",n.name),o.set("file",n),h("index/file",o)})).then(t=>(t.forEach(n=>{const o=n.data;e.fileList.push({url:o.url,fileId:o.fileId,filename:o.filename})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.error("Upload failed"),Promise.reject())),l.forEach(t=>{delete u[t]}))};return Vue.watch(()=>e.fileList,a=>{},{immediate:!0}),(a,l)=>{const i=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload");return e.fileList?(Vue.openBlock(),Vue.createElementBlock("div",_,[Vue.withDirectives(Vue.createVNode(t,{action:"#","show-file-list":!1,"on-change":c,"before-upload":d,"http-request":f,multiple:"",drag:!0,disabled:e.disabled},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(i,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(m),{style:{width:"5em",height:"5em"}})]),_:1}),g])]),_:1},8,["disabled"]),[[Vue.vShow,e.fileList.length<e.maxSize]]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.fileList,(n,o)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:n.url,class:"resources-view"},[Vue.createElementVNode("a",{href:Vue.unref(p)(n.url,"")},Vue.toDisplayString(n.filename),9,k),e.disabled?Vue.createCommentVNode("",!0):(Vue.openBlock(),Vue.createBlock(i,{key:0,class:"close-btn",size:28,onClick:x=>e.fileList.splice(o,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(V))]),_:2},1032,["onClick"]))]))),128))])):Vue.createCommentVNode("",!0)}}});export{v as _};
