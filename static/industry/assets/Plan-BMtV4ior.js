import{s as Q,p as H,m as W}from"./index-DfY7MOwJ.js";import{o as h,h as L,i as X,q as Z,b as ee,a as le}from"./main-Dirrnzcr.js";import{D as ae,a as te}from"./Common-dWa9BEsb.js";import{V as m}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as oe}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as k}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as re}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ue={class:"query-container"},ne={class:"query-btn"},se=Vue.createTextVNode("Search"),ie=Vue.createTextVNode("Add "),de=Vue.createTextVNode("Print"),Ve=Vue.createTextVNode(" Done "),me={class:"dialog-footer"},pe=Vue.createTextVNode("Cancel"),ce=Vue.createTextVNode("Confirm"),Ne=Vue.defineComponent({__name:"Plan",setup(fe){VueRouter.useRouter();const a=Vuex.useStore(),_=a.state.user,D=a.state.roleCodeList,P=Vue.ref(null),v=Vue.ref(new Array),w=Vue.ref([{value:"expand",label:"",width:48,type:m.Expand},{value:"operator",labelKey:"viewAndEdit",width:223,type:m.Operator},{value:"index",labelKey:"index",width:78},{value:"createDate",label:a.state.label.createDate,labelKey:"createDate",width:102},{value:"creatorFormat",label:a.state.label.username,labelKey:"username",width:110},{value:"departmentFormat",label:a.state.label.department,labelKey:"department",width:154},{value:"responsibleTeamFormat",label:a.state.label.responsibleTeam,labelKey:"responsibleTeam",width:154},{value:"optimizeTypeFormat",label:a.state.label.optimizeType,labelKey:"optimizeType",width:128},{value:"existsProblem",label:a.state.label.existsProblem,labelKey:"existsProblem",width:334,type:m.Text,showOverflow:!0},{value:"solveScheme",label:a.state.label.solveScheme,labelKey:"solveScheme",width:334,type:m.Text,showOverflow:!0},{value:"responsiblePersonFormat",originValue:"responsiblePersonList",label:a.state.label.responsiblePerson,labelKey:"responsiblePerson",width:128},{value:"planCompleteTime",label:a.state.label.planCompleteTime,labelKey:"planCompleteTime",width:102},{value:"awardAmountFormat",label:a.state.label.awardAmount,labelKey:"awardAmount",width:87},{value:"valid",label:a.state.label.valid,labelKey:"valid",width:68,type:m.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"beforePhotoList",label:a.state.label.photoList,labelKey:"beforePlanThreePhoto",width:269,type:m.Image},{value:"afterPhotoList",label:a.state.label.photoList,labelKey:"afterPlanThreePhoto",width:269,type:m.Image},{value:"attachmentList",label:a.state.label.photoList,labelKey:"supportAttachment",width:269,type:m.Attachment}]),N={planId:"",creator:a.state.user.userId,createDate:h(new Date,"yyyy-MM-dd"),department:"",optimizeType:"",existsProblem:"",solveScheme:"",responsibleTeam:"",responsiblePersonList:[a.state.user.userId],planCompleteTime:"",beforePhotoList:[],afterPhotoList:[],attachmentList:[],awardAmount:0,valid:"",photoList:new Array},o=Vue.reactive({dateTimeList:[],photoVisible:!1,photoList:new Array,expandRowKeys:new Array,query:{data:{startCreateDate:"",endCreateDate:"",department:"",responsibleTeam:"",optimizeType:"",existsProblem:"",username:"",serialNo:"",responsiblePerson:"",valid:!1},page:{page:te,limit:ae}},tableData:new Array,total:0,formData:Object.assign({},N),formSave:!1,config:{processProcedureList:[],testDeviceList:[],customerShortNameList:[],departmentList:[],optimizeTypeList:[],responsibleTeamList:[]},userConfigList:new Array,formVisible:!1,formRuleList:{creator:[{required:!0,message:"Please check",trigger:"blur"}],createDate:[{required:!0,message:"Please check",trigger:"blur"}],department:[{required:!0,message:"Please check",trigger:"blur"}],optimizeType:[{required:!0,message:"Please check",trigger:"blur"}],existsProblem:[{required:!0,message:"Please check",trigger:"blur"}],solveScheme:[{required:!0,message:"Please check",trigger:"blur"}],planCompleteTime:[{required:!0,message:"Please check",trigger:"blur"}],beforePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:5}],responsiblePersonList:[{required:!1,type:"array",message:"Please check",min:0,max:5}],afterPhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:5}],attachmentList:[{required:!1,type:"array",message:"Please check",min:0,max:4}]}}),B=()=>{o.dateTimeList&&o.dateTimeList.length>1?(o.query.data.startCreateDate=h(o.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),o.query.data.endCreateDate=h(o.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(o.query.data.startCreateDate="",o.query.data.endCreateDate=""),u()},E=r=>{window.open(`/industry/public/plan?planId=${r.param.planId}`)};L("douson/config",{categoryIdList:["processProcedure","testDevice","customerShortName","department","optimizeType","responsibleTeam"]}).then(r=>{o.config=r.data});const u=()=>{L("douson/admin/plan/page",o.query).then(r=>{o.tableData=r.list,o.total=r.total,ElementPlus.ElMessage.success("Query success")})},M=r=>{o.query.page.page=r,u()},S=r=>{o.query.page.limit=r,u()},U=({row:r,column:l,rowIndex:f,columnIndex:d})=>g>=0&&g===d?"row-red":"";let g=-1;L("system/user/config/list",{}).then(r=>{o.userConfigList=r.list||[],v.value=o.userConfigList.map(l=>({value:l.userId,label:l.name})),w.value=w.value.map((l,f)=>(l.value==="responsiblePersonFormat"&&(l.type=m.SelectEdit,l.width=234,l.optionList=v.value),l.value==="serialNo"&&(g=f),l)),u()});const z=()=>{o.formData=Object.assign({},N),o.formVisible=!0,o.formSave=!0},A=r=>{o.formVisible=!0,o.formSave=!1,o.formData=Object.assign({},r)},q=()=>{P.value.validate(r=>{r&&(o.formSave?Z("douson/admin/plan",o.formData).then(()=>{o.formVisible=!1,ElementPlus.ElMessage.success("Add success"),u()}):T(o.formData))})},T=r=>ee("douson/admin/plan",r).then(()=>{o.formVisible=!1,ElementPlus.ElMessage.success("Update success"),u()}),$=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{le("douson/admin/plan",{planId:r.planId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),u()})})},{query:n,tableData:K,config:c,total:F,dateTimeList:x,formData:t,formSave:I,formVisible:y,formRuleList:p}={...Vue.toRefs(o)};return(r,l)=>{const f=Vue.resolveComponent("el-date-picker"),d=Vue.resolveComponent("el-option"),V=Vue.resolveComponent("el-select"),b=Vue.resolveComponent("el-input"),C=Vue.resolveComponent("el-button"),Y=Vue.resolveComponent("el-tag"),R=Vue.resolveComponent("el-link"),i=Vue.resolveComponent("el-form-item"),O=Vue.resolveComponent("el-input-number"),j=Vue.resolveComponent("el-checkbox"),G=Vue.resolveComponent("el-form"),J=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ue,[Vue.createVNode(f,{modelValue:Vue.unref(x),"onUpdate:modelValue":l[0]||(l[0]=e=>Vue.isRef(x)?x.value=e:null),onChange:B,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date"},null,8,["modelValue"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.department,"onUpdate:modelValue":l[1]||(l[1]=e=>Vue.unref(n).data.department=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.department,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).departmentList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.optimizeType,"onUpdate:modelValue":l[2]||(l[2]=e=>Vue.unref(n).data.optimizeType=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.optimizeType,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).optimizeTypeList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(b,{modelValue:Vue.unref(n).data.existsProblem,"onUpdate:modelValue":l[3]||(l[3]=e=>Vue.unref(n).data.existsProblem=e),onChange:u,placeholder:Vue.unref(a).state.label.existsProblem,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(b,{modelValue:Vue.unref(n).data.username,"onUpdate:modelValue":l[4]||(l[4]=e=>Vue.unref(n).data.username=e),onChange:u,placeholder:Vue.unref(a).state.label.username,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.responsiblePerson,"onUpdate:modelValue":l[5]||(l[5]=e=>Vue.unref(n).data.responsiblePerson=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.responsiblePerson,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.valid,"onUpdate:modelValue":l[6]||(l[6]=e=>Vue.unref(n).data.valid=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:"Done",value:!0}),Vue.createVNode(d,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(b,{modelValue:Vue.unref(n).data.serialNo,"onUpdate:modelValue":l[7]||(l[7]=e=>Vue.unref(n).data.serialNo=e),onKeyup:Vue.withKeys(u,["enter"]),placeholder:Vue.unref(a).state.label.templateOrderNo,clearable:"",onChange:u,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.responsibleTeam,"onUpdate:modelValue":l[8]||(l[8]=e=>Vue.unref(n).data.responsibleTeam=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.responsibleTeam,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).responsibleTeamList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",ne,[Vue.createVNode(C,{icon:Vue.unref(Q),onClick:u,type:"primary"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"]),Vue.createVNode(C,{icon:Vue.unref(H),onClick:z,type:"success"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"])])]),Vue.createVNode(oe,{idKey:"planId",columnConfigList:w.value,list:Vue.unref(K),handleEdit:A,handleUpdate:T,handleDelete:Vue.unref(_).username==="admin"?$:null,page:Vue.unref(n).page,total:Vue.unref(F),handlePageChange:M,handleLimitChange:S,"detail-link":!1,handleTableCellClassName:U},{operator:Vue.withCtx(e=>[Vue.createVNode(R,{icon:Vue.unref(W),onClick:s=>E(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{size:"small"},{default:Vue.withCtx(()=>[de]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","handleDelete","page","total"]),Vue.createVNode(J,{title:Vue.unref(I)?"Add":"Edit",modelValue:Vue.unref(y),"onUpdate:modelValue":l[23]||(l[23]=e=>Vue.isRef(y)?y.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",me,[Vue.createVNode(C,{onClick:l[22]||(l[22]=e=>y.value=!1)},{default:Vue.withCtx(()=>[pe]),_:1}),Vue.createVNode(C,{type:"primary",onClick:q},{default:Vue.withCtx(()=>[ce]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(G,{rules:Vue.unref(p),model:Vue.unref(t),ref_key:"formRef",ref:P,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"createDate",label:Vue.unref(a).state.label.createDate},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"date",modelValue:Vue.unref(t).createDate,"onUpdate:modelValue":l[9]||(l[9]=e=>Vue.unref(t).createDate=e),format:"YYYY-MM-DD",onChange:l[10]||(l[10]=e=>Vue.unref(t).createDate=Vue.unref(h)(Vue.unref(t).createDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"creator",label:Vue.unref(a).state.label.username},{default:Vue.withCtx(()=>[Vue.createVNode(b,{modelValue:Vue.unref(t).creator,"onUpdate:modelValue":l[11]||(l[11]=e=>Vue.unref(t).creator=e),disabled:!0},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"department",label:Vue.unref(a).state.label.department},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(t).department,"onUpdate:modelValue":l[12]||(l[12]=e=>Vue.unref(t).department=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.department,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).departmentList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"responsibleTeam",label:Vue.unref(a).state.label.responsibleTeam},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(t).responsibleTeam,"onUpdate:modelValue":l[13]||(l[13]=e=>Vue.unref(t).responsibleTeam=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.responsibleTeam,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).responsibleTeamList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"optimizeType",label:Vue.unref(a).state.label.optimizeType},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(t).optimizeType,"onUpdate:modelValue":l[14]||(l[14]=e=>Vue.unref(t).optimizeType=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(a).state.label.optimizeType,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(c).optimizeTypeList,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"existsProblem",label:Vue.unref(a).state.label.existsProblem},{default:Vue.withCtx(()=>[Vue.createVNode(b,{type:"textarea",rows:8,modelValue:Vue.unref(t).existsProblem,"onUpdate:modelValue":l[15]||(l[15]=e=>Vue.unref(t).existsProblem=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"solveScheme",label:Vue.unref(a).state.label.solveScheme},{default:Vue.withCtx(()=>[Vue.createVNode(b,{type:"textarea",rows:8,modelValue:Vue.unref(t).solveScheme,"onUpdate:modelValue":l[16]||(l[16]=e=>Vue.unref(t).solveScheme=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"responsiblePersonList",label:Vue.unref(a).state.label.responsiblePerson},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(t).responsiblePersonList,"onUpdate:modelValue":l[17]||(l[17]=e=>Vue.unref(t).responsiblePersonList=e),filterable:"","allow-create":"",multiple:"",clearable:"",placeholder:Vue.unref(a).state.label.responsiblePerson},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"planCompleteTime",label:Vue.unref(a).state.label.planCompleteTime},{default:Vue.withCtx(()=>[Vue.createVNode(f,{type:"date",modelValue:Vue.unref(t).planCompleteTime,"onUpdate:modelValue":l[18]||(l[18]=e=>Vue.unref(t).planCompleteTime=e),format:"YYYY-MM-DD",onChange:l[19]||(l[19]=e=>Vue.unref(t).planCompleteTime=Vue.unref(h)(Vue.unref(t).planCompleteTime,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"beforePhotoList",label:`${Vue.unref(a).state.label.beforePlanThreePhoto}(${(Vue.unref(p).beforePhotoList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(t).beforePhotoList,maxSize:+`${(Vue.unref(p).beforePhotoList||[]).reduce((e,s)=>s.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"afterPhotoList",label:`${Vue.unref(a).state.label.afterPlanThreePhoto}(${(Vue.unref(p).afterPhotoList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(k,{photoList:Vue.unref(t).afterPhotoList,maxSize:+`${(Vue.unref(p).afterPhotoList||[]).reduce((e,s)=>s.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"attachmentList",label:`${Vue.unref(a).state.label.supportAttachment}(${(Vue.unref(p).attachmentList||[]).reduce((e,s)=>`Min: ${s.min}, Max: ${s.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(re,{fileList:Vue.unref(t).attachmentList,maxSize:+`${(Vue.unref(p).attachmentList||[]).reduce((e,s)=>s.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"awardAmount",label:Vue.unref(a).state.label.awardAmount},{default:Vue.withCtx(()=>[Vue.createVNode(O,{min:0,modelValue:Vue.unref(t).awardAmount,"onUpdate:modelValue":l[20]||(l[20]=e=>Vue.unref(t).awardAmount=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"valid",label:Vue.unref(a).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(j,{modelValue:Vue.unref(t).valid,"onUpdate:modelValue":l[21]||(l[21]=e=>Vue.unref(t).valid=e),name:"valid",disabled:!Vue.unref(X)(Vue.unref(D),"admin")},{default:Vue.withCtx(()=>[Ve]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{Ne as default};
