import{s as W,p as X,m as Z}from"./index-DfY7MOwJ.js";import{o as y,h as x,i as P,q as ee,b as te,a as ae}from"./main-Dirrnzcr.js";import{D as le,a as ue}from"./Common-dWa9BEsb.js";import{V as p}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as oe}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as M}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as E}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const re={class:"query-container"},ie={class:"query-btn"},ne=Vue.createTextVNode("Search"),se=Vue.createTextVNode("Add"),de=Vue.createTextVNode("Print"),Ve=Vue.createTextVNode(" Done "),me={class:"dialog-footer"},ce=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm"),De=Vue.defineComponent({__name:"Quality",setup(fe){VueRouter.useRouter();const R=VueRouter.useRoute(),u=Vuex.useStore(),C=u.state.roleCodeList,_=u.state.user,D=Vue.ref(null);Vue.ref(["0"]);const b=Vue.ref(new Array),g=Vue.ref([{value:"expand",label:"",width:48,type:p.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:p.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentQualityDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"qualityReason",width:276,showOverflow:!0},{value:"solve",labelKey:"qualitySolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"qualityOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:p.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"photoList",labelKey:"qualityPhoto",width:128,type:p.Image},{value:"fileList",labelKey:"qualityFile",width:128,type:p.Attachment},{value:"improvePhotoList",labelKey:"improveQualityPhoto",width:128,type:p.Image},{value:"improveFileList",labelKey:"improveQualityFile",width:128,type:p.Attachment}]),I=({row:o,column:t,rowIndex:d,columnIndex:V})=>L>=0&&L===V?"row-red":"",U=o=>{window.open(`/industry/public/quality?qualityId=${o.param.qualityId}`)},N={reportDate:y(new Date,"yyyy-MM-dd"),userId:_.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",opinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},a=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{qualityId:R.query.qualityId,startReportDate:"",endReportDate:"",accidentDescribe:"",userId:"",reason:"",serialNo:"",reasonList:[],valid:!1},page:{page:ue,limit:le}},tableData:new Array,total:0,formData:Object.assign({},N),formSave:!1,config:{qualityReasonList:[]},userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improvePhotoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],improveFileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});let L=-1;Promise.all([x("douson/config",{categoryIdList:["qualityReason"]}),x("system/user/config/list",{})]).then(o=>{a.config=o[0].data,b.value=(o[1].list||[]).map(t=>({value:t.userId,label:t.name})),g.value=g.value.map((t,d)=>(P(C,"gauger")&&t.value==="0"&&(t.children||[]).forEach(V=>{(V.value==="dutyPerson"||V.value==="groupLeader"||V.value==="chargePerson"||V.value==="manager")&&(V.optionList=b.value)}),t.value==="serialNo"&&(L=d),t)),i()});const i=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=y(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=y(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),x("douson/admin/quality/page",a.query).then(o=>{const t=o.list||[];a.tableData=t,a.total=o.total,ElementPlus.ElMessage.success("Query success")})},$=o=>{a.query.page.page=o,i()},K=o=>{a.query.page.limit=o,i()},B=()=>{a.formData=Object.assign({},N),a.formData.userId=_.userId,a.formVisible=!0,a.formSave=!0},T=o=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},o)},F=()=>{D.value.validate((o,t)=>{o?a.formSave?ee("douson/admin/quality",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),i()}):q(a.formData):ElementPlus.ElMessage.error("Please check input")})},q=o=>te("douson/admin/quality",o).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Update success"),i()}),S=o=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ae("douson/admin/quality",{qualityId:o.qualityId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),i()})})},O=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=y(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=y(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),i()},{query:n,tableData:A,config:k,total:z,dateTimeList:w,formData:l,formSave:Q,formVisible:h,formRuleList:m}={...Vue.toRefs(a)};return(o,t)=>{const d=Vue.resolveComponent("el-input"),V=Vue.resolveComponent("el-date-picker"),c=Vue.resolveComponent("el-option"),f=Vue.resolveComponent("el-select"),v=Vue.resolveComponent("el-button"),Y=Vue.resolveComponent("el-tag"),j=Vue.resolveComponent("el-link"),s=Vue.resolveComponent("el-form-item"),G=Vue.resolveComponent("el-checkbox"),J=Vue.resolveComponent("el-form"),H=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",re,[Vue.createVNode(d,{modelValue:Vue.unref(n).data.qualityId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(n).data.qualityId=e),onKeyup:Vue.withKeys(i,["enter"]),placeholder:Vue.unref(u).state.label.accidentQuality,clearable:"",onChange:i,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(w),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(w)?w.value=e:null),onChange:O,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(f,{modelValue:Vue.unref(n).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(n).data.userId=e),onChange:i,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(f,{modelValue:Vue.unref(n).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(n).data.reason=e),onChange:i,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.qualityReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).qualityReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(n).data.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(n).data.accidentDescribe=e),onChange:i,placeholder:Vue.unref(u).state.label.accidentDescribe,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(f,{modelValue:Vue.unref(n).data.valid,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(n).data.valid=e),onChange:i,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(c,{label:"Done",value:!0}),Vue.createVNode(c,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(n).data.serialNo,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(n).data.serialNo=e),onKeyup:Vue.withKeys(i,["enter"]),placeholder:Vue.unref(u).state.label.templateOrderNo,clearable:"",onChange:i,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createElementVNode("div",ie,[Vue.createVNode(v,{icon:Vue.unref(W),onClick:i,type:"primary"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.createVNode(v,{icon:Vue.unref(X),onClick:B,type:"success"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"])])]),Vue.createVNode(oe,{idKey:"qualityId",columnConfigList:g.value,list:Vue.unref(A),handleEdit:T,handleUpdate:q,handleDelete:S,page:Vue.unref(n).page,total:Vue.unref(z),handlePageChange:$,handleLimitChange:K,detailLink:!1,handleTableCellClassName:I},{operator:Vue.withCtx(e=>[Vue.createVNode(j,{icon:Vue.unref(Z),onClick:r=>U(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{size:"small"},{default:Vue.withCtx(()=>[de]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(H,{title:Vue.unref(Q)?"Add":"Edit",modelValue:Vue.unref(h),"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.isRef(h)?h.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",me,[Vue.createVNode(v,{onClick:t[17]||(t[17]=e=>h.value=!1)},{default:Vue.withCtx(()=>[ce]),_:1}),Vue.createVNode(v,{type:"primary",onClick:F},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(J,{rules:Vue.unref(m),model:Vue.unref(l),ref_key:"formRef",ref:D,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(s,{prop:"reportDate",label:Vue.unref(u).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(V,{type:"date",modelValue:Vue.unref(l).reportDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(l).reportDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(l).reportDate=Vue.unref(y)(Vue.unref(l).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"userId",label:Vue.unref(u).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).userId,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(l).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"directLeader",label:Vue.unref(u).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).directLeader,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(l).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"accidentDescribe",label:Vue.unref(u).state.label.accidentQualityDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).accidentDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(l).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"photoList",label:`${Vue.unref(u).state.label.qualityPhoto}(${(Vue.unref(m).photoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(M,{photoList:Vue.unref(l).photoList,maxSize:+`${(Vue.unref(m).photoList||[]).reduce((e,r)=>r.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"fileList",label:`${Vue.unref(u).state.label.qualityFile}(${(Vue.unref(m).fileList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(l).fileList,maxSize:+`${(Vue.unref(m).fileList||[]).reduce((e,r)=>r.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"reason",label:Vue.unref(u).state.label.qualityReason},{default:Vue.withCtx(()=>[Vue.createVNode(f,{modelValue:Vue.unref(l).reasonList,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(l).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.qualityReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).qualityReasonList,e=>(Vue.openBlock(),Vue.createBlock(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"solve",label:Vue.unref(u).state.label.qualitySolve},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).solve,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(l).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"improvePhotoList",label:`${Vue.unref(u).state.label.improveQualityPhoto}(${(Vue.unref(m).improvePhotoList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(M,{photoList:Vue.unref(l).improvePhotoList,maxSize:+`${(Vue.unref(m).improvePhotoList||[]).reduce((e,r)=>r.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"improveFileList",label:`${Vue.unref(u).state.label.improveQualityFile}(${(Vue.unref(m).improveFileList||[]).reduce((e,r)=>`Min: ${r.min}, Max: ${r.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{fileList:Vue.unref(l).improveFileList,maxSize:+`${(Vue.unref(m).improveFileList||[]).reduce((e,r)=>r.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"improveDescribe",label:Vue.unref(u).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).improveDescribe,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(l).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"opinion",label:Vue.unref(u).state.label.qualityOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(l).opinion,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(l).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"valid",label:Vue.unref(u).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(G,{modelValue:Vue.unref(l).valid,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(l).valid=e),name:"valid",disabled:!Vue.unref(P)(Vue.unref(C),"admin")},{default:Vue.withCtx(()=>[Ve]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{De as default};
