import{s as j,p as G}from"./index-DfY7MOwJ.js";import{h as b,i as J,o as v,b as E,a as Q}from"./main-Dirrnzcr.js";import{a as H}from"./Common-dWa9BEsb.js";import{V as m}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as W}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as X}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as Z}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ee={class:"query-container"},te={class:"query-btn"},ae=Vue.createTextVNode("Search"),le=Vue.createTextVNode("Add "),ue={class:"dialog-footer"},oe=Vue.createTextVNode("Cancel"),re=Vue.createTextVNode("Confirm"),he=Vue.defineComponent({__name:"Inventory",setup(ne){VueRouter.useRouter();const u=Vuex.useStore(),T=u.state.user,P=u.state.roleCodeList,g=Vue.ref(null),C=Vue.ref(new Array),N=[{value:"expand",label:"",width:48,type:m.Expand},{value:"operator",labelKey:"viewAndEdit",width:158,type:m.Operator},{value:"index",labelKey:"index",width:50},{value:"materialNo",labelKey:"materialNo",width:163},{value:"materialDescription",labelKey:"materialDescription",width:210},{value:"designNumber",labelKey:"designNumber",width:147},{value:"inventoryCount",labelKey:"inventoryCount",width:56},{value:"inventoryDate",labelKey:"inventoryDate",width:102},{value:"typeFormat",labelKey:"type",width:89},{value:"description",labelKey:"description",width:189},{value:"materialCount",labelKey:"materialCount",width:76},{value:"materialDate",labelKey:"materialDate",width:102},{value:"photoCount",labelKey:"photoCount",width:56},{value:"photoList",labelKey:"photoDescribe",width:189,type:m.Image},{value:"attachmentList",labelKey:"attachment",width:189,type:m.Attachment}],D=Vue.ref(N.map(l=>l));b("system/user/config/list",{}).then(l=>{a.userConfigList=l.list||[],C.value=a.userConfigList.map(e=>({value:e.userId,label:e.name}))});const x={creator:T.userId,materialNo:"",materialDescription:"",designNumber:"",inventoryCount:null,inventoryDate:"",type:"",description:"",materialCount:null,materialDate:"",photoList:[],attachmentList:[]},a=Vue.reactive({dateTimeList:[],dateTimeListSupplier:[],photoVisible:!1,photoList:new Array,userConfigList:new Array,expandRowKeys:new Array,query:{data:{materialNo:"",materialDescription:"",designNumber:"",inventoryCount:"",inventoryDate:"",type:"",description:"",materialCount:"",materialDate:"",startMaterialDate:"",endMaterialDate:"",inventoryCountType:0},page:{page:H,limit:120}},tableData:new Array,total:0,formData:Object.assign({},x),config:{inventoryOutOfPlanTypeList:[]},formSave:!0,formVisible:!1,formRuleList:{materialNo:[{required:!0,message:"Please check",trigger:"blur"}],materialDescription:[{required:!0,message:"Please check",trigger:"blur"}],designNumber:[{required:!0,message:"Please check",trigger:"blur"}],inventoryCount:[{required:!0,message:"Please check",trigger:"blur"}],inventoryDate:[{required:!0,message:"Please check",trigger:"blur"}],type:[{required:!0,message:"Please check",trigger:"blur"}],description:[{required:!0,message:"Please check",trigger:"blur"}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:3}],attachmentList:[{required:!1,type:"array",message:"Please check",min:0,max:3}]}}),U=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startMaterialDate=v(a.dateTimeList[0],"yyyy-MM-dd"),a.query.data.endMaterialDate=v(a.dateTimeList[1],"yyyy-MM-dd")):(a.query.data.startMaterialDate="",a.query.data.endMaterialDate=""),r()},r=()=>{b("douson/inventory/page",a.query).then(l=>{a.tableData=l.list,a.total=l.total,ElementPlus.ElMessage.success("Query success")})},q=l=>{a.query.page.page=l,r()},$=l=>{a.query.page.limit=l,r()},K=()=>{a.formData=Object.assign({},x),a.formVisible=!0,a.formSave=!0},S=l=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},l)},A=()=>{g.value.validate(l=>{l&&(a.formSave?E("douson/inventory/merge",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),r()}):w(a.formData))})},w=l=>E("douson/inventory/merge",l).then(()=>{ElementPlus.ElMessage.success("Update success"),a.formVisible=!1,r()}),B=l=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{Q("douson/inventory",{inventoryId:l.inventoryId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r()})})},p=J(P,"inventoryManager");Promise.all([b("douson/config",{categoryIdList:["inventoryOutOfPlanType"]}),b("system/user/config/list",{})]).then(l=>{a.config=l[0].data||{},C.value=(l[1].list||[]).map(e=>({value:e.userId,label:e.name})),p&&(D.value=N.map(e=>(e.value==="materialCount"?(e.type=m.NumberEdit,e.width=95):e.value==="description"&&(e.type=m.TextEdit),e))),r()});const{query:n,tableData:O,config:R,total:I,dateTimeList:h,formData:o,formSave:f,formVisible:c,formRuleList:V}={...Vue.toRefs(a)},Y=({row:l,rowIndex:e})=>l.materialCount&&l.materialCount===l.inventoryCount?"row-done":"";return(l,e)=>{const s=Vue.resolveComponent("el-input"),_=Vue.resolveComponent("el-date-picker"),L=Vue.resolveComponent("el-option"),k=Vue.resolveComponent("el-select"),y=Vue.resolveComponent("el-button"),i=Vue.resolveComponent("el-form-item"),M=Vue.resolveComponent("el-input-number"),F=Vue.resolveComponent("el-form"),z=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ee,[Vue.createVNode(s,{modelValue:Vue.unref(n).data.materialNo,"onUpdate:modelValue":e[0]||(e[0]=t=>Vue.unref(n).data.materialNo=t),onChange:r,clearable:"",placeholder:Vue.unref(u).state.label.materialNo,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.materialDescription,"onUpdate:modelValue":e[1]||(e[1]=t=>Vue.unref(n).data.materialDescription=t),onChange:r,clearable:"",placeholder:Vue.unref(u).state.label.materialDescription,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.designNumber,"onUpdate:modelValue":e[2]||(e[2]=t=>Vue.unref(n).data.designNumber=t),onChange:r,clearable:"",placeholder:Vue.unref(u).state.label.designNumber,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.type,"onUpdate:modelValue":e[3]||(e[3]=t=>Vue.unref(n).data.type=t),onChange:r,clearable:"",placeholder:Vue.unref(u).state.label.type,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.materialDate,"onUpdate:modelValue":e[4]||(e[4]=t=>Vue.unref(n).data.materialDate=t),onChange:r,clearable:"",placeholder:Vue.unref(u).state.label.materialDate,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(_,{modelValue:Vue.unref(h),"onUpdate:modelValue":e[5]||(e[5]=t=>Vue.isRef(h)?h.value=t:null),onChange:U,clearable:"",type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start material date","end-placeholder":"End material date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(k,{modelValue:Vue.unref(n).data.inventoryCountType,"onUpdate:modelValue":e[6]||(e[6]=t=>Vue.unref(n).data.inventoryCountType=t),filterable:"","allow-create":"",clearable:"",onChange:r,placeholder:Vue.unref(u).state.label.inventoryCount},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList([{value:0,label:`${Vue.unref(u).state.label.inventoryCount}!=${Vue.unref(u).state.label.materialCount}`}],t=>(Vue.openBlock(),Vue.createBlock(L,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",te,[Vue.createVNode(y,{icon:Vue.unref(j),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[ae]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(G),onClick:K,type:"success"},{default:Vue.withCtx(()=>[le]),_:1},8,["icon"])])]),Vue.createVNode(W,{idKey:"inventoryId",columnConfigList:D.value,list:Vue.unref(O),handleEdit:S,handleUpdate:w,handleDelete:B,page:Vue.unref(n).page,total:Vue.unref(I),handleTableRowClassName:Y,handlePageChange:q,handleLimitChange:$},null,8,["columnConfigList","list","page","total"]),Vue.createVNode(z,{title:Vue.unref(f)?"Add":"Edit",modelValue:Vue.unref(c),"onUpdate:modelValue":e[17]||(e[17]=t=>Vue.isRef(c)?c.value=t:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",ue,[Vue.createVNode(y,{onClick:e[16]||(e[16]=t=>c.value=!1)},{default:Vue.withCtx(()=>[oe]),_:1}),Vue.createVNode(y,{type:"primary",onClick:A},{default:Vue.withCtx(()=>[re]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(F,{rules:Vue.unref(V),model:Vue.unref(o),ref_key:"formRef",ref:g,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{prop:"materialNo",label:Vue.unref(u).state.label.materialNo},{default:Vue.withCtx(()=>[Vue.createVNode(s,{modelValue:Vue.unref(o).materialNo,"onUpdate:modelValue":e[7]||(e[7]=t=>Vue.unref(o).materialNo=t)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"materialDescription",label:Vue.unref(u).state.label.materialDescription},{default:Vue.withCtx(()=>[Vue.createVNode(s,{modelValue:Vue.unref(o).materialDescription,"onUpdate:modelValue":e[8]||(e[8]=t=>Vue.unref(o).materialDescription=t)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"designNumber",label:Vue.unref(u).state.label.designNumber},{default:Vue.withCtx(()=>[Vue.createVNode(s,{modelValue:Vue.unref(o).designNumber,"onUpdate:modelValue":e[9]||(e[9]=t=>Vue.unref(o).designNumber=t)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"inventoryCount",label:Vue.unref(u).state.label.inventoryCount},{default:Vue.withCtx(()=>[Vue.createVNode(M,{modelValue:Vue.unref(o).inventoryCount,"onUpdate:modelValue":e[10]||(e[10]=t=>Vue.unref(o).inventoryCount=t),style:{width:"60px"},controls:!1,min:0,max:999999},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"inventoryDate",label:Vue.unref(u).state.label.inventoryDate},{default:Vue.withCtx(()=>[Vue.createVNode(_,{type:"date",modelValue:Vue.unref(o).inventoryDate,"onUpdate:modelValue":e[11]||(e[11]=t=>Vue.unref(o).inventoryDate=t),format:"YYYY-MM-DD",onChange:e[12]||(e[12]=t=>Vue.unref(o).inventoryDate=Vue.unref(v)(Vue.unref(o).inventoryDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"type",label:Vue.unref(u).state.label.type},{default:Vue.withCtx(()=>[Vue.createVNode(k,{modelValue:Vue.unref(o).type,"onUpdate:modelValue":e[13]||(e[13]=t=>Vue.unref(o).type=t),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.type},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(R).inventoryOutOfPlanTypeList,t=>(Vue.openBlock(),Vue.createBlock(L,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"description",label:Vue.unref(u).state.label.description},{default:Vue.withCtx(()=>[Vue.createVNode(s,{modelValue:Vue.unref(o).description,"onUpdate:modelValue":e[14]||(e[14]=t=>Vue.unref(o).description=t)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"materialCount",label:Vue.unref(u).state.label.materialCount},{default:Vue.withCtx(()=>[Vue.createVNode(M,{modelValue:Vue.unref(o).materialCount,"onUpdate:modelValue":e[15]||(e[15]=t=>Vue.unref(o).materialCount=t),style:{width:"60px"},controls:!1,min:0,max:999999,disabled:!Vue.unref(f)&&!Vue.unref(p)},null,8,["modelValue","disabled"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"photoList",label:`${Vue.unref(u).state.label.photoDescribe}(${(Vue.unref(V).photoList||[]).reduce((t,d)=>`Min: ${d.min}, Max: ${d.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(X,{disabled:!Vue.unref(f)&&!Vue.unref(p),photoList:Vue.unref(o).photoList,maxSize:+`${(Vue.unref(V).photoList||[]).reduce((t,d)=>d.max,999)}`},null,8,["disabled","photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(i,{prop:"attachmentList",label:`${Vue.unref(u).state.label.attachment}(${(Vue.unref(V).fileList||[]).reduce((t,d)=>`Min: ${d.min}, Max: ${d.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(Z,{disabled:!Vue.unref(f)&&!Vue.unref(p),fileList:Vue.unref(o).attachmentList,maxSize:+`${(Vue.unref(V).fileList||[]).reduce((t,d)=>d.max,999)}`},null,8,["disabled","fileList","maxSize"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{he as default};
