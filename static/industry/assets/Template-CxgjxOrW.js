import{s as X,p as Z,m as k}from"./index-DfY7MOwJ.js";import{i as f,h as M,o as c,q as ee,b as te,a as ae}from"./main-Dirrnzcr.js";import{D as le,a as re}from"./Common-dWa9BEsb.js";import{V as m}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as oe}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as E}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ue={class:"query-container"},ne={class:"query-btn"},se=Vue.createTextVNode("Search"),ie=Vue.createTextVNode("Add "),de=Vue.createTextVNode("Print "),me=Vue.createTextVNode("Print"),Ve={class:"dialog-footer"},pe=Vue.createTextVNode("Cancel"),fe=Vue.createTextVNode("Confirm"),Pe=Vue.defineComponent({__name:"Template",setup(ce){const C=Vue.ref([]),q=a=>{C.value=a.map(t=>t.templateId)};VueRouter.useRouter();const o=Vuex.useStore(),b=o.state.user,V=o.state.roleCodeList,x=Vue.ref(null),g=Vue.ref(new Array),D=Vue.ref([{value:"selection",labelKey:"",width:55,type:m.Selection},{value:"expand",label:"",width:48,type:m.Expand},{value:"operator",labelKey:"viewAndEdit",width:312,type:m.Operator},{value:"index",labelKey:"index",width:45},{value:"borrowTemplateDate",labelKey:"borrowTemplateDate",width:102},{value:"borrowTemplatePersonFormat",labelKey:"borrowTemplatePerson",width:132},{value:"materialNo",labelKey:"materialNo",width:145},{value:"materialDescription",labelKey:"materialDescription",width:189},{value:"templateCount",labelKey:"templateCount",width:49},{value:"promiseReturnDate",labelKey:"promiseReturnDate",width:102},{value:"operatorPersonFormat",labelKey:"operatorPerson",width:132},{value:"borrowPhotoCount",labelKey:"borrowPhotoCount",width:49},{value:"returnPhotoCount",labelKey:"returnPhotoCount",width:49},{value:"description",labelKey:"description",width:189},{value:"returnCount",labelKey:"returnCount",width:49},{value:"actualReturnDate",labelKey:"actualReturnDate",width:102},{value:"meetRequirementFormat",labelKey:"meetRequirement",width:59},{value:"templateOrderNo",labelKey:"templateOrderNo",width:123},{value:"borrowPhotoList",labelKey:"borrowPhoto",width:189,type:m.Image},{value:"returnPhotoList",labelKey:"returnPhoto",width:189,type:m.Image}]);(b.username==="admin"||f(V,"templateManager"))&&(D.value=D.value.map(a=>(a.value==="description"?a.type=m.TextEdit:a.value==="returnCount"&&(a.width=161,a.type=m.NumberEdit),a))),M("system/user/config/list",{}).then(a=>{r.userConfigList=a.list||[],g.value=r.userConfigList.map(t=>({value:t.userId,label:t.name}))});const _={creator:b.userId,borrowTemplateDate:c(new Date,"yyyy-MM-dd"),borrowTemplatePerson:"",materialNo:"",materialDescription:"",templateCount:"",promiseReturnDate:"",operatorPerson:"",borrowPhotoCount:0,returnPhotoCount:0,description:"",returnCount:0,actualReturnDate:"",meetRequirement:"",templateOrderNo:"",borrowPhotoList:new Array,returnPhotoList:new Array},r=Vue.reactive({dateTimeList:[],photoVisible:!1,photoList:new Array,userConfigList:new Array,expandRowKeys:new Array,query:{data:{templateOrderNo:"",borrowTemplatePerson:"",materialNo:"",materialDescription:"",alreadyReturn:null,meetRequirement:null,meetRequirementType:null,startPromiseReturnDate:"",endPromiseReturnDate:""},page:{page:re,limit:le}},tableData:new Array,total:0,formData:Object.assign({},_),config:{},formSave:!0,formVisible:!1,managerEdit:!1,formRuleList:{borrowTemplateDate:[{required:!0,message:"Please check",trigger:"blur"}],promiseReturnDate:[{required:!0,message:"Please check",trigger:"blur"}],operatorPerson:[{required:!0,message:"Please check",trigger:"blur"}],borrowTemplatePerson:[{required:!0,message:"Please check",trigger:"blur"}],materialNo:[{required:!0,message:"Please check",trigger:"blur"}],templateCount:[{required:!0,message:"Please check",trigger:"blur"}],materialDescription:[{required:!0,message:"Please check",trigger:"blur"}],borrowPhotoList:[{required:!1,type:"array",min:0,max:6}],returnPhotoList:[{required:!1,type:"array",min:0,max:6}]}}),U=()=>{r.dateTimeList&&r.dateTimeList.length>1?(r.query.data.startPromiseReturnDate=c(r.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),r.query.data.endPromiseReturnDate=c(r.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(r.query.data.startPromiseReturnDate="",r.query.data.endPromiseReturnDate=""),u()},K=a=>{C.value=[a.param.templateId],R()},R=()=>{C.value.length<=0?ElementPlus.ElMessage.error("Please select"):window.open(`/industry/public/template?templateIdList=${C.value}`)},u=()=>{M("douson/admin/template/page",r.query).then(a=>{r.tableData=a.list,r.total=a.total,ElementPlus.ElMessage.success("Query success")})},S=a=>{r.query.page.page=a,u()},Y=a=>{r.query.page.limit=a,u()};u();const $=()=>{r.formData=Object.assign({},_),r.formVisible=!0,r.formSave=!0},B=(a,t=!1)=>{r.managerEdit=t,r.formVisible=!0,r.formSave=!1,r.formData=Object.assign({},a)},A=a=>!!(b.username==="admin"||f(V,"templateManager")||f(V,"templateView")),I=()=>{x.value.validate(a=>{a&&(r.formSave?ee("douson/admin/template",r.formData).then(()=>{r.formVisible=!1,ElementPlus.ElMessage.success("Add success"),u()}):T(r.formData))})},T=a=>te("douson/admin/template",a).then(()=>{r.formVisible=!1,ElementPlus.ElMessage.success("Update success"),u()}),O=a=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ae("douson/admin/template",{templateId:a.templateId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),u()})})},{query:n,tableData:F,total:z,dateTimeList:P,formData:l,formSave:j,formVisible:v,formRuleList:h}={...Vue.toRefs(r)},G=({row:a,rowIndex:t})=>a.returnCount>=a.templateCount?"row-done":a.meetRequirement!=null&&!a.meetRequirement?"row-error":"";return(a,t)=>{const p=Vue.resolveComponent("el-input"),d=Vue.resolveComponent("el-option"),w=Vue.resolveComponent("el-select"),N=Vue.resolveComponent("el-date-picker"),y=Vue.resolveComponent("el-button"),J=Vue.resolveComponent("el-tag"),Q=Vue.resolveComponent("el-link"),s=Vue.resolveComponent("el-form-item"),L=Vue.resolveComponent("el-input-number"),H=Vue.resolveComponent("el-form"),W=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ue,[Vue.createVNode(p,{modelValue:Vue.unref(n).data.templateOrderNo,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(n).data.templateOrderNo=e),onChange:u,clearable:"",placeholder:Vue.unref(o).state.label.templateOrderNo,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(w,{modelValue:Vue.unref(n).data.borrowTemplatePerson,"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.unref(n).data.borrowTemplatePerson=e),onChange:u,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.borrowTemplatePerson,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(g.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(n).data.materialNo,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(n).data.materialNo=e),onChange:u,clearable:"",placeholder:Vue.unref(o).state.label.materialNo,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(n).data.materialDescription,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(n).data.materialDescription=e),onChange:u,clearable:"",placeholder:Vue.unref(o).state.label.materialDescription,class:"search-item"},null,8,["modelValue","placeholder"]),Vue.createVNode(w,{modelValue:Vue.unref(n).data.alreadyReturn,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(n).data.alreadyReturn=e),onChange:u,clearable:"",placeholder:Vue.unref(o).state.label.isReturn},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:"Yes",value:!0}),Vue.createVNode(d,{label:"No",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(w,{modelValue:Vue.unref(n).data.meetRequirementType,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(n).data.meetRequirementType=e),onChange:u,clearable:"",placeholder:Vue.unref(o).state.label.meetRequirement},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:"Yes",value:1}),Vue.createVNode(d,{label:"No",value:0}),Vue.createVNode(d,{label:"--",value:-1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(N,{modelValue:Vue.unref(P),"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.isRef(P)?P.value=e:null),onChange:U,clearable:"",type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start promise return date","end-placeholder":"End promise return date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createElementVNode("div",ne,[Vue.createVNode(y,{icon:Vue.unref(X),onClick:u,type:"primary"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(Z),onClick:$,type:"success"},{default:Vue.withCtx(()=>[ie]),_:1},8,["icon"]),Vue.createVNode(y,{icon:Vue.unref(k),onClick:R,type:"warning"},{default:Vue.withCtx(()=>[de]),_:1},8,["icon"])])]),Vue.createVNode(oe,{idKey:"templateId",columnConfigList:D.value,list:Vue.unref(F),handleEdit:B,handleUpdate:T,handleEditShow:A,handleDelete:Vue.unref(f)(Vue.unref(V),"admin")?O:null,page:Vue.unref(n).page,total:Vue.unref(z),handleTableRowClassName:G,handlePageChange:S,handleLimitChange:Y,handleSelectionChange:q},{operator:Vue.withCtx(e=>[Vue.createVNode(Q,{icon:Vue.unref(k),onClick:i=>K(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(J,{size:"small"},{default:Vue.withCtx(()=>[me]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","handleDelete","page","total"]),Vue.createVNode(W,{title:Vue.unref(j)?"Add":"Edit",modelValue:Vue.unref(v),"onUpdate:modelValue":t[21]||(t[21]=e=>Vue.isRef(v)?v.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",Ve,[Vue.createVNode(y,{onClick:t[20]||(t[20]=e=>v.value=!1)},{default:Vue.withCtx(()=>[pe]),_:1}),Vue.createVNode(y,{type:"primary",onClick:I},{default:Vue.withCtx(()=>[fe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(H,{rules:Vue.unref(h),model:Vue.unref(l),ref_key:"formRef",ref:x,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(s,{prop:"borrowTemplateDate",label:Vue.unref(o).state.label.borrowTemplateDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(l).borrowTemplateDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(l).borrowTemplateDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(l).borrowTemplateDate=Vue.unref(c)(Vue.unref(l).borrowTemplateDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"borrowTemplatePerson",label:Vue.unref(o).state.label.borrowTemplatePerson},{default:Vue.withCtx(()=>[Vue.createVNode(w,{modelValue:Vue.unref(l).borrowTemplatePerson,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(l).borrowTemplatePerson=e),filterable:"",clearable:"",placeholder:Vue.unref(o).state.label.borrowTemplatePerson},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(g.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"materialNo",label:Vue.unref(o).state.label.materialNo},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(l).materialNo,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(l).materialNo=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"materialDescription",label:Vue.unref(o).state.label.materialDescription},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(l).materialDescription,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(l).materialDescription=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"templateCount",label:Vue.unref(o).state.label.templateCount},{default:Vue.withCtx(()=>[Vue.createVNode(L,{modelValue:Vue.unref(l).templateCount,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(l).templateCount=e),style:{width:"60px"},controls:!1,min:0},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"promiseReturnDate",label:Vue.unref(o).state.label.promiseReturnDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(l).promiseReturnDate,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(l).promiseReturnDate=e),format:"YYYY-MM-DD",onChange:t[14]||(t[14]=e=>Vue.unref(l).promiseReturnDate=Vue.unref(c)(Vue.unref(l).promiseReturnDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"operatorPerson",label:Vue.unref(o).state.label.operatorPerson},{default:Vue.withCtx(()=>[Vue.createVNode(w,{modelValue:Vue.unref(l).operatorPerson,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(l).operatorPerson=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.operatorPerson},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(g.value,e=>(Vue.openBlock(),Vue.createBlock(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"description",label:Vue.unref(o).state.label.description},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"textarea",rows:4,modelValue:Vue.unref(l).description,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(l).description=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"returnCount",label:Vue.unref(o).state.label.returnCount},{default:Vue.withCtx(()=>[Vue.createVNode(L,{modelValue:Vue.unref(l).returnCount,"onUpdate:modelValue":t[17]||(t[17]=e=>Vue.unref(l).returnCount=e),style:{width:"60px"},controls:!1,min:0,disabled:!(Vue.unref(b).username==="admin"||Vue.unref(f)(Vue.unref(V),"templateManager"))},null,8,["modelValue","disabled"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"actualReturnDate",label:Vue.unref(o).state.label.actualReturnDate},{default:Vue.withCtx(()=>[Vue.createVNode(N,{type:"date",modelValue:Vue.unref(l).actualReturnDate,"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.unref(l).actualReturnDate=e),format:"YYYY-MM-DD",onChange:t[19]||(t[19]=e=>Vue.unref(l).actualReturnDate=Vue.unref(c)(Vue.unref(l).actualReturnDate,"yyyy-MM-dd")),disabled:!(Vue.unref(b).username==="admin"||Vue.unref(f)(Vue.unref(V),"templateManager"))},null,8,["modelValue","disabled"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"borrowPhotoList",label:`${Vue.unref(o).state.label.borrowPhoto}(${(Vue.unref(h).borrowPhotoList||[]).reduce((e,i)=>`Min: ${i.min}, Max: ${i.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{photoList:Vue.unref(l).borrowPhotoList,maxSize:+`${(Vue.unref(h).borrowPhotoList||[]).reduce((e,i)=>i.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"returnPhotoList",label:`${Vue.unref(o).state.label.returnPhoto}(${(Vue.unref(h).returnPhotoList||[]).reduce((e,i)=>`Min: ${i.min}, Max: ${i.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(E,{photoList:Vue.unref(l).returnPhotoList,maxSize:+`${(Vue.unref(h).returnPhotoList||[]).reduce((e,i)=>i.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{Pe as default};
