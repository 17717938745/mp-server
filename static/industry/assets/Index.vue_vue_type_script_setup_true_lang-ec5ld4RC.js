import{s as A,p as O}from"./index-DfY7MOwJ.js";import{o as V,h as y,i as I,q as $,b as j,a as G}from"./main-Dirrnzcr.js";import{D as J,a as z}from"./Common-dWa9BEsb.js";import{V as C}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as Q}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";const H={class:"query-container"},W={class:"query-btn"},X=Vue.createTextVNode("Search"),Z=Vue.createTextVNode("Add "),ee={style:{"font-size":"26px","font-weight":"bold"}},ae={style:{"font-weight":"bold"}},te={class:"dialog-footer"},le=Vue.createTextVNode("Cancel"),oe=Vue.createTextVNode("Confirm"),Ve=Vue.defineComponent({__name:"Index",setup(ue){VueRouter.useRouter();const o=Vuex.useStore();o.state.user;const k=o.state.roleCodeList,g=Vue.ref(null),c=Vue.ref(new Array),_=Vue.ref([{value:"expand",label:"",width:48,type:C.Expand},{value:"operator",labelKey:"viewAndEdit",width:231,type:C.Operator},{value:"index",labelKey:"index",width:51},{value:"vocationTypeFormat",labelKey:"vocationType",width:178},{value:"date",labelKey:"vocationDate",width:102},{value:"userFormat",labelKey:"vocationUser",width:189},{value:"chargeUserFormat",labelKey:"vocationChargeUser",width:189},{value:"departmentFormat",labelKey:"department",width:168},{value:"professionFormat",labelKey:"profession",width:189},{value:"startDate",labelKey:"vocationStartDate",width:102},{value:"endDate",labelKey:"vocationEndDate",width:102},{value:"reason",labelKey:"vocationReason",width:254,showOverflow:!0},{value:"count",labelKey:"vocationDays",width:96},{value:"complianceFormat",labelKey:"vocationCompliance",width:76},{value:"violationReason",labelKey:"violationReason",width:254,showOverflow:!0}]),h={vocationType:"",date:V(new Date,"yyyy-MM-dd"),user:"",chargeUser:"",startDate:"",endDate:"",reason:"",dateTimeList:[],count:0,compliance:!0,violationReason:""},t=Vue.reactive({dateTimeList:[],userConfigList:new Array,query:{data:{department:"",vocationType:"",user:"",date:"",startDate:"",endDate:"",compliance:null},page:{page:z,limit:J}},tableData:new Array,summaryData:{},total:0,formData:Object.assign({},h),formSave:!1,config:{vocationTypeList:[],departmentList:[]},formVisible:!1,managerEdit:!1,formRuleList:{vocationType:[{required:!0,message:"Please check",trigger:"blur"}],date:[{required:!0,message:"Please check",trigger:"blur"}],user:[{required:!0,message:"Please check",trigger:"blur"}],chargeUser:[{required:!0,message:"Please check",trigger:"blur"}],dateTimeList:[{required:!0,type:"array",message:"Please check",min:2,max:2}],reason:[{required:!0,message:"Please check",trigger:"blur"}],count:[{required:!0,message:"Please check",trigger:"blur"}],compliance:[{required:!0,message:"Please check",trigger:"blur"}]}}),x=()=>{t.dateTimeList&&t.dateTimeList.length>1?(t.query.data.startDate=V(t.dateTimeList[0],"yyyy-MM-dd"),t.query.data.endDate=V(t.dateTimeList[1],"yyyy-MM-dd")):(t.query.data.startDate="",t.query.data.endDate=""),r()};Promise.all([y("douson/config",{categoryIdList:["vocationType","department"]}),y("system/user/config/list",{})]).then(u=>{t.config=u[0].data,c.value=(u[1].list||[]).map(a=>({value:a.userId,label:a.name})),r()});const r=()=>{y("douson/admin/vocation/page",t.query).then(u=>{t.tableData=u.list,t.total=u.total,t.summaryData=u.data||{},ElementPlus.ElMessage.success("Query success")})},N=u=>{t.query.page.page=u,r()},L=u=>{t.query.page.limit=u,r()},T=()=>{t.formData=Object.assign({},h),t.formVisible=!0,t.formSave=!0},E=(u,a=!1)=>{t.managerEdit=a,t.formVisible=!0,t.formSave=!1,t.formData=Object.assign({},u),t.formData.dateTimeList=[t.formData.startDate,t.formData.endDate]},U=()=>{g.value.validate(u=>{if(u){if(!l.value.compliance&&!l.value.violationReason){ElementPlus.ElMessage.error(`${o.state.label.violationReason} is required`);return}t.formData.dateTimeList&&t.formData.dateTimeList.length>1?(t.formData.startDate=V(t.formData.dateTimeList[0],"yyyy-MM-dd"),t.formData.endDate=V(t.formData.dateTimeList[1],"yyyy-MM-dd")):(t.formData.startDate="",t.formData.endDate=""),t.formSave?$("douson/admin/vocation",t.formData).then(()=>{t.formVisible=!1,ElementPlus.ElMessage.success("Add success"),r()}):D(t.formData)}})},D=u=>j("douson/admin/vocation",u).then(()=>{t.formVisible=!1,ElementPlus.ElMessage.success("Update success"),r()}),B=u=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{G("douson/admin/vocation",{vocationId:u.vocationId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r()})})},{query:n,tableData:M,summaryData:q,config:v,total:P,dateTimeList:b,formData:l,formSave:R,formVisible:m,formRuleList:F}={...Vue.toRefs(t)};return(u,a)=>{const s=Vue.resolveComponent("el-option"),i=Vue.resolveComponent("el-select"),p=Vue.resolveComponent("el-date-picker"),f=Vue.resolveComponent("el-button"),d=Vue.resolveComponent("el-form-item"),w=Vue.resolveComponent("el-input"),Y=Vue.resolveComponent("el-input-number"),K=Vue.resolveComponent("el-form"),S=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",H,[Vue.createVNode(i,{modelValue:Vue.unref(n).data.department,"onUpdate:modelValue":a[0]||(a[0]=e=>Vue.unref(n).data.department=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.department,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(v).departmentList,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(i,{modelValue:Vue.unref(n).data.vocationType,"onUpdate:modelValue":a[1]||(a[1]=e=>Vue.unref(n).data.vocationType=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationType,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(v).vocationTypeList,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(i,{modelValue:Vue.unref(n).data.user,"onUpdate:modelValue":a[2]||(a[2]=e=>Vue.unref(n).data.user=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationUser,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(p,{type:"date",modelValue:Vue.unref(n).data.date,"onUpdate:modelValue":a[3]||(a[3]=e=>Vue.unref(n).data.date=e),format:"YYYY-MM-DD",placeholder:Vue.unref(o).state.label.vocationDate,onChange:a[4]||(a[4]=e=>{Vue.unref(n).data.date=Vue.unref(V)(Vue.unref(n).data.date,"yyyy-MM-dd"),r()})},null,8,["modelValue","placeholder"]),Vue.createVNode(p,{modelValue:Vue.unref(b),"onUpdate:modelValue":a[5]||(a[5]=e=>Vue.isRef(b)?b.value=e:null),onChange:x,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start due date","end-placeholder":"End due date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(i,{modelValue:Vue.unref(n).data.compliance,"onUpdate:modelValue":a[6]||(a[6]=e=>Vue.unref(n).data.compliance=e),filterable:"","allow-create":"",clearable:"",onChange:r,placeholder:Vue.unref(o).state.label.vocationCompliance},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList([{value:!0,label:"YES"},{value:!1,label:"NO"}],e=>Vue.createVNode(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"]),Vue.createElementVNode("div",W,[Vue.createVNode(f,{icon:Vue.unref(A),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[X]),_:1},8,["icon"]),Vue.createVNode(f,{icon:Vue.unref(O),onClick:T,type:"success"},{default:Vue.withCtx(()=>[Z]),_:1},8,["icon"])])]),Vue.createElementVNode("div",null,[Vue.createElementVNode("span",ee,Vue.toDisplayString(Vue.unref(o).state.label.vocationDays)+":",1),Vue.createElementVNode("span",ae,Vue.toDisplayString(Vue.unref(q).vocationDaysFormat),1)]),Vue.createVNode(Q,{idKey:"vocationId",columnConfigList:_.value,list:Vue.unref(M),handleEdit:E,handleUpdate:D,handleDelete:Vue.unref(I)(Vue.unref(k),"admin")?B:null,page:Vue.unref(n).page,total:Vue.unref(P),handlePageChange:N,handleLimitChange:L},{operator:Vue.withCtx(e=>[]),_:1},8,["columnConfigList","list","handleDelete","page","total"]),Vue.createVNode(S,{title:Vue.unref(R)?"Add":"Edit",modelValue:Vue.unref(m),"onUpdate:modelValue":a[18]||(a[18]=e=>Vue.isRef(m)?m.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",te,[Vue.createVNode(f,{onClick:a[17]||(a[17]=e=>m.value=!1)},{default:Vue.withCtx(()=>[le]),_:1}),Vue.createVNode(f,{type:"primary",onClick:U},{default:Vue.withCtx(()=>[oe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(K,{rules:Vue.unref(F),model:Vue.unref(l),ref_key:"formRef",ref:g,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{prop:"vocationType",label:Vue.unref(o).state.label.vocationType},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:Vue.unref(l).vocationType,"onUpdate:modelValue":a[7]||(a[7]=e=>Vue.unref(l).vocationType=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationType},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(v).vocationTypeList,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"date",label:Vue.unref(o).state.label.vocationDate},{default:Vue.withCtx(()=>[Vue.createVNode(p,{type:"date",modelValue:Vue.unref(l).date,"onUpdate:modelValue":a[8]||(a[8]=e=>Vue.unref(l).date=e),format:"YYYY-MM-DD",onChange:a[9]||(a[9]=e=>Vue.unref(l).date=Vue.unref(V)(Vue.unref(l).date,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"user",label:Vue.unref(o).state.label.vocationUser},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:Vue.unref(l).user,"onUpdate:modelValue":a[10]||(a[10]=e=>Vue.unref(l).user=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"chargeUser",label:Vue.unref(o).state.label.vocationChargeUser},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:Vue.unref(l).chargeUser,"onUpdate:modelValue":a[11]||(a[11]=e=>Vue.unref(l).chargeUser=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationChargeUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(c.value,e=>(Vue.openBlock(),Vue.createBlock(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"dateTimeList",label:Vue.unref(o).state.label.vocationDate},{default:Vue.withCtx(()=>[Vue.createVNode(p,{modelValue:Vue.unref(l).dateTimeList,"onUpdate:modelValue":a[12]||(a[12]=e=>Vue.unref(l).dateTimeList=e),type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"reason",label:Vue.unref(o).state.label.vocationReason},{default:Vue.withCtx(()=>[Vue.createVNode(w,{type:"textarea",rows:4,modelValue:Vue.unref(l).reason,"onUpdate:modelValue":a[13]||(a[13]=e=>Vue.unref(l).reason=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"count",label:Vue.unref(o).state.label.vocationDays},{default:Vue.withCtx(()=>[Vue.createVNode(Y,{modelValue:Vue.unref(l).count,"onUpdate:modelValue":a[14]||(a[14]=e=>Vue.unref(l).count=e),min:.1,controls:!1,precision:1},null,8,["modelValue","min"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"compliance",label:Vue.unref(o).state.label.vocationCompliance},{default:Vue.withCtx(()=>[Vue.createVNode(i,{modelValue:Vue.unref(l).compliance,"onUpdate:modelValue":a[15]||(a[15]=e=>Vue.unref(l).compliance=e),filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(o).state.label.vocationCompliance},{default:Vue.withCtx(()=>[(Vue.openBlock(),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList([{value:!0,label:"YES"},{value:!1,label:"NO"}],e=>Vue.createVNode(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"violationReason",label:Vue.unref(o).state.label.violationReason},{default:Vue.withCtx(()=>[Vue.createVNode(w,{type:"textarea",rows:4,modelValue:Vue.unref(l).violationReason,"onUpdate:modelValue":a[16]||(a[16]=e=>Vue.unref(l).violationReason=e)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{Ve as _};
