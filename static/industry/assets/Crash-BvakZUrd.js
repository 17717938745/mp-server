import{s as G,p as J,m as H}from"./index-DfY7MOwJ.js";import{o as m,h as x,i as W,q as X,b as Z,a as ee}from"./main-Dirrnzcr.js";import{D as le,a as ae}from"./Common-dWa9BEsb.js";import{V as f}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as te}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as ue}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import{_ as re}from"./FileUpload.vue_vue_type_script_setup_true_lang-BoA0mtAu.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const oe={class:"query-container"},ne={class:"query-btn"},se=Vue.createTextVNode("Search"),de=Vue.createTextVNode("Add"),ie=Vue.createTextVNode("Print"),Ve=Vue.createTextVNode(" Done "),ce={class:"dialog-footer"},me=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm"),De=Vue.defineComponent({__name:"Crash",setup(fe){VueRouter.useRouter();const q=VueRouter.useRoute(),u=Vuex.useStore(),I=u.state.roleCodeList,g=u.state.user,D=Vue.ref(null);Vue.ref(["0"]);const B=({row:r,column:l,rowIndex:d,columnIndex:v})=>C>=0&&C===v?"row-red":"",b=Vue.ref(new Array),L=Vue.ref([{value:"expand",label:"",width:48,type:f.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:f.Operator},{value:"index",labelKey:"index",width:80},{value:"reportDate",labelKey:"date",width:100},{value:"equipmentNo",labelKey:"equipmentNo",width:156},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentQualityDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"qualityReason",width:276,showOverflow:!0},{value:"solve",labelKey:"qualitySolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"qualityOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:f.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"photoList",labelKey:"qualityPhoto",width:128,type:f.Image},{value:"fileList",labelKey:"qualityFile",width:128,type:f.Attachment}]),E=r=>{window.open(`/industry/public/crash?crashId=${r.param.crashId}`)},_={reportDate:m(new Date,"yyyy-MM-dd"),userId:g.userId,userIdList:[g.userId],directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",improveDescribe:"",equipmentId:"",opinion:"",valid:!1,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},a=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{crashId:q.query.crashId,startReportDate:"",endReportDate:"",userId:"",equipmentId:"",accidentDescribe:"",reason:"",serialNo:"",reasonList:[],valid:!1},page:{page:ae,limit:le}},tableData:new Array,total:0,formData:Object.assign({},_),formSave:!1,config:{crashReasonList:[],equipmentNoList:[]},userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userIdList:[{required:!0,type:"array",message:"Please check",min:1,max:999}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}],fileList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});let C=-1;Promise.all([x("douson/config",{categoryIdList:["crashReason","equipmentNo"]}),x("system/user/config/list",{})]).then(r=>{a.config=r[0].data,b.value=(r[1].list||[]).map(l=>({value:l.userId,label:l.name})),L.value=L.value.map((l,d)=>(l.value==="serialNo"&&(C=d),l)),o()});const o=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=m(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=m(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),x("douson/admin/crash/page",a.query).then(r=>{const l=r.list||[];a.tableData=l,a.total=r.total,ElementPlus.ElMessage.success("Query success")})},R=r=>{a.query.page.page=r,o()},M=r=>{a.query.page.limit=r,o()},P=()=>{a.formData=Object.assign({},_),a.formData.userId=g.userId,a.formVisible=!0,a.formSave=!0},U=r=>{a.formVisible=!0,a.formSave=!1,a.formData=Object.assign({},r)},K=()=>{D.value.validate((r,l)=>{r?a.formSave?X("douson/admin/crash",a.formData).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Add success"),o()}):k(a.formData):ElementPlus.ElMessage.error("Please check input")})},k=r=>Z("douson/admin/crash",r).then(()=>{a.formVisible=!1,ElementPlus.ElMessage.success("Update success"),o()}),T=r=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/crash",{crashId:r.crashId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),o()})})},$=()=>{a.dateTimeList&&a.dateTimeList.length>1?(a.query.data.startReportDate=m(a.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),a.query.data.endReportDate=m(a.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(a.query.data.startReportDate="",a.query.data.endReportDate=""),o()},{query:n,tableData:F,config:h,total:S,dateTimeList:N,formData:t,formSave:O,formVisible:y,formRuleList:p}={...Vue.toRefs(a)};return(r,l)=>{const d=Vue.resolveComponent("el-input"),v=Vue.resolveComponent("el-date-picker"),V=Vue.resolveComponent("el-option"),c=Vue.resolveComponent("el-select"),w=Vue.resolveComponent("el-button"),A=Vue.resolveComponent("el-tag"),Y=Vue.resolveComponent("el-link"),s=Vue.resolveComponent("el-form-item"),z=Vue.resolveComponent("el-checkbox"),Q=Vue.resolveComponent("el-form"),j=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",oe,[Vue.createVNode(d,{modelValue:Vue.unref(n).data.crashId,"onUpdate:modelValue":l[0]||(l[0]=e=>Vue.unref(n).data.crashId=e),onKeyup:Vue.withKeys(o,["enter"]),placeholder:Vue.unref(u).state.label.accidentCrash,clearable:"",onChange:o,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(v,{modelValue:Vue.unref(N),"onUpdate:modelValue":l[1]||(l[1]=e=>Vue.isRef(N)?N.value=e:null),onChange:$,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(c,{modelValue:Vue.unref(n).data.userId,"onUpdate:modelValue":l[2]||(l[2]=e=>Vue.unref(n).data.userId=e),onChange:o,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(c,{modelValue:Vue.unref(n).data.equipmentId,"onUpdate:modelValue":l[3]||(l[3]=e=>Vue.unref(n).data.equipmentId=e),onChange:o,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.equipmentNo},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(c,{modelValue:Vue.unref(n).data.reason,"onUpdate:modelValue":l[4]||(l[4]=e=>Vue.unref(n).data.reason=e),onChange:o,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.crashReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).crashReasonList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(n).data.accidentDescribe,"onUpdate:modelValue":l[5]||(l[5]=e=>Vue.unref(n).data.accidentDescribe=e),onKeyup:Vue.withKeys(o,["enter"]),placeholder:Vue.unref(u).state.label.accidentQualityDescribe,clearable:"",onChange:o,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(c,{modelValue:Vue.unref(n).data.valid,"onUpdate:modelValue":l[6]||(l[6]=e=>Vue.unref(n).data.valid=e),onChange:o,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(V,{label:"Done",value:!0}),Vue.createVNode(V,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(d,{modelValue:Vue.unref(n).data.serialNo,"onUpdate:modelValue":l[7]||(l[7]=e=>Vue.unref(n).data.serialNo=e),onKeyup:Vue.withKeys(o,["enter"]),placeholder:Vue.unref(u).state.label.templateOrderNo,clearable:"",onChange:o,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createElementVNode("div",ne,[Vue.createVNode(w,{icon:Vue.unref(G),onClick:o,type:"primary"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"]),Vue.createVNode(w,{icon:Vue.unref(J),onClick:P,type:"success"},{default:Vue.withCtx(()=>[de]),_:1},8,["icon"])])]),Vue.createVNode(te,{idKey:"crashId",columnConfigList:L.value,list:Vue.unref(F),handleEdit:U,handleUpdate:k,handleDelete:T,page:Vue.unref(n).page,total:Vue.unref(S),handlePageChange:R,handleLimitChange:M,detailLink:!1,handleTableCellClassName:B},{operator:Vue.withCtx(e=>[Vue.createVNode(Y,{icon:Vue.unref(H),onClick:i=>E(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(A,{size:"small"},{default:Vue.withCtx(()=>[ie]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(j,{title:Vue.unref(O)?"Add":"Edit",modelValue:Vue.unref(y),"onUpdate:modelValue":l[20]||(l[20]=e=>Vue.isRef(y)?y.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",ce,[Vue.createVNode(w,{onClick:l[19]||(l[19]=e=>y.value=!1)},{default:Vue.withCtx(()=>[me]),_:1}),Vue.createVNode(w,{type:"primary",onClick:K},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(Q,{rules:Vue.unref(p),model:Vue.unref(t),ref_key:"formRef",ref:D,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(s,{prop:"reportDate",label:Vue.unref(u).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(v,{type:"date",modelValue:Vue.unref(t).reportDate,"onUpdate:modelValue":l[8]||(l[8]=e=>Vue.unref(t).reportDate=e),format:"YYYY-MM-DD",onChange:l[9]||(l[9]=e=>Vue.unref(t).reportDate=Vue.unref(m)(Vue.unref(t).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"userIdList",label:Vue.unref(u).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(c,{modelValue:Vue.unref(t).userIdList,"onUpdate:modelValue":l[10]||(l[10]=e=>Vue.unref(t).userIdList=e),clearable:"",multiple:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"equipmentId",label:Vue.unref(u).state.label.equipmentNo},{default:Vue.withCtx(()=>[Vue.createVNode(c,{modelValue:Vue.unref(t).equipmentId,"onUpdate:modelValue":l[11]||(l[11]=e=>Vue.unref(t).equipmentId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).equipmentNoList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"directLeader",label:Vue.unref(u).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(c,{modelValue:Vue.unref(t).directLeader,"onUpdate:modelValue":l[12]||(l[12]=e=>Vue.unref(t).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(b.value,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"accidentDescribe",label:Vue.unref(u).state.label.accidentQualityDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(t).accidentDescribe,"onUpdate:modelValue":l[13]||(l[13]=e=>Vue.unref(t).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"photoList",label:`${Vue.unref(u).state.label.qualityPhoto}(${(Vue.unref(p).photoList||[]).reduce((e,i)=>`Min: ${i.min}, Max: ${i.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(ue,{photoList:Vue.unref(t).photoList,maxSize:+`${(Vue.unref(p).photoList||[]).reduce((e,i)=>i.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"fileList",label:`${Vue.unref(u).state.label.qualityFile}(${(Vue.unref(p).fileList||[]).reduce((e,i)=>`Min: ${i.min}, Max: ${i.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(re,{fileList:Vue.unref(t).fileList,maxSize:+`${(Vue.unref(p).fileList||[]).reduce((e,i)=>i.max,999)}`},null,8,["fileList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"reason",label:Vue.unref(u).state.label.qualityReason},{default:Vue.withCtx(()=>[Vue.createVNode(c,{modelValue:Vue.unref(t).reasonList,"onUpdate:modelValue":l[14]||(l[14]=e=>Vue.unref(t).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.qualityReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(h).crashReasonList,e=>(Vue.openBlock(),Vue.createBlock(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"solve",label:Vue.unref(u).state.label.qualitySolve},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(t).solve,"onUpdate:modelValue":l[15]||(l[15]=e=>Vue.unref(t).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"improveDescribe",label:Vue.unref(u).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(t).improveDescribe,"onUpdate:modelValue":l[16]||(l[16]=e=>Vue.unref(t).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"opinion",label:Vue.unref(u).state.label.qualityOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(d,{type:"textarea",rows:4,modelValue:Vue.unref(t).opinion,"onUpdate:modelValue":l[17]||(l[17]=e=>Vue.unref(t).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(s,{prop:"valid",label:Vue.unref(u).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(z,{modelValue:Vue.unref(t).valid,"onUpdate:modelValue":l[18]||(l[18]=e=>Vue.unref(t).valid=e),name:"valid",disabled:!Vue.unref(W)(Vue.unref(I),"admin")},{default:Vue.withCtx(()=>[Ve]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{De as default};
