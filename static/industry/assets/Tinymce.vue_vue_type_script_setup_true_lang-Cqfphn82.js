import{t as N,b as _,h as k}from"./main-Dirrnzcr.js";import{e as M,p as A}from"./index-DfY7MOwJ.js";var P=["onActivate","onAddUndo","onBeforeAddUndo","onBeforeExecCommand","onBeforeGetContent","onBeforeRenderUI","onBeforeSetContent","onBeforePaste","onBlur","onChange","onClearUndos","onClick","onContextMenu","onCopy","onCut","onDblclick","onDeactivate","onDirty","onDrag","onDragDrop","onDragEnd","onDragGesture","onDragOver","onDrop","onExecCommand","onFocus","onFocusIn","onFocusOut","onGetContent","onHide","onInit","onKeyDown","onKeyPress","onKeyUp","onLoadContent","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onNodeChange","onObjectResizeStart","onObjectResized","onObjectSelected","onPaste","onPostProcess","onPostRender","onPreProcess","onProgressState","onRedo","onRemove","onReset","onSaveContent","onSelectionChange","onSetAttrib","onSetContent","onShow","onSubmit","onUndo","onVisualAid"],B=function(e){return P.map(function(o){return o.toLowerCase()}).indexOf(e.toLowerCase())!==-1},j=function(e,o,t){Object.keys(o).filter(B).forEach(function(l){var s=o[l];typeof s=="function"&&(l==="onInit"?s(e,t):t.on(l.substring(2),function(n){return s(n,t)}))})},L=function(e,o,t,l){var s=e.modelEvents?e.modelEvents:null,n=Array.isArray(s)?s.join(" "):s;Vue.watch(l,function(f,v){t&&typeof f=="string"&&f!==v&&f!==t.getContent({format:e.outputFormat})&&t.setContent(f)}),t.on(n||"change input undo redo",function(){o.emit("update:modelValue",t.getContent({format:e.outputFormat}))})},O=function(e,o,t,l,s,n){l.setContent(n()),t.attrs["onUpdate:modelValue"]&&L(o,t,l,s),j(e,t.attrs,l)},S=0,I=function(e){var o=Date.now(),t=Math.floor(Math.random()*1e9);return S++,e+"_"+t+S+String(o)},T=function(e){return e!==null&&e.tagName.toLowerCase()==="textarea"},x=function(e){return typeof e>"u"||e===""?[]:Array.isArray(e)?e:e.split(" ")},U=function(e,o){return x(e).concat(x(o))},R=function(e){return e==null},E=function(){return{listeners:[],scriptId:I("tiny-script"),scriptLoaded:!1}},z=function(){var e=E(),o=function(s,n,f,v){var c=n.createElement("script");c.referrerPolicy="origin",c.type="application/javascript",c.id=s,c.src=f;var h=function(){c.removeEventListener("load",h),v()};c.addEventListener("load",h),n.head&&n.head.appendChild(c)},t=function(s,n,f){e.scriptLoaded?f():(e.listeners.push(f),s.getElementById(e.scriptId)||o(e.scriptId,s,n,function(){e.listeners.forEach(function(v){return v()}),e.scriptLoaded=!0}))},l=function(){e=E()};return{load:t,reinitialize:l}},F=z(),G=function(){return typeof window<"u"?window:global},p=function(){var e=G();return e&&e.tinymce?e.tinymce:null},H={apiKey:String,cloudChannel:String,id:String,init:Object,initialValue:String,inline:Boolean,modelEvents:[String,Array],plugins:[String,Array],tagName:String,toolbar:[String,Array],modelValue:String,disabled:Boolean,tinymceScriptSrc:String,outputFormat:{type:String,validator:function(e){return e==="html"||e==="text"}}},b=function(){return b=Object.assign||function(e){for(var o,t=1,l=arguments.length;t<l;t++){o=arguments[t];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])}return e},b.apply(this,arguments)},K=function(e,o,t,l){return e(l||"div",{id:o,ref:t})},q=function(e,o,t){return e("textarea",{id:o,visibility:"hidden",ref:t})},$=Vue.defineComponent({props:H,setup:function(e,o){var t=e.init?b({},e.init):{},l=Vue.toRefs(e),s=l.disabled,n=l.modelValue,f=l.tagName,v=Vue.ref(null),c=null,h=e.id||I("tiny-vue"),y=e.init&&e.init.inline||e.inline,C=!!o.attrs["onUpdate:modelValue"],i=!0,a=e.initialValue?e.initialValue:"",r="",m=function(d){return C?function(){return n!=null&&n.value?n.value:""}:function(){return d?a:r}},u=function(){var d=m(i),g=b(b({},t),{readonly:e.disabled,selector:"#"+h,plugins:U(t.plugins,e.plugins),toolbar:e.toolbar||t.toolbar,inline:y,setup:function(V){c=V,V.on("init",function(D){return O(D,e,o,V,n,d)}),typeof t.setup=="function"&&t.setup(V)}});T(v.value)&&(v.value.style.visibility=""),p().init(g),i=!1};Vue.watch(s,function(d){var g;c!==null&&(typeof((g=c.mode)===null||g===void 0?void 0:g.set)=="function"?c.mode.set(d?"readonly":"design"):c.setMode(d?"readonly":"design"))}),Vue.watch(f,function(d){var g;C||(r=c.getContent()),(g=p())===null||g===void 0||g.remove(c),Vue.nextTick(function(){return u()})}),Vue.onMounted(function(){if(p()!==null)u();else if(v.value&&v.value.ownerDocument){var d=e.cloudChannel?e.cloudChannel:"6",g=e.apiKey?e.apiKey:"no-api-key",V=R(e.tinymceScriptSrc)?"https://cdn.tiny.cloud/1/"+g+"/tinymce/"+d+"/tinymce.min.js":e.tinymceScriptSrc;F.load(v.value.ownerDocument,V,u)}}),Vue.onBeforeUnmount(function(){p()!==null&&p().remove(c)}),y||(Vue.onActivated(function(){i||u()}),Vue.onDeactivated(function(){var d;C||(r=c.getContent()),(d=p())===null||d===void 0||d.remove(c)}));var w=function(d){var g;r=c.getContent(),(g=p())===null||g===void 0||g.remove(c),t=b(b({},t),d),Vue.nextTick(function(){return u()})};return o.expose({rerender:w}),function(){return y?K(Vue.h,h,v,e.tagName):q(Vue.h,h,v)}}});const W={class:"query-container"},Y={class:"query-btn"},J=Vue.createTextVNode(" Go back "),Q={class:"flex justify-start items-center"},ee=Vue.defineComponent({__name:"Tinymce",props:{forumId:{default:""},goBack:null},setup(e){const o=e,t=Vue.ref(null),l=Vuex.useStore();l.state;const s=VueRouter.useRouter(),n=Vue.ref({forumId:o.forumId,h5Id:"",title:"",content:""}),f=Vue.reactive({submitDisable:!1,rules:{title:[{required:!0,message:"Please input",trigger:"blur"}]},editConfig:{height:1024,body_class:"douson-h5",content_css:["/third/css/report.css"],menubar:"",language:"zh_CN",branding:!1,convert_urls:!1,paste_data_images:!0,fontsize_formats:"12px 14px 16px 18px 20px 24px 26px 28px 30px 32px 36px",font_formats:"Times New Roman=times new roman;微软雅黑=Microsoft YaHei,Helvetica Neue;PingFang SC;sans-serif;苹果苹方=PingFang SC,Microsoft YaHei,sans-serif;宋体=simsun;serifsans-serif;Terminal=terminal;monaco;times",plugins:"autolink lists link image anchor media table paste fullscreen",toolbar:["h1 h2 h3 h4 h5 h6","fontselect fontsizeselect | bold italic underline strikethrough blockquote | forecolor backcolor |","alignleft aligncenter alignright alignjustify | lineheight | numlist bullist | fullWidthImage table | link","undo redo removeformat fullscreen"],file_picker_callback:function(i,a,r){console.log(`meta.filename: ${r.filename} ${r.filetype}`),r.filetype=="image"&&i("img.jpg",{alt:"My alt text",width:"100%"})},images_upload_handler:function(i,a,r){const m=new FormData;m.set("file",i.blob()),m.set("filename",i.filename),N("index/img",m).then(function(u){a(u.data.url,{src:u.data.url,width:"100%"}),ElementPlus.ElMessage.success("Image upload success")}).catch(u=>{r(`Image upload error: ${u}`)})},setup:function(i){let a;i.ui.registry.addToggleButton("fullWidthImage",{icon:"image",text:"",tooltip:"100%宽度",disabled:!1,onAction:function(r){a?a.getAttribute("width")!="100%"?a.setAttribute("width","100%"):a.removeAttribute("width"):(a=document.createElement("img"),a.setAttribute("src","/third/svg/link.svg"),a.setAttribute("width","100%"),i.insertContent(a.outerHTML))},onSetup:function(r){const m=function(u){u.element.nodeName.toLowerCase()==="img"?a=u.element:a=null};return i.on("NodeChange",m),function(u){console.log(`on off ... ${u}`),i.off("NodeChange",m)}}}),i.ui.registry.addButton("twoImage",{icon:"insert-time",text:"插入双图片",tooltip:"插入双图片",disabled:!0,onAction:function(r){i.insertContent('<div class="two-image"><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/></div>')},onSetup:function(r){const m=function(u){r.setDisabled(u.element.nodeName.toLowerCase()==="time")};return i.on("NodeChange",m),function(u){i.off("NodeChange",m)}}}),i.ui.registry.addButton("twoTwoImage",{icon:"insert-time",text:"插入2行双图片",tooltip:"插入2行双图片",disabled:!0,onAction:function(r){i.insertContent('<div class="two-two-image"><div><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/></div><div><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/><img alt="img" src="https://img1.baidu.com/it/u=4156257074,1029422296&fm=26&fmt=auto"/></div></div>')},onSetup:function(r){const m=function(u){r.setDisabled(u.element.nodeName.toLowerCase()==="time")};return i.on("NodeChange",m),function(u){i.off("NodeChange",m)}}})}}}),{submitDisable:v,rules:c,editConfig:h}={...Vue.toRefs(f)};Vue.onMounted(()=>{});const y=()=>{t.value.validate(i=>{i&&(f.submitDisable=!0,_("index/h5",n.value).then(a=>{n.value.h5Id=a.data.h5Id,_("forum/merge",n.value).then(r=>{ElementPlus.ElMessage.success("Merge success"),n.value.forumId=r.data.forumId,f.submitDisable=!1}).catch(r=>{f.submitDisable=!1})}).catch(a=>{f.submitDisable=!1}))})},C=()=>{n.value.forumId&&k("forum",{forumId:n.value.forumId}).then(i=>{ElementPlus.ElMessage.success("Query success"),n.value=Object.assign({},i.data||{})})};return Vue.watchEffect(()=>{}),Vue.watch(()=>o.forumId,i=>{n.value.forumId=i,C()},{immediate:!0}),(i,a)=>{const r=Vue.resolveComponent("el-button"),m=Vue.resolveComponent("el-input"),u=Vue.resolveComponent("el-form-item"),w=Vue.resolveComponent("el-form");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",W,[Vue.createElementVNode("div",Y,[Vue.createVNode(r,{submitDisable:Vue.unref(v),icon:n.value.forumId?Vue.unref(M):Vue.unref(A),onClick:y,type:n.value.forumId?"warning":"success"},{default:Vue.withCtx(()=>[Vue.createTextVNode(Vue.toDisplayString(n.value.forumId?"Update":"Save"),1)]),_:1},8,["submitDisable","icon","type"]),Vue.createVNode(r,{onClick:a[0]||(a[0]=d=>o.goBack?o.goBack():Vue.unref(s).back())},{default:Vue.withCtx(()=>[J]),_:1})])]),Vue.createElementVNode("div",Q,[Vue.createVNode(w,{model:n.value,rules:Vue.unref(c),ref_key:"formRef",ref:t,"label-width":"0px",class:"ms-content",onSubmit:a[3]||(a[3]=Vue.withModifiers(()=>{},["prevent"]))},{default:Vue.withCtx(()=>[Vue.createVNode(u,{prop:"title"},{default:Vue.withCtx(()=>[Vue.createVNode(m,{modelValue:n.value.title,"onUpdate:modelValue":a[1]||(a[1]=d=>n.value.title=d),style:{width:"100%"},class:"title",placeholder:Vue.unref(l).state.label.pleaseInputTitle},null,8,["modelValue","placeholder"])]),_:1}),Vue.createVNode(u,{class:"lead-header",prop:"content"},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref($),{style:{width:"100%"},"api-key":"nbcnaniqofnu4g2dlwt1fw508zxng4kwwve58f4lny5sx5nl",modelValue:n.value.content,"onUpdate:modelValue":a[2]||(a[2]=d=>n.value.content=d),init:Vue.unref(h),tinymceScriptSrc:"/third/tinymce/5.10.2-126/tinymce.min.js","model-events":"change keydown blur focus paste","output-format":"html","cloud-channel":"5-stable"},null,8,["modelValue","init"])]),_:1})]),_:1},8,["model","rules"])])])}}});export{ee as _};
