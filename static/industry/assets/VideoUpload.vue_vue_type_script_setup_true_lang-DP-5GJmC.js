import{n as V,B as h}from"./index-DfY7MOwJ.js";import{p,t as _}from"./main-Dirrnzcr.js";const f={key:0,class:"resources-upload"},v=Vue.createElementVNode("div",{class:"el-upload__text"},"Click to upload video",-1),g={width:"320",style:{"max-width":"100%"},controls:""},x=["src"],w=Vue.createTextVNode(" Your browser not support vidio tag "),N=Vue.defineComponent({__name:"VideoUpload",props:{videoList:null,maxSize:{default:4}},setup(u,{expose:a}){const e=u;VueRouter.useRouter(),VueRouter.useRoute(),Vuex.useStore(),a({});const n={},c=(s,o)=>{console.log("file change, length: "+o.length)},d=s=>(console.log("before upload file: "+s.uid),n[s.uid]=s,s),m=s=>{const o=Object.keys(n),i=Math.max((e.maxSize||0)-e.videoList.length,0);o.length>i?(ElementPlus.ElMessage.error(`Too many upload, limit: ${e.maxSize}, remain: ${i}, actual: ${o.length}`),o.forEach(t=>{delete n[t]})):o.length>0&&(Promise.all(o.map(t=>{const r=n[t],l=new FormData;return l.set("filename",r.name),l.set("file",r),_("index/video",l)})).then(t=>(t.forEach(r=>{const l=r.data;e.videoList.push({videoUrl:l.url,videoCompressUrl:l.compressUrl,extension:l.extension})}),Promise.resolve())).catch(t=>(ElementPlus.ElMessage.error("Upload failed"),Promise.reject())),o.forEach(t=>{delete n[t]}))};return Vue.watch(()=>e.videoList,s=>{},{immediate:!0}),(s,o)=>{const i=Vue.resolveComponent("el-icon"),t=Vue.resolveComponent("el-upload");return e.videoList?(Vue.openBlock(),Vue.createElementBlock("div",f,[Vue.withDirectives(Vue.createVNode(t,{action:"#","show-file-list":!1,"on-change":c,"before-upload":d,"http-request":m,multiple:"",drag:!0},{default:Vue.withCtx(()=>[Vue.createElementVNode("div",null,[Vue.createVNode(i,{style:{width:"76px",height:"76px"}},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(V),{style:{width:"5em",height:"5em"}})]),_:1}),v])]),_:1},512),[[Vue.vShow,e.videoList.length<e.maxSize]]),(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(e.videoList,(r,l)=>(Vue.openBlock(),Vue.createElementBlock("div",{key:r.videoUrl,class:"resources-view",style:{width:"100%"}},[Vue.createElementVNode("video",g,[Vue.createElementVNode("source",{src:Vue.unref(p)(r.videoUrl,""),type:"video/mp4"},null,8,x),w]),Vue.createVNode(i,{class:"close-btn",size:28,onClick:E=>e.videoList.splice(l,1)},{default:Vue.withCtx(()=>[Vue.createVNode(Vue.unref(h))]),_:2},1032,["onClick"])]))),128))])):Vue.createCommentVNode("",!0)}}});export{N as _};
