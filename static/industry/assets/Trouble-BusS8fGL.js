import{s as G,p as J,m as H}from"./index-DfY7MOwJ.js";import{o as c,h as D,i as W,q as X,b as Z,a as ee}from"./main-Dirrnzcr.js";import{D as te,a as le}from"./Common-dWa9BEsb.js";import{V as y}from"./ViewContent.vue_vue_type_script_setup_true_lang-Dpo1Y2zC.js";import{_ as ae}from"./ViewList.vue_vue_type_style_index_0_lang-qcv9jr1D.js";import{_ as oe}from"./ImageUpload.vue_vue_type_script_setup_true_lang-BZyBfOer.js";import"./IndustryUtil-CgRifmxX.js";import"./TableViewContent.vue_vue_type_script_setup_true_lang-5zjbO-p-.js";import"./TableColumnViewContent.vue_vue_type_script_setup_true_lang-s5dcpuXa.js";const ue={class:"query-container"},re={class:"query-btn"},ne=Vue.createTextVNode("Search"),se=Vue.createTextVNode("Add"),de=Vue.createTextVNode("Print"),ie=Vue.createTextVNode(" Done "),Ve={class:"dialog-footer"},ce=Vue.createTextVNode("Cancel"),pe=Vue.createTextVNode("Confirm"),_e=Vue.defineComponent({__name:"Trouble",setup(me){VueRouter.useRouter();const q=VueRouter.useRoute(),u=Vuex.useStore(),R=u.state.roleCodeList,_=u.state.user,x=Vue.ref(null),m=Vue.ref(new Array),v=Vue.ref([{value:"expand",label:"",width:48,type:y.Expand},{value:"operator",labelKey:"viewAndEdit",align:"center",width:248,type:y.Operator},{value:"index",labelKey:"index",width:80},{value:"photoCount",labelKey:"photoCount",width:57},{value:"reportDate",labelKey:"date",width:100},{value:"userIdFormat",labelKey:"partyUser",width:151},{value:"directLeaderFormat",labelKey:"directLeader",width:151},{value:"accidentDescribe",labelKey:"accidentQualityDescribe",width:276,showOverflow:!0},{value:"reasonFormat",labelKey:"qualityReason",width:276,showOverflow:!0},{value:"solve",labelKey:"qualitySolve",width:276,showOverflow:!0},{value:"improveDescribe",labelKey:"improveDescribe",width:276,showOverflow:!0},{value:"opinion",labelKey:"qualityOpinion",width:221},{value:"valid",labelKey:"valid",width:100,type:y.Valid},{value:"serialNo",labelKey:"templateOrderNo",width:100},{value:"photoList",labelKey:"qualityPhoto",width:128,type:y.Image}]),E=({row:o,column:t,rowIndex:s,columnIndex:b})=>w>=0&&w===b?"row-red":"",I=o=>{window.open(`/industry/public/trouble?troubleId=${o.param.troubleId}`)},L={reportDate:c(new Date,"yyyy-MM-dd"),userId:_.userId,directLeader:"",accidentDescribe:"",reason:"",reasonList:[],solve:"",equipmentId:"",toolDescribe:"",improveDescribe:"",opinion:"",valid:null,photoList:[],fileList:[],improvePhotoList:[],improveFileList:[]},l=Vue.reactive({dateTimeList:[],expandRowKeys:[],query:{data:{troubleId:q.query.troubleId,startReportDate:"",endReportDate:"",userId:"",reason:"",serialNo:"",accidentDescribe:"",reasonList:[],valid:!1},page:{page:le,limit:te}},tableData:new Array,total:0,formData:Object.assign({},L),formSave:!1,config:{troubleReasonList:[],equipmentNoList:[]},userOptionList:new Array,formVisible:!1,formRuleList:{reportDate:[{required:!0,message:"Please check",trigger:"blur"}],userId:[{required:!0,message:"Please check",trigger:"blur"}],directLeader:[{required:!0,message:"Please check",trigger:"blur"}],accidentDescribe:[{required:!0,message:"Please check",trigger:"blur"}],reasonList:[{required:!1,type:"array",message:"Please check",min:1,max:999}],photoList:[{required:!1,type:"array",message:"Please check",min:0,max:6}]}});let w=-1;Promise.all([D("douson/config",{categoryIdList:["troubleReason"]}),D("system/user/config/list",{})]).then(o=>{l.config=o[0].data,m.value=(o[1].list||[]).map(t=>({value:t.userId,label:t.name})),v.value=v.value.map((t,s)=>(t.value==="serialNo"&&(w=s),t)),r()});const r=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=c(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=c(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),D("douson/admin/trouble/page",l.query).then(o=>{const t=o.list||[];l.tableData=t,l.total=o.total,ElementPlus.ElMessage.success("Query success")})},M=o=>{l.query.page.page=o,r()},P=o=>{l.query.page.limit=o,r()},K=()=>{l.formData=Object.assign({},L),l.formData.userId=_.userId,l.formVisible=!0,l.formSave=!0},T=o=>{l.formVisible=!0,l.formSave=!1,l.formData=Object.assign({},o)},U=()=>{x.value.validate((o,t)=>{o?l.formSave?X("douson/admin/trouble",l.formData).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Add success"),r()}):N(l.formData):ElementPlus.ElMessage.error("Please check input")})},N=o=>Z("douson/admin/trouble",o).then(()=>{l.formVisible=!1,ElementPlus.ElMessage.success("Update success"),r()}),B=o=>{ElementPlus.ElMessageBox.confirm("Confirm Delete?","Tips",{type:"warning"}).then(()=>{ee("douson/admin/trouble",{troubleId:o.troubleId}).then(()=>{ElementPlus.ElMessage.success("Delete success"),r()})})},O=()=>{l.dateTimeList&&l.dateTimeList.length>1?(l.query.data.startReportDate=c(l.dateTimeList[0],"yyyy-MM-dd hh:mm:ss"),l.query.data.endReportDate=c(l.dateTimeList[1],"yyyy-MM-dd hh:mm:ss")):(l.query.data.startReportDate="",l.query.data.endReportDate=""),r()},{query:n,tableData:S,config:k,total:F,dateTimeList:g,formData:a,formSave:$,formVisible:f,formRuleList:C}={...Vue.toRefs(l)};return(o,t)=>{const s=Vue.resolveComponent("el-input"),b=Vue.resolveComponent("el-date-picker"),i=Vue.resolveComponent("el-option"),V=Vue.resolveComponent("el-select"),h=Vue.resolveComponent("el-button"),A=Vue.resolveComponent("el-tag"),Y=Vue.resolveComponent("el-link"),d=Vue.resolveComponent("el-form-item"),Q=Vue.resolveComponent("el-checkbox"),j=Vue.resolveComponent("el-form"),z=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createElementVNode("div",ue,[Vue.createVNode(s,{modelValue:Vue.unref(n).data.troubleId,"onUpdate:modelValue":t[0]||(t[0]=e=>Vue.unref(n).data.troubleId=e),onKeyup:Vue.withKeys(r,["enter"]),placeholder:Vue.unref(u).state.label.accidentQuality,clearable:"",onChange:r,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(b,{modelValue:Vue.unref(g),"onUpdate:modelValue":t[1]||(t[1]=e=>Vue.isRef(g)?g.value=e:null),onChange:O,type:"daterange",format:"YYYY-MM-DD","range-separator":"-","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"180px","margin-right":"20px"}},null,8,["modelValue"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.userId,"onUpdate:modelValue":t[2]||(t[2]=e=>Vue.unref(n).data.userId=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.partyUser},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(m.value,e=>(Vue.openBlock(),Vue.createBlock(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>Vue.unref(n).data.reason=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.troubleReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).troubleReasonList,e=>(Vue.openBlock(),Vue.createBlock(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.accidentDescribe,"onUpdate:modelValue":t[4]||(t[4]=e=>Vue.unref(n).data.accidentDescribe=e),onKeyup:Vue.withKeys(r,["enter"]),placeholder:Vue.unref(u).state.label.accidentQualityDescribe,clearable:"",onChange:r,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createVNode(V,{modelValue:Vue.unref(n).data.valid,"onUpdate:modelValue":t[5]||(t[5]=e=>Vue.unref(n).data.valid=e),onChange:r,filterable:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.valid,class:"search-item"},{default:Vue.withCtx(()=>[Vue.createVNode(i,{label:"Done",value:!0}),Vue.createVNode(i,{label:"Pending",value:!1})]),_:1},8,["modelValue","placeholder"]),Vue.createVNode(s,{modelValue:Vue.unref(n).data.serialNo,"onUpdate:modelValue":t[6]||(t[6]=e=>Vue.unref(n).data.serialNo=e),onKeyup:Vue.withKeys(r,["enter"]),placeholder:Vue.unref(u).state.label.templateOrderNo,clearable:"",onChange:r,class:"search-item"},null,8,["modelValue","onKeyup","placeholder"]),Vue.createElementVNode("div",re,[Vue.createVNode(h,{icon:Vue.unref(G),onClick:r,type:"primary"},{default:Vue.withCtx(()=>[ne]),_:1},8,["icon"]),Vue.createVNode(h,{icon:Vue.unref(J),onClick:K,type:"success"},{default:Vue.withCtx(()=>[se]),_:1},8,["icon"])])]),Vue.createVNode(ae,{idKey:"troubleId",columnConfigList:v.value,list:Vue.unref(S),handleEdit:T,handleUpdate:N,handleDelete:B,page:Vue.unref(n).page,total:Vue.unref(F),handlePageChange:M,handleLimitChange:P,detailLink:!1,handleTableCellClassName:E},{operator:Vue.withCtx(e=>[Vue.createVNode(Y,{icon:Vue.unref(H),onClick:p=>I(e),class:"mr10",type:"info"},{default:Vue.withCtx(()=>[Vue.createVNode(A,{size:"small"},{default:Vue.withCtx(()=>[de]),_:1})]),_:2},1032,["icon","onClick"])]),_:1},8,["columnConfigList","list","page","total"]),Vue.createVNode(z,{title:Vue.unref($)?"Add":"Edit",modelValue:Vue.unref(f),"onUpdate:modelValue":t[18]||(t[18]=e=>Vue.isRef(f)?f.value=e:null),width:"60%","close-on-click-modal":!1},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",Ve,[Vue.createVNode(h,{onClick:t[17]||(t[17]=e=>f.value=!1)},{default:Vue.withCtx(()=>[ce]),_:1}),Vue.createVNode(h,{type:"primary",onClick:U},{default:Vue.withCtx(()=>[pe]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(j,{rules:Vue.unref(C),model:Vue.unref(a),ref_key:"formRef",ref:x,"label-width":"auto","label-position":"top"},{default:Vue.withCtx(()=>[Vue.createVNode(d,{prop:"reportDate",label:Vue.unref(u).state.label.reportDate},{default:Vue.withCtx(()=>[Vue.createVNode(b,{type:"date",modelValue:Vue.unref(a).reportDate,"onUpdate:modelValue":t[7]||(t[7]=e=>Vue.unref(a).reportDate=e),format:"YYYY-MM-DD",onChange:t[8]||(t[8]=e=>Vue.unref(a).reportDate=Vue.unref(c)(Vue.unref(a).reportDate,"yyyy-MM-dd"))},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"userId",label:Vue.unref(u).state.label.user},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(a).userId,"onUpdate:modelValue":t[9]||(t[9]=e=>Vue.unref(a).userId=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(m.value,e=>(Vue.openBlock(),Vue.createBlock(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"directLeader",label:Vue.unref(u).state.label.directLeader},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(a).directLeader,"onUpdate:modelValue":t[10]||(t[10]=e=>Vue.unref(a).directLeader=e),clearable:"",filterable:"",placeholder:"Please select"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(m.value,e=>(Vue.openBlock(),Vue.createBlock(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"accidentDescribe",label:Vue.unref(u).state.label.accidentQualityDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).accidentDescribe,"onUpdate:modelValue":t[11]||(t[11]=e=>Vue.unref(a).accidentDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"photoList",label:`${Vue.unref(u).state.label.qualityPhoto}(${(Vue.unref(C).photoList||[]).reduce((e,p)=>`Min: ${p.min}, Max: ${p.max}`,"Unlimited")})`},{default:Vue.withCtx(()=>[Vue.createVNode(oe,{photoList:Vue.unref(a).photoList,maxSize:+`${(Vue.unref(C).photoList||[]).reduce((e,p)=>p.max,999)}`},null,8,["photoList","maxSize"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"reason",label:Vue.unref(u).state.label.troubleReason},{default:Vue.withCtx(()=>[Vue.createVNode(V,{modelValue:Vue.unref(a).reasonList,"onUpdate:modelValue":t[12]||(t[12]=e=>Vue.unref(a).reasonList=e),filterable:"",multiple:"","allow-create":"",clearable:"",placeholder:Vue.unref(u).state.label.troubleReason,class:"search-item"},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(k).troubleReasonList,e=>(Vue.openBlock(),Vue.createBlock(i,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"solve",label:Vue.unref(u).state.label.qualitySolve},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).solve,"onUpdate:modelValue":t[13]||(t[13]=e=>Vue.unref(a).solve=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"improveDescribe",label:Vue.unref(u).state.label.improveDescribe},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).improveDescribe,"onUpdate:modelValue":t[14]||(t[14]=e=>Vue.unref(a).improveDescribe=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"opinion",label:Vue.unref(u).state.label.qualityOpinion},{default:Vue.withCtx(()=>[Vue.createVNode(s,{type:"textarea",rows:4,modelValue:Vue.unref(a).opinion,"onUpdate:modelValue":t[15]||(t[15]=e=>Vue.unref(a).opinion=e)},null,8,["modelValue"])]),_:1},8,["label"]),Vue.createVNode(d,{prop:"valid",label:Vue.unref(u).state.label.valid},{default:Vue.withCtx(()=>[Vue.createVNode(Q,{modelValue:Vue.unref(a).valid,"onUpdate:modelValue":t[16]||(t[16]=e=>Vue.unref(a).valid=e),name:"valid",disabled:!Vue.unref(W)(Vue.unref(R),"admin")},{default:Vue.withCtx(()=>[ie]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1},8,["rules","model"])]),_:1},8,["title","modelValue"])])}}});export{_e as default};
